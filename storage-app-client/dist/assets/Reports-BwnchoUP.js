import{W,H as A,r as u,f as ye,g as H,M as de,s as te,y as Y,o as q,n as re,$ as me,h as _e,w as Ne,D as xe,i as we,k as K,_ as J,T as se,l as ke,m as S,P as z,F as R,t as Te,u as O,j as e,c as $e,R as pe}from"./index-BZfsmhhx.js";import{a as Pe}from"./clientService-D0rezJXS.js";import{a as Ce,d as Se,b as Re}from"./reportService-DrFnAniA.js";import{a as Ee}from"./usersService-CO4rIiT5.js";import{a as Ie}from"./worksiteService-CfPHAhQs.js";import{T as X}from"./Tooltip-C1LlIwdT.js";import{f as le,g as ae,h as Fe,i as De,j as Me}from"./index-DVcFOJ97.js";import{f as ue,R as Le,u as qe}from"./ReportDetails-DNWXw9kT.js";import"./api-CLE4YwRs.js";import"./productsService-DUq13sXT.js";let Oe="span";var he=(t=>(t[t.None=1]="None",t[t.Focusable=2]="Focusable",t[t.Hidden=4]="Hidden",t))(he||{});function Be(t,s){var l;let{features:r=1,...d}=t,x={ref:s,"aria-hidden":(r&2)===2?!0:(l=d["aria-hidden"])!=null?l:void 0,hidden:(r&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(r&4)===4&&(r&2)!==2&&{display:"none"}}};return A({ourProps:x,theirProps:d,slot:{},defaultTag:Oe,name:"Hidden"})}let be=W(Be);function ze({onFocus:t}){let[s,l]=u.useState(!0),r=ye();return s?H.createElement(be,{as:"button",type:"button",features:he.Focusable,onFocus:d=>{d.preventDefault();let x,n=50;function b(){if(n--<=0){x&&cancelAnimationFrame(x);return}if(t()){if(cancelAnimationFrame(x),!r.current)return;l(!1);return}x=requestAnimationFrame(b)}x=requestAnimationFrame(b)}}):null}const ge=u.createContext(null);function He(){return{groups:new Map,get(t,s){var l;let r=this.groups.get(t);r||(r=new Map,this.groups.set(t,r));let d=(l=r.get(s))!=null?l:0;r.set(s,d+1);let x=Array.from(r.keys()).indexOf(s);function n(){let b=r.get(s);b>1?r.set(s,b-1):r.delete(s)}return[x,n]}}}function Ue({children:t}){let s=u.useRef(He());return u.createElement(ge.Provider,{value:s},t)}function fe(t){let s=u.useContext(ge);if(!s)throw new Error("You must wrap your component in a <StableCollection>");let l=u.useId(),[r,d]=s.current.get(t,l);return u.useEffect(()=>d,[]),r}var We=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(We||{}),Ae=(t=>(t[t.Less=-1]="Less",t[t.Equal=0]="Equal",t[t.Greater=1]="Greater",t))(Ae||{}),Ve=(t=>(t[t.SetSelectedIndex=0]="SetSelectedIndex",t[t.RegisterTab=1]="RegisterTab",t[t.UnregisterTab=2]="UnregisterTab",t[t.RegisterPanel=3]="RegisterPanel",t[t.UnregisterPanel=4]="UnregisterPanel",t))(Ve||{});let Ge={0(t,s){var l;let r=J(t.tabs,g=>g.current),d=J(t.panels,g=>g.current),x=r.filter(g=>{var m;return!((m=g.current)!=null&&m.hasAttribute("disabled"))}),n={...t,tabs:r,panels:d};if(s.index<0||s.index>r.length-1){let g=K(Math.sign(s.index-t.selectedIndex),{[-1]:()=>1,0:()=>K(Math.sign(s.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(x.length===0)return n;let m=K(g,{0:()=>r.indexOf(x[0]),1:()=>r.indexOf(x[x.length-1])});return{...n,selectedIndex:m===-1?t.selectedIndex:m}}let b=r.slice(0,s.index),N=[...r.slice(s.index),...b].find(g=>x.includes(g));if(!N)return n;let y=(l=r.indexOf(N))!=null?l:t.selectedIndex;return y===-1&&(y=t.selectedIndex),{...n,selectedIndex:y}},1(t,s){if(t.tabs.includes(s.tab))return t;let l=t.tabs[t.selectedIndex],r=J([...t.tabs,s.tab],x=>x.current),d=t.selectedIndex;return t.info.current.isControlled||(d=r.indexOf(l),d===-1&&(d=t.selectedIndex)),{...t,tabs:r,selectedIndex:d}},2(t,s){return{...t,tabs:t.tabs.filter(l=>l!==s.tab)}},3(t,s){return t.panels.includes(s.panel)?t:{...t,panels:J([...t.panels,s.panel],l=>l.current)}},4(t,s){return{...t,panels:t.panels.filter(l=>l!==s.panel)}}},ne=u.createContext(null);ne.displayName="TabsDataContext";function U(t){let s=u.useContext(ne);if(s===null){let l=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,U),l}return s}let oe=u.createContext(null);oe.displayName="TabsActionsContext";function ie(t){let s=u.useContext(oe);if(s===null){let l=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(l,ie),l}return s}function Je(t,s){return K(s.type,Ge,t,s)}let Ke="div";function Xe(t,s){let{defaultIndex:l=0,vertical:r=!1,manual:d=!1,onChange:x,selectedIndex:n=null,...b}=t;const N=r?"vertical":"horizontal",y=d?"manual":"auto";let g=n!==null,m=te({isControlled:g}),c=Y(s),[j,v]=u.useReducer(Je,{info:m,selectedIndex:n??l,tabs:[],panels:[]}),p=u.useMemo(()=>({selectedIndex:j.selectedIndex}),[j.selectedIndex]),T=te(x||(()=>{})),k=te(j.tabs),f=u.useMemo(()=>({orientation:N,activation:y,...j}),[N,y,j]),P=q(h=>(v({type:1,tab:h}),()=>v({type:2,tab:h}))),E=q(h=>(v({type:3,panel:h}),()=>v({type:4,panel:h}))),a=q(h=>{i.current!==h&&T.current(h),g||v({type:0,index:h})}),i=te(g?t.selectedIndex:j.selectedIndex),o=u.useMemo(()=>({registerTab:P,registerPanel:E,change:a}),[]);re(()=>{v({type:0,index:n??l})},[n]),re(()=>{if(i.current===void 0||j.tabs.length<=0)return;let h=J(j.tabs,C=>C.current);h.some((C,D)=>j.tabs[D]!==C)&&a(h.indexOf(j.tabs[i.current]))});let w={ref:c};return H.createElement(Ue,null,H.createElement(oe.Provider,{value:o},H.createElement(ne.Provider,{value:f},f.tabs.length<=0&&H.createElement(ze,{onFocus:()=>{var h,C;for(let D of k.current)if(((h=D.current)==null?void 0:h.tabIndex)===0)return(C=D.current)==null||C.focus(),!0;return!1}}),A({ourProps:w,theirProps:b,slot:p,defaultTag:Ke,name:"Tabs"}))))}let Ye="div";function Qe(t,s){let{orientation:l,selectedIndex:r}=U("Tab.List"),d=Y(s),x=u.useMemo(()=>({selectedIndex:r}),[r]);return A({ourProps:{ref:d,role:"tablist","aria-orientation":l},theirProps:t,slot:x,defaultTag:Ye,name:"Tabs.List"})}let Ze="button";function et(t,s){var l,r;let d=u.useId(),{id:x=`headlessui-tabs-tab-${d}`,disabled:n=!1,autoFocus:b=!1,...N}=t,{orientation:y,activation:g,selectedIndex:m,tabs:c,panels:j}=U("Tab"),v=ie("Tab"),p=U("Tab"),[T,k]=u.useState(null),f=u.useRef(null),P=Y(f,s,k);re(()=>v.registerTab(f),[v,f]);let E=fe("tabs"),a=c.indexOf(f);a===-1&&(a=E);let i=a===m,o=q(_=>{var F;let ee=_();if(ee===se.Success&&g==="auto"){let ve=(F=ke(f))==null?void 0:F.activeElement,ce=p.tabs.findIndex(je=>je.current===ve);ce!==-1&&v.change(ce)}return ee}),w=q(_=>{let F=c.map(ee=>ee.current).filter(Boolean);if(_.key===S.Space||_.key===S.Enter){_.preventDefault(),_.stopPropagation(),v.change(a);return}switch(_.key){case S.Home:case S.PageUp:return _.preventDefault(),_.stopPropagation(),o(()=>z(F,R.First));case S.End:case S.PageDown:return _.preventDefault(),_.stopPropagation(),o(()=>z(F,R.Last))}if(o(()=>K(y,{vertical(){return _.key===S.ArrowUp?z(F,R.Previous|R.WrapAround):_.key===S.ArrowDown?z(F,R.Next|R.WrapAround):se.Error},horizontal(){return _.key===S.ArrowLeft?z(F,R.Previous|R.WrapAround):_.key===S.ArrowRight?z(F,R.Next|R.WrapAround):se.Error}}))===se.Success)return _.preventDefault()}),h=u.useRef(!1),C=q(()=>{var _;h.current||(h.current=!0,(_=f.current)==null||_.focus({preventScroll:!0}),v.change(a),Te(()=>{h.current=!1}))}),D=q(_=>{_.preventDefault()}),{isFocusVisible:Q,focusProps:Z}=me({autoFocus:b}),{isHovered:V,hoverProps:B}=_e({isDisabled:n}),{pressed:$,pressProps:I}=Ne({disabled:n}),M=u.useMemo(()=>({selected:i,hover:V,active:$,focus:Q,autofocus:b,disabled:n}),[i,V,Q,$,b,n]),G=xe({ref:P,onKeyDown:w,onMouseDown:D,onClick:C,id:x,role:"tab",type:we(t,T),"aria-controls":(r=(l=j[a])==null?void 0:l.current)==null?void 0:r.id,"aria-selected":i,tabIndex:i?0:-1,disabled:n||void 0,autoFocus:b},Z,B,I);return A({ourProps:G,theirProps:N,slot:M,defaultTag:Ze,name:"Tabs.Tab"})}let tt="div";function st(t,s){let{selectedIndex:l}=U("Tab.Panels"),r=Y(s),d=u.useMemo(()=>({selectedIndex:l}),[l]);return A({ourProps:{ref:r},theirProps:t,slot:d,defaultTag:tt,name:"Tabs.Panels"})}let rt="div",lt=de.RenderStrategy|de.Static;function at(t,s){var l,r,d,x;let n=u.useId(),{id:b=`headlessui-tabs-panel-${n}`,tabIndex:N=0,...y}=t,{selectedIndex:g,tabs:m,panels:c}=U("Tab.Panel"),j=ie("Tab.Panel"),v=u.useRef(null),p=Y(v,s);re(()=>j.registerPanel(v),[j,v]);let T=fe("panels"),k=c.indexOf(v);k===-1&&(k=T);let f=k===g,{isFocusVisible:P,focusProps:E}=me(),a=u.useMemo(()=>({selected:f,focus:P}),[f,P]),i=xe({ref:p,id:b,role:"tabpanel","aria-labelledby":(r=(l=m[k])==null?void 0:l.current)==null?void 0:r.id,tabIndex:f?N:-1},E);return!f&&((d=y.unmount)==null||d)&&!((x=y.static)!=null&&x)?H.createElement(be,{"aria-hidden":"true",...i}):A({ourProps:i,theirProps:y,slot:a,defaultTag:rt,features:lt,visible:f,name:"Tabs.Panel"})}let nt=W(et),ot=W(Xe),it=W(Qe),ct=W(st),dt=W(at),L=Object.assign(nt,{Group:ot,List:it,Panels:ct,Panel:dt});const ut=({technicians:t,clients:s,worksites:l})=>{const{t:r}=O(),[d,x]=u.useState(""),[n,b]=u.useState(""),[N,y]=u.useState(""),[g,m]=u.useState(""),[c,j]=u.useState(!1),v=async()=>{j(!0);try{const p=await Ce({month:d,technician:n,client:N,worksite:g}),T=new Blob([p],{type:"text/csv;charset=utf-8;"}),k=URL.createObjectURL(T),f=document.createElement("a");f.href=k,f.setAttribute("download",`reports_${Date.now()}.csv`),document.body.appendChild(f),f.click(),document.body.removeChild(f),URL.revokeObjectURL(k)}catch(p){console.error("Error exporting CSV:",p),alert(r("error_exporting_csv"))}finally{j(!1)}};return e.jsxs("div",{className:"flex items-center space-x-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("month")}),e.jsx("input",{type:"month",value:d,onChange:p=>x(p.target.value),className:"border rounded px-2 py-1 text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("technician")}),e.jsxs("select",{value:n,onChange:p=>b(p.target.value),className:"border rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"",children:r("all")}),t.map(p=>e.jsx("option",{value:p._id,children:p.name},p._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("client")}),e.jsxs("select",{value:N,onChange:p=>y(p.target.value),className:"border rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"",children:r("all")}),s.map(p=>e.jsx("option",{value:p._id,children:p.name},p._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:r("worksite")}),e.jsxs("select",{value:g,onChange:p=>m(p.target.value),className:"border rounded px-2 py-1 text-sm",children:[e.jsx("option",{value:"",children:r("all")}),l.map(p=>e.jsx("option",{value:p._id,children:p.name},p._id))]})]}),e.jsx("button",{onClick:v,disabled:c,className:`px-4 py-2 text-white font-bold rounded ${c?"bg-gray-400 cursor-not-allowed":"bg-blue-500 hover:bg-blue-600"}`,children:r(c?"exporting":"export_csv")})]})},mt=({reports:t,onReportDeleted:s})=>{const{t:l}=O(),r=$e(),[d,x]=u.useState([]),[n,b]=u.useState([]),[N,y]=u.useState([]);u.useEffect(()=>{(async()=>{try{const[c,j,v]=await Promise.all([Ee(),Pe(),Ie()]);x(c.users),b(j.clients),y(v)}catch(c){console.error("Error fetching filter data:",c)}})()},[]);const g=async m=>{if(window.confirm(l("confirm_delete")))try{await Se(m),s()}catch(c){console.error("Error deleting report:",c)}};return e.jsxs("div",{children:[e.jsx(ut,{technicians:d,clients:n,worksites:N}),t.length===0?e.jsx("p",{children:l("no_reports_found")}):e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("technician")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:l("actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:t.map(m=>{const c=typeof m.technician_id=="object"&&m.technician_id!==null?m.technician_id.name:l("not_assigned");return e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m.date?new Date(m.date).toLocaleDateString():""}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:c}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:m.status||l("not_specified")}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(X,{content:l("view_report"),children:e.jsx("button",{onClick:()=>r(`/reports/${m._id}`),className:"text-blue-500 hover:text-blue-700",children:l("view")})}),e.jsx(X,{content:l("delete_report"),children:e.jsx("button",{onClick:()=>g(m._id),className:"text-red-500 hover:text-red-700",children:l("delete")})})]})})]},m._id)})})]})]})},xt=({activity:t={tasks:[]},index:s,clients:l=[],worksites:r=[],products:d=[],users:x=[],handleActivityChange:n,removeActivity:b,appendTask:N,removeTask:y,appendMaterial:g,removeMaterial:m})=>{var E;const{t:c}=O(),j=a=>{const{checked:i}=a.target,o=i?"rules":"manual";console.log({newMethod:o}),n(s,"valid_travel_time",o),o==="manual"?n(s,"travel_time_rules_applied",void 0):o==="rules"&&n(s,"travel_time_hours","")},v=a=>{const i=a.target.value;if(!i){n(s,"travel_time_hours","");return}if(/^\d*[.,]?\d{0,2}$/.test(i)){const o=i.replace(",",".");n(s,"travel_time_hours",o)}},p=a=>{const i=a.target.value;if(i){const o=parseFloat(i.replace(",","."));n(s,"travel_time_hours",Number(o.toFixed(2)))}},T=a=>{const i=parseInt(a.target.value,10);let o=0;switch(i){case 15:o=.5;break;case 26:o=1;break;case 46:o=2;break;case 66:o=2.5;break;default:o=0}n(s,"travel_time_rules_applied",{distance_km:i,travel_time_hours:o,note:`Rule for ${i} km`}),n(s,"travel_time_hours",o)},k=(a,i)=>{const o=t.tasks[a].assigned_technician_ids,w=o.includes(i)?o.filter(h=>h!==i):[...o,i];n(s,`tasks[${a}].assigned_technician_ids`,w)},f=(a,i)=>{const o=i.target.value;if(!o){n(s,`tasks[${a}].work_hours`,"");return}if(/^\d*[.,]?\d{0,2}$/.test(o)){const w=o.replace(",",".");n(s,`tasks[${a}].work_hours`,w)}},P=(a,i)=>{const o=i.target.value;if(o){const w=parseFloat(o.replace(",","."));n(s,`tasks[${a}].work_hours`,Number(w.toFixed(2)))}};return e.jsxs("div",{className:"grid grid-cols-1 gap-6 bg-white rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-900",children:[c("activity")," ",s+1]}),e.jsx(X,{content:c("remove_activity"),children:e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 p-2 rounded-lg transition-colors",onClick:()=>b(s),children:e.jsx(le,{})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("client")}),e.jsxs("select",{className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:t.client_id||"",onChange:a=>n(s,"client_id",a.target.value),children:[e.jsx("option",{value:"",children:c("select_client")}),l.map(a=>e.jsx("option",{value:a._id,children:a.name},a._id))]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("worksite")}),e.jsxs("select",{className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:t.worksite_id||"",onChange:a=>n(s,"worksite_id",a.target.value),children:[e.jsx("option",{value:"",children:c("select_worksite")}),r.filter(a=>a.client_id===t.client_id).map(a=>e.jsx("option",{value:a._id,children:a.name},a._id))]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("activity_description")}),e.jsx("textarea",{className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[100px]",value:t.activity_description,onChange:a=>n(s,"activity_description",a.target.value)})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("travel_time")}),e.jsx("div",{className:"flex items-start gap-4 mb-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",id:`valid_travel_time_${s}`,className:"rounded border-gray-300 text-blue-500 focus:ring-blue-500",checked:t.valid_travel_time==="rules",onChange:j}),e.jsx("label",{htmlFor:`valid_travel_time_${s}`,className:"ml-2 text-sm",children:c("use_travel_time_rules")})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:`w-full ${t.valid_travel_time!=="manual"?"opacity-50 pointer-events-none":""}`,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("manual_travel_time_hours")}),e.jsx("input",{type:"text",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:t.travel_time_hours||"",onChange:v,onBlur:p,placeholder:c("enter_travel_time_hours")}),e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:ue(t.travel_time_hours)})]}),e.jsxs("div",{className:`w-full ${t.valid_travel_time!=="rules"?"opacity-50 pointer-events-none":""}`,children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("travel_time_rules")}),e.jsxs("select",{className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:((E=t.travel_time_rules_applied)==null?void 0:E.distance_km)||"",onChange:T,children:[e.jsx("option",{value:"",children:c("select_distance")}),e.jsx("option",{value:"15",children:"15-25 km"}),e.jsx("option",{value:"26",children:"26-45 km"}),e.jsx("option",{value:"46",children:"46-65 km"}),e.jsx("option",{value:"66",children:"66-100 km"})]}),e.jsx("div",{className:"mt-2 text-sm text-gray-600 bg-gray-50 p-3 rounded-lg",children:e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• 15-25 km from headquarters → 0.5 hours travel time (e.g., Castello Tesino – Levico - Caldonazzo)"}),e.jsx("li",{children:"• 26-45 km from headquarters → 1 hour travel time (e.g., Pergine – Trento)"}),e.jsx("li",{children:"• 46-65 km from headquarters → 2 hours travel time (e.g., Rovereto)"}),e.jsx("li",{children:"• 66-100 km from headquarters → 2.5 hours travel time (e.g., Bolzano)"})]})})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h4",{className:"text-lg font-semibold text-gray-900",children:c("tasks")}),e.jsxs("button",{type:"button",className:"bg-blue-500 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center gap-2",onClick:a=>N(a,s),children:[e.jsx(ae,{size:14}),e.jsx("span",{children:c("add_task")})]})]}),e.jsx("div",{className:"grid grid-cols-1 gap-6",children:t.tasks.map((a,i)=>e.jsxs("div",{className:"border border-gray-200 rounded-lg p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h5",{className:"font-semibold text-gray-900",children:[c("task")," ",i+1]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 p-2 rounded-lg transition-colors",onClick:()=>y(s,i),children:e.jsx(le,{})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("task_description")}),e.jsx("textarea",{className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[80px]",value:a.task_description,onChange:o=>n(s,`tasks[${i}].task_description`,o.target.value)})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("work_hours")}),e.jsx("input",{type:"text",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:a.work_hours||"",onChange:o=>f(i,o),onBlur:o=>P(i,o),placeholder:c("work_hours_placeholder")}),e.jsx("div",{className:"mt-2 text-sm text-gray-600",children:(a==null?void 0:a.work_hours)&&ue(a==null?void 0:a.work_hours)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("intervention_type")}),e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.intervention_type.to_quote,onChange:o=>n(s,`tasks[${i}].intervention_type.to_quote`,o.target.checked),className:"rounded border-gray-300 text-blue-500 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:c("to_quote")})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.intervention_type.in_economy,onChange:o=>n(s,`tasks[${i}].intervention_type.in_economy`,o.target.checked),className:"rounded border-gray-300 text-blue-500 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:c("in_economy")})]}),e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:a.intervention_type.site_inspection,onChange:o=>n(s,`tasks[${i}].intervention_type.site_inspection`,o.target.checked),className:"rounded border-gray-300 text-blue-500 focus:ring-blue-500"}),e.jsx("span",{className:"text-sm",children:c("site_inspection")})]})]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:c("assigned_technicians")}),e.jsx("div",{className:"flex flex-wrap gap-2 p-2 bg-gray-50 rounded-lg",children:x.map(o=>e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",className:"rounded border-gray-300 text-blue-500 focus:ring-blue-500",checked:a.assigned_technician_ids.includes(o._id),onChange:()=>k(i,o._id)}),e.jsx("span",{className:"text-sm",children:o.name})]},o._id))})]}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:c("materials")}),e.jsxs("button",{type:"button",className:"text-blue-500 hover:text-blue-700 text-sm flex items-center gap-1",onClick:o=>g(o,s,i),children:[e.jsx(ae,{size:12}),e.jsx("span",{children:c("add")})]})]}),e.jsx("div",{className:"space-y-2",children:a.materials_used.map((o,w)=>e.jsxs("div",{className:"grid grid-cols-[1fr,120px,auto] gap-2",children:[e.jsxs("select",{className:"px-3 py-1 rounded border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:o.product_id||"",onChange:h=>n(s,`tasks[${i}].materials_used[${w}].product_id`,h.target.value),children:[e.jsx("option",{value:"",children:c("select_product")}),d.map(h=>e.jsx("option",{value:h._id,children:h.item_code},h._id))]}),e.jsx("input",{type:"number",className:"px-3 py-1 rounded border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:o.quantity,onChange:h=>n(s,`tasks[${i}].materials_used[${w}].quantity`,parseFloat(h.target.value)),placeholder:c("qty"),min:"0",step:"0.1"}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 p-1",onClick:()=>m(s,i,w),children:e.jsx(le,{size:12})})]},w))})]})]})]},i))})]})]})},pt=({report:t,onClose:s})=>{const{t:l}=O(),r=n=>{s()},d=n=>{n.stopPropagation()},x=e.jsx("div",{style:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.5)",zIndex:9999},className:"flex items-center justify-center",onClick:r,children:e.jsxs("div",{className:"bg-white rounded-lg p-8 max-w-3xl w-full relative overflow-y-auto max-h-[90vh] m-4",onClick:d,children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:l("report_preview")}),e.jsx("button",{onClick:s,className:"text-gray-600 hover:text-gray-800 transition-colors",children:e.jsx(Fe,{})})]}),e.jsx("p",{className:"text-gray-500 italic mb-4",children:l("this_is_a_preview_of_your_report")}),e.jsx(Le,{report:t})]})});return pe.createPortal(x,document.body)},ht=({formData:t,users:s,handleChange:l})=>{const{t:r}=O();return e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"text-2xl font-bold mb-6",children:r("report_header")}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r("date")}),e.jsx("input",{type:"date",name:"date",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:t.date,onChange:l,required:!0})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r("author")}),e.jsxs("select",{name:"author_id",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:t.author_id,onChange:l,required:!0,children:[e.jsx("option",{value:"",children:r("select_author")}),s==null?void 0:s.map(d=>e.jsx("option",{value:d._id,children:d.name},d._id))]})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r("head_description")}),e.jsx("textarea",{name:"head_description",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[100px]",value:t.head_description,onChange:l,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r("status")}),e.jsxs("select",{name:"status",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:t.status,onChange:l,required:!0,children:[e.jsx("option",{value:"",children:r("select_status")}),e.jsx("option",{value:"PLANNED",children:r("planned")}),e.jsx("option",{value:"IN_PROGRESS",children:r("in_progress")}),e.jsx("option",{value:"FINITO",children:r("finito")}),e.jsx("option",{value:"SOSPESO",children:r("sospeso")}),e.jsx("option",{value:"DRAFT",children:r("draft")})]})]}),e.jsxs("div",{className:"w-full",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:r("lunch_location")}),e.jsx("input",{type:"text",name:"lunch_location",className:"w-full px-4 py-2 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 focus:border-blue-500",value:t.lunch_location||"",onChange:l,placeholder:r("optional")})]})]})]})]})},bt=()=>{var Z,V;const{t}=O(),{formData:s,clients:l,worksites:r,products:d,users:x,isLoading:n,error:b,handleHeaderChange:N,handleActivityChange:y,handleSubmit:g,appendActivity:m,removeActivity:c,appendTask:j,removeTask:v,appendMaterial:p,removeMaterial:T}=qe(),[k,f]=u.useState(!1),[P,E]=u.useState(!0),[a,i]=u.useState(0),o=u.useRef([]),w=()=>{f(!0)};if(b)return e.jsx("div",{className:"text-red-500",children:b});const h=s.activities[a],C=h?h.tasks.length:0,D=B=>{i(B)},Q=e.jsxs("div",{className:`fixed bottom-4 left-4 bg-white border border-gray-300 rounded-lg shadow-lg p-4 z-50 ${P?"":"hidden"}`,style:{gap:"1rem"},children:[e.jsx("div",{className:"mb-2",children:e.jsxs("p",{className:"text-sm text-gray-700",children:[t("you_are_watching_activity")," ",a+1," ",t("with_n_tasks")," ",C]})}),e.jsx("div",{children:e.jsx(X,{content:t("preview_report_tooltip"),children:e.jsxs("button",{type:"button",className:"flex items-center bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded",onClick:w,children:[e.jsx(De,{className:"mr-2"}),t("preview")]})})})]});return e.jsxs("form",{onSubmit:g,className:"grid grid-cols-1 gap-6 bg-white rounded-lg p-8",children:[e.jsx("section",{className:"w-full",children:e.jsx(ht,{formData:s.header,users:x,handleChange:N})}),e.jsx("section",{className:"w-full",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-6 rounded-lg mb-6 my-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t("activities")}),e.jsx("div",{className:"flex-grow flex items-center justify-center gap-2",children:(Z=s.activities)==null?void 0:Z.map((B,$)=>e.jsx("button",{type:"button",className:`h-8 min-w-[32px] px-3 rounded-full text-sm font-medium transition-colors ${$===a?"bg-blue-500 text-white":"bg-white border border-gray-300 text-gray-700 hover:bg-gray-100"}`,onClick:()=>D($),children:$+1},$))}),e.jsxs("button",{type:"button",className:"flex items-center gap-2 bg-white border border-blue-500 text-blue-500 hover:bg-blue-50 px-4 py-2 rounded-lg transition-colors",onClick:()=>{m(),setTimeout(()=>{i(s.activities.length)},0)},children:[e.jsx(ae,{size:14}),t("add_activity")]})]}),e.jsx("div",{className:"overflow-hidden",children:e.jsx("div",{className:"flex transition-transform duration-500 ease-in-out",style:{transform:`translateX(-${a*100}%)`},children:(V=s.activities)==null?void 0:V.map((B,$)=>e.jsx("div",{className:"w-full flex-shrink-0",ref:I=>o.current[$]=I,children:e.jsx(xt,{activity:B,index:$,clients:l,worksites:r,products:d,users:x,handleActivityChange:(I,M,G)=>{y(I,M,G)},removeActivity:c,appendTask:(I,M)=>{I.preventDefault(),j(M)},removeTask:v,appendMaterial:(I,M,G)=>{I.preventDefault(),p(M,G)},removeMaterial:T})},$))})})]})}),e.jsx("section",{className:"w-full flex justify-end gap-4",children:e.jsx(X,{content:t("submit_report_tooltip"),children:e.jsxs("button",{type:"submit",className:"flex items-center bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded",children:[e.jsx(Me,{className:"mr-2"}),t("submit")]})})}),k&&e.jsx(pt,{report:s,onClose:()=>f(!1)}),pe.createPortal(Q,document.body)]})},$t=()=>{const{t}=O(),[s,l]=u.useState([]),[r,d]=u.useState(!0),[x,n]=u.useState(null),[b,N]=u.useState(()=>{const m=localStorage.getItem("selectedTab");return m?parseInt(m,10):0});u.useEffect(()=>{y()},[]),u.useEffect(()=>{localStorage.setItem("selectedTab",b.toString())},[b]);const y=async()=>{d(!0);try{const m=await Re();l(m),n(null)}catch(m){n(t("error_fetching_reports")),console.error(t("error_fetching_reports"),m)}finally{d(!1)}},g=()=>{y()};return e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("reports")}),e.jsxs(L.Group,{selectedIndex:b,onChange:N,children:[e.jsxs(L.List,{className:"flex space-x-1 rounded-xl bg-blue-900/20 p-1 mb-6",children:[e.jsx(L,{className:({selected:m})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
               ${m?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("report_list")}),e.jsx(L,{className:({selected:m})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
               ${m?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("create_report")})]}),e.jsxs(L.Panels,{children:[e.jsx(L.Panel,{children:r?e.jsx("p",{children:t("loading_reports")}):x?e.jsx("p",{className:"text-red-500",children:x}):e.jsx(mt,{reports:s,onReportDeleted:g})}),e.jsx(L.Panel,{children:e.jsx(bt,{})})]})]})]})};export{$t as default};
