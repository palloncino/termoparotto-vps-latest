import{W as A,H as O,r as c,f as be,R as q,M as se,s as z,y as G,o as E,n as J,$ as ae,g as fe,w as je,D as ne,h as ve,i as U,_ as B,T as V,k as ye,l as T,P as M,F as $,t as we,u as W,j as e,L as Ne,e as _e}from"./index-BqmGnuip.js";import{f as re,u as ke,a as Pe}from"./useEntityData-_jsQjITL.js";import{f as Ce,h as Fe,i as Te,c as $e,j as Ie,k as De}from"./index-C1dwHJEw.js";import{B as Se}from"./Backdrop-BFvOE1c1.js";import"./clientService-Bj64bQzW.js";import"./api-CLE4YwRs.js";import"./productsService-BaCjJiUO.js";import"./usersService-D84MQp6X.js";import"./worksiteService-CfPHAhQs.js";let Re="span";var le=(t=>(t[t.None=1]="None",t[t.Focusable=2]="Focusable",t[t.Hidden=4]="Hidden",t))(le||{});function Ee(t,s){var a;let{features:r=1,...o}=t,l={ref:s,"aria-hidden":(r&2)===2?!0:(a=o["aria-hidden"])!=null?a:void 0,hidden:(r&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(r&4)===4&&(r&2)!==2&&{display:"none"}}};return O({ourProps:l,theirProps:o,slot:{},defaultTag:Re,name:"Hidden"})}let ie=A(Ee);function Me({onFocus:t}){let[s,a]=c.useState(!0),r=be();return s?q.createElement(ie,{as:"button",type:"button",features:le.Focusable,onFocus:o=>{o.preventDefault();let l,i=50;function h(){if(i--<=0){l&&cancelAnimationFrame(l);return}if(t()){if(cancelAnimationFrame(l),!r.current)return;a(!1);return}l=requestAnimationFrame(h)}l=requestAnimationFrame(h)}}):null}const oe=c.createContext(null);function qe(){return{groups:new Map,get(t,s){var a;let r=this.groups.get(t);r||(r=new Map,this.groups.set(t,r));let o=(a=r.get(s))!=null?a:0;r.set(s,o+1);let l=Array.from(r.keys()).indexOf(s);function i(){let h=r.get(s);h>1?r.set(s,h-1):r.delete(s)}return[l,i]}}}function Le({children:t}){let s=c.useRef(qe());return c.createElement(oe.Provider,{value:s},t)}function de(t){let s=c.useContext(oe);if(!s)throw new Error("You must wrap your component in a <StableCollection>");let a=c.useId(),[r,o]=s.current.get(t,a);return c.useEffect(()=>o,[]),r}var Ae=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(Ae||{}),Oe=(t=>(t[t.Less=-1]="Less",t[t.Equal=0]="Equal",t[t.Greater=1]="Greater",t))(Oe||{}),Be=(t=>(t[t.SetSelectedIndex=0]="SetSelectedIndex",t[t.RegisterTab=1]="RegisterTab",t[t.UnregisterTab=2]="UnregisterTab",t[t.RegisterPanel=3]="RegisterPanel",t[t.UnregisterPanel=4]="UnregisterPanel",t))(Be||{});let Ue={0(t,s){var a;let r=B(t.tabs,n=>n.current),o=B(t.panels,n=>n.current),l=r.filter(n=>{var j;return!((j=n.current)!=null&&j.hasAttribute("disabled"))}),i={...t,tabs:r,panels:o};if(s.index<0||s.index>r.length-1){let n=U(Math.sign(s.index-t.selectedIndex),{[-1]:()=>1,0:()=>U(Math.sign(s.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(l.length===0)return i;let j=U(n,{0:()=>r.indexOf(l[0]),1:()=>r.indexOf(l[l.length-1])});return{...i,selectedIndex:j===-1?t.selectedIndex:j}}let h=r.slice(0,s.index),u=[...r.slice(s.index),...h].find(n=>l.includes(n));if(!u)return i;let d=(a=r.indexOf(u))!=null?a:t.selectedIndex;return d===-1&&(d=t.selectedIndex),{...i,selectedIndex:d}},1(t,s){if(t.tabs.includes(s.tab))return t;let a=t.tabs[t.selectedIndex],r=B([...t.tabs,s.tab],l=>l.current),o=t.selectedIndex;return t.info.current.isControlled||(o=r.indexOf(a),o===-1&&(o=t.selectedIndex)),{...t,tabs:r,selectedIndex:o}},2(t,s){return{...t,tabs:t.tabs.filter(a=>a!==s.tab)}},3(t,s){return t.panels.includes(s.panel)?t:{...t,panels:B([...t.panels,s.panel],a=>a.current)}},4(t,s){return{...t,panels:t.panels.filter(a=>a!==s.panel)}}},K=c.createContext(null);K.displayName="TabsDataContext";function L(t){let s=c.useContext(K);if(s===null){let a=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,L),a}return s}let Y=c.createContext(null);Y.displayName="TabsActionsContext";function Q(t){let s=c.useContext(Y);if(s===null){let a=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,Q),a}return s}function Ge(t,s){return U(s.type,Ue,t,s)}let We="div";function He(t,s){let{defaultIndex:a=0,vertical:r=!1,manual:o=!1,onChange:l,selectedIndex:i=null,...h}=t;const u=r?"vertical":"horizontal",d=o?"manual":"auto";let n=i!==null,j=z({isControlled:n}),m=G(s),[x,g]=c.useReducer(Ge,{info:j,selectedIndex:i??a,tabs:[],panels:[]}),k=c.useMemo(()=>({selectedIndex:x.selectedIndex}),[x.selectedIndex]),C=z(l||(()=>{})),N=z(x.tabs),w=c.useMemo(()=>({orientation:u,activation:d,...x}),[u,d,x]),P=E(f=>(g({type:1,tab:f}),()=>g({type:2,tab:f}))),F=E(f=>(g({type:3,panel:f}),()=>g({type:4,panel:f}))),b=E(f=>{y.current!==f&&C.current(f),n||g({type:0,index:f})}),y=z(n?t.selectedIndex:x.selectedIndex),S=c.useMemo(()=>({registerTab:P,registerPanel:F,change:b}),[]);J(()=>{g({type:0,index:i??a})},[i]),J(()=>{if(y.current===void 0||x.tabs.length<=0)return;let f=B(x.tabs,_=>_.current);f.some((_,I)=>x.tabs[I]!==_)&&b(f.indexOf(x.tabs[y.current]))});let p={ref:m};return q.createElement(Le,null,q.createElement(Y.Provider,{value:S},q.createElement(K.Provider,{value:w},w.tabs.length<=0&&q.createElement(Me,{onFocus:()=>{var f,_;for(let I of N.current)if(((f=I.current)==null?void 0:f.tabIndex)===0)return(_=I.current)==null||_.focus(),!0;return!1}}),O({ourProps:p,theirProps:h,slot:k,defaultTag:We,name:"Tabs"}))))}let ze="div";function Ve(t,s){let{orientation:a,selectedIndex:r}=L("Tab.List"),o=G(s),l=c.useMemo(()=>({selectedIndex:r}),[r]);return O({ourProps:{ref:o,role:"tablist","aria-orientation":a},theirProps:t,slot:l,defaultTag:ze,name:"Tabs.List"})}let Je="button";function Ke(t,s){var a,r;let o=c.useId(),{id:l=`headlessui-tabs-tab-${o}`,disabled:i=!1,autoFocus:h=!1,...u}=t,{orientation:d,activation:n,selectedIndex:j,tabs:m,panels:x}=L("Tab"),g=Q("Tab"),k=L("Tab"),[C,N]=c.useState(null),w=c.useRef(null),P=G(w,s,N);J(()=>g.registerTab(w),[g,w]);let F=de("tabs"),b=m.indexOf(w);b===-1&&(b=F);let y=b===j,S=E(v=>{var D;let H=v();if(H===V.Success&&n==="auto"){let he=(D=ye(w))==null?void 0:D.activeElement,te=k.tabs.findIndex(ge=>ge.current===he);te!==-1&&g.change(te)}return H}),p=E(v=>{let D=m.map(H=>H.current).filter(Boolean);if(v.key===T.Space||v.key===T.Enter){v.preventDefault(),v.stopPropagation(),g.change(b);return}switch(v.key){case T.Home:case T.PageUp:return v.preventDefault(),v.stopPropagation(),S(()=>M(D,$.First));case T.End:case T.PageDown:return v.preventDefault(),v.stopPropagation(),S(()=>M(D,$.Last))}if(S(()=>U(d,{vertical(){return v.key===T.ArrowUp?M(D,$.Previous|$.WrapAround):v.key===T.ArrowDown?M(D,$.Next|$.WrapAround):V.Error},horizontal(){return v.key===T.ArrowLeft?M(D,$.Previous|$.WrapAround):v.key===T.ArrowRight?M(D,$.Next|$.WrapAround):V.Error}}))===V.Success)return v.preventDefault()}),f=c.useRef(!1),_=E(()=>{var v;f.current||(f.current=!0,(v=w.current)==null||v.focus({preventScroll:!0}),g.change(b),we(()=>{f.current=!1}))}),I=E(v=>{v.preventDefault()}),{isFocusVisible:X,focusProps:ce}=ae({autoFocus:h}),{isHovered:Z,hoverProps:ue}=fe({isDisabled:i}),{pressed:ee,pressProps:me}=je({disabled:i}),xe=c.useMemo(()=>({selected:y,hover:Z,active:ee,focus:X,autofocus:h,disabled:i}),[y,Z,X,ee,h,i]),pe=ne({ref:P,onKeyDown:p,onMouseDown:I,onClick:_,id:l,role:"tab",type:ve(t,C),"aria-controls":(r=(a=x[b])==null?void 0:a.current)==null?void 0:r.id,"aria-selected":y,tabIndex:y?0:-1,disabled:i||void 0,autoFocus:h},ce,ue,me);return O({ourProps:pe,theirProps:u,slot:xe,defaultTag:Je,name:"Tabs.Tab"})}let Ye="div";function Qe(t,s){let{selectedIndex:a}=L("Tab.Panels"),r=G(s),o=c.useMemo(()=>({selectedIndex:a}),[a]);return O({ourProps:{ref:r},theirProps:t,slot:o,defaultTag:Ye,name:"Tabs.Panels"})}let Xe="div",Ze=se.RenderStrategy|se.Static;function et(t,s){var a,r,o,l;let i=c.useId(),{id:h=`headlessui-tabs-panel-${i}`,tabIndex:u=0,...d}=t,{selectedIndex:n,tabs:j,panels:m}=L("Tab.Panel"),x=Q("Tab.Panel"),g=c.useRef(null),k=G(g,s);J(()=>x.registerPanel(g),[x,g]);let C=de("panels"),N=m.indexOf(g);N===-1&&(N=C);let w=N===n,{isFocusVisible:P,focusProps:F}=ae(),b=c.useMemo(()=>({selected:w,focus:P}),[w,P]),y=ne({ref:k,id:h,role:"tabpanel","aria-labelledby":(r=(a=j[N])==null?void 0:a.current)==null?void 0:r.id,tabIndex:w?u:-1},F);return!w&&((o=d.unmount)==null||o)&&!((l=d.static)!=null&&l)?q.createElement(ie,{"aria-hidden":"true",...y}):O({ourProps:y,theirProps:d,slot:b,defaultTag:Xe,features:Ze,visible:w,name:"Tabs.Panel"})}let tt=A(Ke),st=A(He),at=A(Ve),nt=A(Qe),rt=A(et),R=Object.assign(tt,{Group:st,List:at,Panels:nt,Panel:rt});const lt=({reports:t})=>{const{t:s}=W(),[a,r]=c.useState(""),[o,l]=c.useState(""),[i,h]=c.useState("asc"),[u,d]=c.useState(""),[n,j]=c.useState(""),[m,x]=c.useState(1),g=10,C=t.filter(p=>{const f=p.short_description.toLowerCase().includes(a.toLowerCase()),_=(!u||new Date(p.date)>=new Date(u))&&(!n||new Date(p.date)<=new Date(n));return f&&_}).sort((p,f)=>{if(!o)return 0;const _=p[o],I=f[o];return _<I?i==="asc"?-1:1:_>I?i==="asc"?1:-1:0}),N=m*g,w=N-g,P=C.slice(w,N),F=Math.ceil(C.length/g);console.log({currentReports:P});const b=p=>{const f=o===p&&i==="asc"?"desc":"asc";l(p),h(f)},y=p=>{x(p)},S=()=>{d(""),j("")};return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"mb-4 flex space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter",className:"block text-sm font-medium text-gray-700",children:s("filter_by_description")}),e.jsx("input",{id:"filter",type:"text",placeholder:s("filter_by_description"),value:a,onChange:p=>r(p.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700",children:s("start_date")}),e.jsx("input",{id:"startDate",type:"date",value:u,onChange:p=>d(p.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700",children:s("end_date")}),e.jsx("input",{id:"endDate",type:"date",value:n,onChange:p=>j(p.target.value),className:"border rounded px-2 py-1"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:S,className:"px-4 py-2 bg-gray-300 rounded",children:s("clear_date_range")})})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>b("date"),children:s("date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>b("technician_id.name"),children:s("technician")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>b("short_description"),children:s("short_description")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>b("status"),children:s("status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:P.map(p=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:re(p.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:p.technician_id.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:p.short_description}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${p.status==="completed"?"bg-green-100 text-green-800":p.status==="in_progress"?"bg-yellow-100 text-yellow-800":p.status==="planned"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s(p.status)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(Ne,{to:`/reports/${p._id}`,className:"text-indigo-600 hover:text-indigo-900",children:s("view")})})]},p._id))})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{onClick:()=>y(m-1),disabled:m===1,className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",children:s("previous")}),e.jsxs("span",{children:[s("page")," ",m," ",s("of")," ",F]}),e.jsx("button",{onClick:()=>y(m+1),disabled:m===F,className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",children:s("next")})]})]})},it=({activity:t,index:s,clients:a,worksites:r,products:o,users:l,handleActivityChange:i,removeActivity:h,appendMaterial:u})=>{const{t:d}=W();return e.jsxs("div",{className:"border p-4 mb-4 rounded",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-2",children:[d("activity")," ",s+1]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:`client_id_${s}`,children:d("client")}),e.jsxs("select",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`client_id_${s}`,name:"client_id",value:t.client_id,onChange:n=>i(s,n),required:!0,children:[e.jsx("option",{value:"",children:d("select_client")}),a.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:`worksite_${s}`,children:d("worksite")}),e.jsxs("select",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`worksite_${s}`,name:"worksite_id",value:t.worksite_id,onChange:n=>i(s,n),required:!0,children:[e.jsx("option",{value:"",children:d("select_worksite")}),r.filter(n=>n.client_id===t.client_id).map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:`assigned_technician_${s}`,children:d("assigned_technician")}),e.jsxs("select",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`assigned_technician_${s}`,name:"assigned_technician_id",value:t.assigned_technician_id,onChange:n=>i(s,n),required:!0,children:[e.jsx("option",{value:"",children:d("select_technician")}),l.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:`description_${s}`,children:d("description")}),e.jsx("textarea",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`description_${s}`,name:"description",value:t.description,onChange:n=>i(s,n),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:`travel_time_${s}`,children:[d("travel_time")," (",d("minutes"),")"]}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`travel_time_${s}`,type:"number",name:"travel_time",value:t.travel_time,onChange:n=>i(s,n),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:`work_time_${s}`,children:[d("work_time")," (",d("minutes"),")"]}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:`work_time_${s}`,type:"number",name:"work_time",value:t.work_time,onChange:n=>i(s,n),required:!0})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h4",{className:"text-md font-semibold mb-2",children:d("materials_used")}),t.materials_used.map((n,j)=>e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsx("div",{children:e.jsxs("select",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",name:"product_id",value:n.product_id,onChange:m=>i(s,m),required:!0,children:[e.jsx("option",{value:"",children:d("select_product")}),o.map(m=>e.jsx("option",{value:m._id,children:m.name},m._id))]})}),e.jsx("div",{children:e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",type:"number",name:"quantity",value:n.quantity,onChange:m=>i(s,m),required:!0})})]},j)),e.jsx("button",{type:"button",className:"mt-2 bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:()=>u(s),children:d("add_material")}),e.jsx("button",{type:"button",className:"mt-2 ml-2 bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:()=>h(s),children:d("remove_activity")})]})]})},ot=({report:t,onClose:s})=>{const{t:a}=W(),{getClientById:r,getWorksiteById:o,getProductById:l,getUserById:i}=ke(),h=u=>u.completed?e.jsx($e,{className:"text-green-500 text-2xl"}):e.jsx(Ie,{className:"text-yellow-500 text-2xl"});return e.jsx(Se,{onClose:s,children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white overflow-y-auto max-h-[80vh]",children:[e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:a("report_preview")}),e.jsx("p",{className:"text-gray-600",children:re(t.date)})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:e.jsxs("dl",{className:"sm:divide-y sm:divide-gray-200",children:[e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:a("technician")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.technician_id.name})]}),e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:a("status")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:a(t.status)})]})]})}),e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:a("activities")}),t.activities.map((u,d)=>{const n=r(u.client_id),j=o(u.worksite_id),m=i(u.assigned_technician_id);return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4 shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:[a("activity")," ",d+1]}),h(u)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:a("client")}),e.jsx("span",{className:"text-blue-600",children:n?n.name:a("unknown_client")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:a("worksite")}),e.jsx("span",{className:"text-blue-600",children:j?j.name:a("unknown_worksite")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"text-blue-500 mr-2"}),e.jsx("p",{className:"text-gray-600",children:u.description||a("no_description")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Fe,{className:"text-blue-500 mr-2"}),e.jsxs("p",{className:"text-gray-600",children:[u.work_time||0," ",a("minutes")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:a("intervention_type")}),e.jsx("p",{className:"text-gray-600",children:u.intervention_type||a("not_specified")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:a("travel_time")}),e.jsxs("p",{className:"text-gray-600",children:[u.travel_time||0," ",a("minutes")]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:a("assigned_technician")}),e.jsx("p",{className:"text-gray-600",children:m?m.name:a("not_assigned")})]}),u.materials_used&&u.materials_used.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:a("materials_used")}),e.jsx("ul",{className:"list-disc list-inside",children:u.materials_used.map((x,g)=>{const k=l(x.product_id);return e.jsxs("li",{className:"text-gray-600",children:[k?k.name:a("unknown_product")," - ",x.quantity||0," ",a("units")]},g)})})]})]},u._id)})]}),e.jsxs("div",{className:"flex items-center mb-4 px-4 py-5 sm:px-6",children:[e.jsx(Te,{className:"text-blue-500 mr-2"}),e.jsxs("p",{className:"text-gray-600",children:[a("lunch_location"),": ",t.lunch_location||a("not_specified")]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:a("close")})})]})})},dt=({initialData:t,onFormDataChange:s})=>{const{t:a}=W(),[r,o]=c.useState(!1),{formData:l,clients:i,worksites:h,products:u,users:d,isLoading:n,error:j,handleChange:m,handleActivityChange:x,handleSubmit:g,appendActivity:k,removeActivity:C,validateForm:N,appendMaterial:w}=Pe(t,s),{showFlashMessage:P}=_e(),F=()=>{const b=N();if(Object.keys(b).length===0)o(!0);else{const y=Object.values(b)[0];P(y,"error")}};return n?e.jsx("div",{children:a("loading")}):j?e.jsx("div",{className:"text-red-500",children:j}):e.jsxs("form",{onSubmit:g,className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"date",children:a("date")}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"date",type:"date",name:"date",value:l.date,onChange:m,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"technician",children:a("technician")}),e.jsxs("select",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"technician",name:"technician_id",value:l.technician_id,onChange:m,required:!0,children:[e.jsx("option",{value:"",children:a("select_technician")}),d.map(b=>e.jsx("option",{value:b._id,children:b.name},b._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"lunch_location",children:a("lunch_location")}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"lunch_location",type:"text",name:"lunch_location",value:l.lunch_location,onChange:m,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"status",children:a("status")}),e.jsxs("select",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"status",name:"status",value:l.status,onChange:m,required:!0,children:[e.jsx("option",{value:"",children:a("select_status")}),e.jsx("option",{value:"planned",children:a("planned")}),e.jsx("option",{value:"in_progress",children:a("in_progress")}),e.jsx("option",{value:"completed",children:a("completed")})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-gray-700 text-sm font-bold mb-2",htmlFor:"short_description",children:a("short_description")}),e.jsx("input",{className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",id:"short_description",type:"text",name:"short_description",value:l.short_description,onChange:m,required:!0})]}),l.activities.map((b,y)=>e.jsx(it,{activity:b,index:y,clients:i,worksites:h,products:u,users:d,handleActivityChange:x,appendMaterial:w,removeActivity:()=>C(y)},y)),e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsx("button",{type:"button",className:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",onClick:k,children:a("add_activity")}),e.jsxs("div",{children:[e.jsx("button",{type:"button",className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2",onClick:F,children:a("preview")}),e.jsx("button",{type:"submit",className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:a("submit")})]})]}),r&&e.jsx(ot,{report:l,onClose:()=>o(!1)})]})},jt=()=>{const{t}=W(),[s,a]=c.useState([]),[r,o]=c.useState(!0),[l,i]=c.useState(null),[h,u]=c.useState(0),[d,n]=c.useState(null);c.useEffect(()=>{j()},[]);const j=async()=>{o(!0);try{const x=await De();a(x),i(null)}catch(x){i(t("error_fetching_reports")),console.error(t("error_fetching_reports"),x)}finally{o(!1)}},m=x=>{n(x)};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("reports")}),e.jsxs(R.Group,{selectedIndex:h,onChange:u,children:[e.jsxs(R.List,{className:"flex space-x-1 rounded-xl bg-blue-900/20 p-1 mb-6",children:[e.jsx(R,{className:({selected:x})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
             ${x?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("report_list")}),e.jsx(R,{className:({selected:x})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
             ${x?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("create_report")})]}),e.jsxs(R.Panels,{children:[e.jsx(R.Panel,{children:r?e.jsx("p",{children:t("loading_reports")}):l?e.jsx("p",{className:"text-red-500",children:l}):e.jsx(lt,{reports:s})}),e.jsx(R.Panel,{children:e.jsx(dt,{initialData:d,onFormDataChange:m})})]})]})]})};export{jt as default};
