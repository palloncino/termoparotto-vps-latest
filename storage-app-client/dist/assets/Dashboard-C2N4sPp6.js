import{u as H,j as e,F as N,a as M,b as J,c as C,d as V,e as _,f as k,g as q,h as K,i as Y,k as G}from"./index-BzZmYvs7.js";import{r as c}from"./vendor-8AKiDlQN.js";import{g as Q}from"./reportService-B3mXqAmG.js";import{g as X}from"./clientService-Crb_EkMB.js";import{g as Z}from"./usersService-ChNqahqa.js";import{g as ee}from"./worksiteService-Dk965U3x.js";import{a as se}from"./api-Bb4ObIZy.js";import"./router-BmsaeIqg.js";const te=async()=>(await se.get("/health")).data,me=()=>{var $,S;const{t:T}=H(),[s,z]=c.useState(null),[l,F]=c.useState(null),[I,U]=c.useState(!0),[a,h]=c.useState(null),[g,y]=c.useState(!1),[w,v]=c.useState(null),[B,p]=c.useState(!1),[f,j]=c.useState(null);c.useEffect(()=>{E()},[]);const R=(r,o)=>{j({message:r,type:o}),setTimeout(()=>j(null),5e3)},E=async()=>{var r;try{const[o,m,i,n,t]=await Promise.all([Q(),X(),Z(),ee(),te()]),x=new Date,D=new Date(x.getFullYear(),x.getMonth(),1),L=new Date(x.getFullYear(),x.getMonth()-1,1),O=o.filter(d=>new Date(d.date)>=D).length,P=o.filter(d=>{const u=new Date(d.date);return u>=L&&u<D}).length;z({totalReports:o.length,totalClients:m.clients?m.clients.length:m.data?m.data.length:0,totalUsers:i.users?i.users.length:i.data?i.data.length:0,totalWorksites:n.worksites?n.worksites.length:n.data?n.data.length:0,reportsThisMonth:O,reportsLastMonth:P}),F(t),console.clear(),console.log("%c🚀 TERMOPAROTTO HEALTH CHECK","color: #374151; font-size: 14px; font-weight: bold; padding: 4px 0;"),console.log("%c📊 System Information","color: #374151; font-size: 12px; font-weight: 600; margin-top: 8px;"),console.log(`%c  Name: %c${t.name}`,"color: #6B7280;","color: #111827; font-weight: 500;"),console.log(`%c  Server: %cv${t.version.server} %c| Client: %cv${t.version.client}`,"color: #6B7280;","color: #059669; font-weight: 500;","color: #6B7280;","color: #059669; font-weight: 500;"),console.log(`%c  Environment: %c${t.environment}`,"color: #6B7280;",t.environment==="production"?"color: #DC2626; font-weight: 500;":"color: #D97706; font-weight: 500;"),console.log(`%c  Uptime: %c${t.uptime} %c(${t.uptimeSeconds}s)`,"color: #6B7280;","color: #374151; font-weight: 500;","color: #9CA3AF;"),console.log("%c💾 Database Status","color: #374151; font-size: 12px; font-weight: 600; margin-top: 8px;"),console.log(`%c  Status: %c${t.database.status} %c(${t.database.type})`,"color: #6B7280;",t.database.status==="connected"?"color: #059669; font-weight: 500;":"color: #DC2626; font-weight: 500;","color: #9CA3AF;"),console.log("%c🎯 Memory Usage","color: #374151; font-size: 12px; font-weight: 600; margin-top: 8px;"),console.log(`%c  RSS: %c${t.memory.rss}MB %c| Heap: %c${t.memory.heapUsed}/${t.memory.heapTotal}MB %c| External: %c${t.memory.external}MB`,"color: #6B7280;","color: #374151; font-weight: 500;","color: #6B7280;","color: #374151; font-weight: 500;","color: #6B7280;","color: #374151; font-weight: 500;"),(r=t.deployment)!=null&&r.git&&(console.log("%c🔧 Deployment Info","color: #374151; font-size: 12px; font-weight: 600; margin-top: 8px;"),console.log(`%c  Commit: %c${t.deployment.git.hash} %c(${t.deployment.git.branch})`,"color: #6B7280;","color: #111827; font-family: monospace; font-weight: 500;","color: #374151; font-weight: 500;"),console.log(`%c  Date: %c${t.deployment.git.lastCommit}`,"color: #6B7280;","color: #059669; font-weight: 500;"),t.deployment.git.lastCommitMessage&&console.log(`%c  Message: %c"${t.deployment.git.lastCommitMessage}"`,"color: #6B7280;","color: #374151; font-style: italic;")),console.log("%c🖥️  Server Details","color: #374151; font-size: 12px; font-weight: 600; margin-top: 8px;"),console.log(`%c  Node.js: %c${t.server.nodeVersion} %c| Platform: %c${t.server.platform} %c| Arch: %c${t.server.arch}`,"color: #6B7280;","color: #059669; font-weight: 500;","color: #6B7280;","color: #D97706; font-weight: 500;","color: #6B7280;","color: #374151; font-weight: 500;"),console.log(`%c  Author: %c${t.author.name} %c<${t.author.email}>`,"color: #6B7280;","color: #111827; font-weight: 500;","color: #9CA3AF;"),console.log(`%c  Timestamp: %c${new Date(t.timestamp).toLocaleString("it-IT")}`,"color: #6B7280;","color: #374151; font-weight: 500;"),console.log("%c────────────────────────────────────────────────────────────","color: #E5E7EB;");const A=localStorage.getItem("dashboard_analysis");if(A)try{const d=JSON.parse(A),u=new Date(d.lastUpdated),W=new Date(Date.now()-24*60*60*1e3);if(u>W){h(d);return}}catch(d){console.error("Error parsing cached analysis:",d)}b()}catch(o){console.error("Error fetching dashboard data:",o)}finally{U(!1)}},b=async(r=!1)=>{if(!s)return;const o=`dashboard_analysis_${JSON.stringify(s)}`,m=localStorage.getItem(o);if(!r&&m)try{const i=JSON.parse(m),n=new Date(i.lastUpdated),t=new Date(Date.now()-24*60*60*1e3);if(n>t){h(i);return}}catch(i){console.error("Error parsing cached analysis:",i)}y(!0),v(null);try{const i={metrics:{totalClients:s.totalClients,totalUsers:s.totalUsers,adminRatio:.2,totalProducts:0,averageProductPrice:0,totalWorksites:s.totalWorksites,activeWorksitesRatio:.8,totalReports:s.totalReports,completionRate:.7},context:`Dashboard analysis for ${new Date().toLocaleDateString("it-IT")}`},n=await fetch("http://termoparotto.micro-cloud.it:16788/api/ai/analyze-dashboard",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const t=await n.json(),x={summary:t.summary||"Analisi non disponibile",insights:t.insights||[],recommendations:t.recommendations||[],trends:t.trends||[],lastUpdated:new Date().toISOString(),source:"deepseek"};h(x),localStorage.setItem(o,JSON.stringify(x)),R("Analisi AI completata con successo!","success")}catch(i){console.error("Error analyzing dashboard data:",i),v("Errore durante l'analisi AI. Riprova più tardi.");const n={summary:`Dashboard con ${s.totalReports} rapporti, ${s.totalClients} clienti, ${s.totalUsers} utenti e ${s.totalWorksites} cantieri. ${s.reportsThisMonth} rapporti questo mese.`,insights:[`Gestione di ${s.totalReports} rapporti totali`,`${s.totalClients} clienti attivi`,`${s.totalUsers} utenti nel sistema`,`${s.totalWorksites} cantieri operativi`],recommendations:["Monitora regolarmente i rapporti mensili","Verifica la distribuzione dei carichi di lavoro","Analizza le tendenze dei cantieri"],trends:[`Rapporti questo mese: ${s.reportsThisMonth}`,`Rapporti scorso mese: ${s.reportsLastMonth}`,`Variazione: ${s.reportsThisMonth-s.reportsLastMonth>0?"+":""}${s.reportsThisMonth-s.reportsLastMonth}`],lastUpdated:new Date().toISOString(),source:"local"};h(n),localStorage.setItem(o,JSON.stringify(n))}finally{y(!1)}};return I?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(N,{className:"animate-spin text-4xl text-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Caricamento dashboard..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[f&&e.jsx("div",{className:`fixed top-4 right-4 p-4 rounded-lg shadow-lg z-50 max-w-sm ${f.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"}`,children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:f.message}),e.jsx("button",{onClick:()=>j(null),className:"ml-4 text-white hover:text-gray-200 focus:outline-none",children:"✕"})]})}),e.jsx("div",{className:"bg-white border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Panoramica generale del sistema"})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-6",children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-50 to-purple-50 border border-indigo-200 rounded-lg p-3 shadow-sm",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(M,{className:"text-xl text-indigo-600"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-indigo-800 text-sm",children:"Analisi AI Dashboard"}),e.jsx("p",{className:"text-xs text-indigo-600",children:a?`Ultimo aggiornamento: ${new Date(a.lastUpdated).toLocaleDateString("it-IT")}`:"Nessuna analisi disponibile"})]}),a&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-indigo-600 text-sm",children:"📊"}),e.jsx("span",{className:"text-xs text-indigo-700 font-medium",children:"Analisi Disponibile"}),e.jsx("span",{className:"text-xs text-indigo-500 bg-indigo-100 px-2 py-1 rounded-full",children:a.source==="deepseek"?"DeepSeek AI":"Locale"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[a&&e.jsxs("button",{onClick:()=>p(!0),className:"px-2 py-1.5 text-xs bg-indigo-100 text-indigo-700 rounded hover:bg-indigo-200 transition-colors flex items-center space-x-1",children:[e.jsx(J,{className:"text-indigo-600 text-xs"}),e.jsx("span",{children:"Visualizza"})]}),e.jsx("button",{onClick:()=>b(!!a),disabled:g,className:`px-3 py-1.5 text-xs rounded font-medium transition-all duration-200 ${g?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700 hover:shadow-md"}`,children:g?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"inline animate-spin mr-1"}),"Analizzando..."]}):a?e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"inline mr-1"}),"Aggiorna"]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"inline mr-1"}),"Inizia"]})})]})]})}),w&&e.jsx("div",{className:"mt-2 bg-red-50 border border-red-200 rounded-lg p-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-red-600 mr-2",children:"❌"}),e.jsx("p",{className:"text-red-800 text-xs font-medium",children:w})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 rounded-lg",children:e.jsx(_,{className:"text-blue-600 text-xl"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rapporti Totali"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(s==null?void 0:s.totalReports)||0})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(k,{className:"text-green-600 text-xl"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Clienti"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(s==null?void 0:s.totalClients)||0})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-purple-100 rounded-lg",children:e.jsx(k,{className:"text-purple-600 text-xl"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Utenti"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(s==null?void 0:s.totalUsers)||0})]})]})}),e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-orange-100 rounded-lg",children:e.jsx(q,{className:"text-orange-600 text-xl"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Cantieri"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:(s==null?void 0:s.totalWorksites)||0})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-3",children:"Rapporti Mensili"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Questo mese:"}),e.jsx("span",{className:"text-lg font-semibold text-blue-600",children:(s==null?void 0:s.reportsThisMonth)||0})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Scorso mese:"}),e.jsx("span",{className:"text-lg font-semibold text-gray-600",children:(s==null?void 0:s.reportsLastMonth)||0})]}),e.jsx("div",{className:"pt-2 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Variazione:"}),e.jsxs("span",{className:`text-sm font-medium ${((s==null?void 0:s.reportsThisMonth)||0)-((s==null?void 0:s.reportsLastMonth)||0)>=0?"text-green-600":"text-red-600"}`,children:[((s==null?void 0:s.reportsThisMonth)||0)-((s==null?void 0:s.reportsLastMonth)||0)>=0?"+":"",((s==null?void 0:s.reportsThisMonth)||0)-((s==null?void 0:s.reportsLastMonth)||0)]})]})})]})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[e.jsx(K,{className:"text-blue-600"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Sistema"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Versione:"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["v",(($=l==null?void 0:l.version)==null?void 0:$.server)||"1.0.0"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Stato:"}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${(l==null?void 0:l.status)==="ok"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:[e.jsx(Y,{className:"mr-1"}),(l==null?void 0:l.status)==="ok"?"Operativo":"Errore"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Ultimo aggiornamento:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900",children:(S=l==null?void 0:l.deployment)!=null&&S.lastCommit?new Date(l.deployment.lastCommit).toLocaleDateString("it-IT"):"N/A"})]})]})]})]})]}),B&&a&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",onClick:()=>p(!1),children:e.jsxs("div",{className:"bg-white rounded-xl shadow-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto",onClick:r=>r.stopPropagation(),children:[e.jsx("div",{className:"bg-gradient-to-r from-indigo-600 to-purple-600 px-6 py-4 rounded-t-xl",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(M,{className:"text-2xl text-white"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-white",children:"Analisi AI Dashboard"}),e.jsxs("p",{className:"text-indigo-100 text-sm",children:["Ultimo aggiornamento: ",new Date(a.lastUpdated).toLocaleDateString("it-IT")]})]})]}),e.jsx("button",{onClick:()=>p(!1),className:"text-white hover:text-indigo-200 transition-colors",children:e.jsx(G,{className:"text-xl"})})]})}),e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"Riepilogo"}),e.jsx("p",{className:"text-blue-700",children:a.summary})]}),a.insights&&a.insights.length>0&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Insights"}),e.jsx("ul",{className:"space-y-2",children:a.insights.map((r,o)=>e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-blue-500 mt-1",children:"•"}),e.jsx("span",{className:"text-gray-700 text-sm",children:r})]},o))})]}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Raccomandazioni"}),e.jsx("ul",{className:"space-y-2",children:a.recommendations.map((r,o)=>e.jsxs("li",{className:"flex items-start space-x-2",children:[e.jsx("span",{className:"text-green-500 mt-1",children:"•"}),e.jsx("span",{className:"text-gray-700 text-sm",children:r})]},o))})]})]}),a.trends&&a.trends.length>0&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-lg p-4",children:[e.jsx("h3",{className:"font-semibold text-gray-800 mb-3",children:"Tendenze"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:a.trends.map((r,o)=>e.jsx("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-700 text-sm",children:r})},o))})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-500",children:"Fonte:"}),e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${a.source==="deepseek"?"bg-indigo-100 text-indigo-800":"bg-gray-100 text-gray-800"}`,children:a.source==="deepseek"?"DeepSeek AI":"Analisi Locale"})]}),e.jsx("button",{onClick:()=>{p(!1),b(!0)},disabled:g,className:`px-4 py-2 rounded-lg font-medium transition-colors ${g?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-indigo-600 text-white hover:bg-indigo-700"}`,children:g?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"inline animate-spin mr-2"}),"Aggiornando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(C,{className:"inline mr-2"}),"Aggiorna Analisi"]})})]})]})]})})]})};export{me as default};
