import{l as ee,m as K,u as Z,j as e,x as z,X,n as se,Y as S,Z as te,H as Y,B as O,$ as re,r as ae,z as ie,A as le,a0 as de,e as ne,E as G,D as ce,a1 as V}from"./index-BzZmYvs7.js";import{r as E}from"./vendor-8AKiDlQN.js";import{g as oe}from"./clientService-Crb_EkMB.js";import{g as me}from"./productsService-CuuFniz7.js";import{c as xe,a as ue}from"./reportService-B3mXqAmG.js";import{g as he}from"./usersService-ChNqahqa.js";import{g as _e}from"./worksiteService-Dk965U3x.js";import{u as ge,a as fe}from"./router-BmsaeIqg.js";import{f as pe,a as J}from"./formatDate-Dk0xWO1M.js";const be=()=>{const{user:t}=ee(),{showFlashMessage:s}=K(),[g,h]=E.useState({header:{date:new Date().toISOString().split("T")[0],author_id:(t==null?void 0:t._id)||"",status:"DRAFT",lunch_location:""},activities:[{_id:"hash_"+Math.random().toString(36).substr(2,9),client_id:"",worksite_id:"",completed:!1,travel_time_hours:0,travel_time:0,work_time:0,valid_travel_time:"manual",intervention_type:{da_preventivo:!1,in_economia:!1,sopralluogo:!1},assigned_technician_id:(t==null?void 0:t._id)||"",tasks:[{assigned_technician_ids:t!=null&&t._id?[t._id]:[],work_hours:0,task_description:"",intervention_type:{da_preventivo:!1,in_economia:!1,sopralluogo:!1},materials_used:[],material_unloading:!1,material_unloading_hours:0}]}]}),[y,R]=E.useState([]),[q,C]=E.useState([]),[v,w]=E.useState([]),[B,P]=E.useState([]),[W,U]=E.useState(!0),{t:_}=Z(),D=ge();E.useEffect(()=>{(async()=>{U(!0);try{const[n,c,l,d]=await Promise.all([oe(),_e(),me(1,{searchText:"",type:""}),he()]);R(n.clients),w(l.products),P(d.users);const a=c.map(m=>({...m,client_id:m.client_id||m.clientId||null}));C(a)}catch(n){const c=n instanceof Error?n.message:"An error occurred";s(c,"error")}finally{U(!1)}})()},[]),E.useEffect(()=>{localStorage.setItem("formData",JSON.stringify(g))},[g]),E.useEffect(()=>{const r=localStorage.getItem("scrollY");r&&window.scrollTo(0,parseInt(r,10))},[]);const i=r=>{const{name:n,value:c}=r.target;h(l=>l.header?{...l,header:{...l.header,[n]:c}}:l)},o=(r,n,c)=>{const l=n.split("."),d={...r};let a=d;for(let x=0;x<l.length-1;x++){const p=l[x],b=p.match(/(\w+)\[(\d+)\]/);if(b){const j=b[1],F=parseInt(b[2],10);a[j]||(a[j]=[]),a[j]=[...a[j]],a[j][F]||(a[j][F]={}),a[j][F]={...a[j][F]},a=a[j][F]}else a[p]||(a[p]={}),a[p]={...a[p]},a=a[p]}const m=l[l.length-1];return a[m]=c,d},N=(r,n,c)=>{h(l=>{const d=l.activities?[...l.activities]:[],a=d[r],m=o(a,n,c);return d[r]=m,{...l,activities:d}})},k=()=>{h(r=>({...r,activities:[...r.activities||[],{_id:"hash_"+Math.random().toString(36).substr(2,9),client_id:"",worksite_id:"",completed:!1,travel_time_hours:0,travel_time:0,work_time:0,valid_travel_time:"manual",intervention_type:{da_preventivo:!1,in_economia:!1,sopralluogo:!1},assigned_technician_id:(t==null?void 0:t._id)||"",tasks:[{assigned_technician_ids:t!=null&&t._id?[t._id]:[],work_hours:0,task_description:"",intervention_type:{da_preventivo:!1,in_economia:!0,sopralluogo:!1},materials_used:[],material_unloading:!1,material_unloading_hours:0}]}]}))},M=r=>{h(n=>{var c;return{...n,activities:(c=n.activities)==null?void 0:c.filter((l,d)=>d!==r)}})},H=r=>{h(n=>{const c=n.activities?[...n.activities]:[],l={...c[r]};return l.tasks=[...l.tasks||[],{assigned_technician_ids:[],task_description:"",work_hours:0,intervention_type:{da_preventivo:!1,in_economia:!1,sopralluogo:!1},materials_used:[],material_unloading:!1,material_unloading_hours:0}],c[r]=l,{...n,activities:c}})},L=(r,n)=>{h(c=>{const l=c.activities?[...c.activities]:[],d={...l[r]};return d.tasks=d.tasks.filter((a,m)=>m!==n),l[r]=d,{...c,activities:l}})},u=(r,n)=>{h(c=>{const l=c.activities?[...c.activities]:[],d={...l[r]},a={...d.tasks[n]},m=a.materials_used||[],x=m[m.length-1];return!x||x.product_id&&x.product_id.trim()!==""?a.materials_used=[...m,{product_id:"",quantity:1}]:a.materials_used=[...m],d.tasks[n]=a,l[r]=d,{...c,activities:l}})},T=(r,n,c)=>{h(l=>{const d=l.activities?[...l.activities]:[],a={...d[r]},m={...a.tasks[n]};return m.materials_used=m.materials_used.filter((x,p)=>p!==c),a.tasks[n]=m,d[r]=a,{...l,activities:d}})},f=async r=>{var d,a,m;r.preventDefault();const n=$();if(Object.keys(n).length>0){const x=Object.values(n),b=x.slice(0,2).join(". "),j=x.length>2?` e altri ${x.length-2} errori`:"";s(`Errori di validazione: ${b}${j}. Controlla tutti i campi obbligatori.`,"error");return}if(!A()&&!window.confirm(_("proceed_without_material_message")))return;const l={...g,activities:(g.activities||[]).map(x=>({...x,tasks:x.tasks.map(p=>{const b={...p,materials_used:(p.materials_used||[]).filter(j=>j.product_id)};return b.intervention_status===""&&(b.intervention_status=void 0),b.payment_status===""&&(b.payment_status=void 0),b})}))};try{const x=await xe(l);if(x&&x._id)s(_("report_created_successfully"),"success"),D(`/reports/${x._id}?action=report_created_successfully`);else throw new Error("Created report ID not found")}catch(x){if(((d=x.response)==null?void 0:d.status)===400&&((m=(a=x.response)==null?void 0:a.data)==null?void 0:m.error)==="Validation Error"){const p=x.response.data.details,b=Object.values(p),F=b.slice(0,3).join(", "),Q=b.length>3?` e altri ${b.length-3} errori`:"";s(`Errore di validazione server: ${F}${Q}`,"error")}else s(_("error_creating_report"),"error")}},A=()=>{var r;return((r=g.activities)==null?void 0:r.some(n=>{var c;return(c=n.tasks)==null?void 0:c.some(l=>{var d;return(d=l.materials_used)==null?void 0:d.some(a=>a.product_id&&a.quantity>=1)})}))||!1},$=()=>{const r={},{header:n,activities:c}=g;if(n){if(!(c!=null&&c.length))return{header:"Please, add an activity"}}else return{header:"Please, complete the form"};return n.date||(r["header.date"]=_("date_required")),n.author_id||(r["header.author_id"]=_("author_required")),n.status||(r["header.status"]=_("status_required")),n.lunch_location||(r["header.lunch_location"]=_("lunch_location_required")),c.forEach((l,d)=>{if(l.client_id||(r[`activities[${d}].client_id`]=_("client_required")),l.worksite_id||(r[`activities[${d}].worksite_id`]=_("worksite_required")),l.valid_travel_time==="manual")(!l.travel_time_hours||l.travel_time_hours<=0)&&(r[`activities[${d}].travel_time_hours`]=_("invalid_travel_time_hours"));else if(l.valid_travel_time==="rules")if(!l.travel_time_rules_applied)r[`activities[${d}].travel_time_rules_applied`]=_("travel_time_rules_required");else{const{distance_km:a,travel_time_hours:m}=l.travel_time_rules_applied;(a<=0||m<=0)&&(r[`activities[${d}].travel_time_rules_applied`]=_("invalid_travel_time_rules"))}l.tasks.forEach((a,m)=>{(!a.task_description||a.task_description.trim()==="")&&(r[`activities[${d}].tasks[${m}].task_description`]=_("task_description_required")),a.work_hours<=0&&(r[`activities[${d}].tasks[${m}].work_hours`]=_("invalid_work_hours")),!a.intervention_type.da_preventivo&&!a.intervention_type.in_economia&&!a.intervention_type.sopralluogo&&(r[`activities[${d}].tasks[${m}].intervention_type`]=_("intervention_type_required")),a.materials_used.forEach((x,p)=>{x.product_id&&x.product_id.toString().trim()!==""&&x.quantity<1&&(r[`activities[${d}].tasks[${m}].materials_used[${p}].quantity`]=_("invalid_material_quantity"))})})}),r};return{formData:g,clients:y,worksites:q,products:v,users:B,isLoading:W,handleHeaderChange:i,handleActivityChange:N,handleSubmit:f,appendActivity:k,removeActivity:M,appendTask:H,removeTask:L,appendMaterial:u,removeMaterial:T,validateForm:$,checkIfHasMaterials:A}};function I(t,s){const g=Math.floor(t),h=Math.round((t-g)*60);let y="";return g>0&&(y+=`${g} ${s(g===1?"hour":"hours")}`),h>0&&(y&&(y+=" "),y+=`${h} ${s(h===1?"minute":"minutes")}`),y||(y=s("no_time")),y}const je=()=>{const{clients:t,worksites:s,products:g,users:h}=be();return{getClientById:v=>t.find(w=>w._id===v),getWorksiteById:v=>s.find(w=>w._id===v),getProductById:v=>g.find(w=>w._id===v),getUserById:v=>h.find(w=>w._id===v)}},Me=({report:t})=>{const{t:s}=Z(),g=fe(),{showFlashMessage:h}=K(),{getClientById:y,getWorksiteById:R,getProductById:q,getUserById:C}=je(),[v,w]=E.useState(!1),B=i=>i.filter(o=>!o.product_id||o.product_id===null?!1:typeof o.product_id=="object"?o.product_id._id&&o.product_id._id.trim()!=="":o.product_id.trim()!==""),P=i=>i.filter(o=>!o.product_id||o.product_id===null?!0:typeof o.product_id=="object"?!o.product_id._id||o.product_id._id.trim()==="":o.product_id.trim()==="").length;E.useEffect(()=>{new URLSearchParams(g.search).get("action")==="report_created_successfully"&&h(s("report_created_successfully"),"success")},[g,h,s]);const W=async()=>{w(!0);try{const i=await ue({reportId:t._id}),o=new Blob([i],{type:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"}),N=URL.createObjectURL(o),k=document.createElement("a");k.href=N,k.setAttribute("download",`report-${t._id}.xlsx`),document.body.appendChild(k),k.click(),document.body.removeChild(k),URL.revokeObjectURL(N),h(s("report_exported_successfully"),"success")}catch{h(s("error_exporting_xlsx"),"error")}finally{w(!1)}},U=i=>i.completed?e.jsx(Y,{className:"text-green-500 text-2xl"}):e.jsx(V,{className:"text-yellow-500 text-2xl"}),_=typeof t.technician_id=="object"&&t.technician_id!==null?t.technician_id.name:"",D=t.activities||[];return e.jsxs("div",{className:"max-w-7xl mx-auto bg-gradient-to-br from-gray-50 to-gray-100 min-h-screen",children:[e.jsx("div",{className:"bg-white border-b border-gray-200 shadow-sm px-6 py-8",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-lg",children:e.jsx(z,{className:"text-3xl text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:s("report_details")}),e.jsxs("div",{className:"flex items-center space-x-2 mt-2 text-gray-600",children:[e.jsx(X,{className:"text-lg"}),e.jsx("p",{className:"text-lg",children:t.date?pe(t.date,s):""})]})]})]}),e.jsxs("button",{onClick:W,disabled:v,className:`inline-flex items-center space-x-2 px-6 py-3 rounded-lg font-semibold transition-colors ${v?"bg-gray-400 cursor-not-allowed text-white":"bg-blue-600 text-white hover:bg-blue-700 shadow-sm"}`,children:[e.jsx(se,{className:"text-lg"}),e.jsx("span",{children:s(v?"exporting":"export_xlsx")})]})]})}),e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl p-6 mb-8 text-white shadow-lg",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:D.length}),e.jsx("div",{className:"text-blue-100 text-sm",children:s("activities","Activities")})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold",children:D.reduce((i,o)=>{var N;return i+(((N=o.tasks)==null?void 0:N.length)||0)},0)}),e.jsx("div",{className:"text-blue-100 text-sm",children:s("tasks","Tasks")})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[D.reduce((i,o)=>{var N;return i+(((N=o.tasks)==null?void 0:N.reduce((k,M)=>k+(M.work_hours||0),0))||0)},0),"h"]}),e.jsx("div",{className:"text-blue-100 text-sm",children:s("total_work_hours","Total Work Hours")})]}),e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"text-2xl font-bold",children:[D.reduce((i,o)=>i+(o.travel_time_hours||0),0),"h"]}),e.jsx("div",{className:"text-blue-100 text-sm",children:s("travel_time","Travel Time")})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(S,{className:"text-xl text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s("technician")})]}),_?e.jsx("a",{href:`/users/${typeof t.technician_id=="object"?t.technician_id._id:t.technician_id}`,className:"text-blue-600 hover:text-blue-800 font-medium text-lg transition-colors",children:_}):e.jsx("p",{className:"text-gray-500 text-lg",children:s("not_assigned")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"bg-emerald-100 p-2 rounded-lg",children:e.jsx(te,{className:"text-xl text-emerald-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s("status")})]}),e.jsxs("div",{className:`inline-flex items-center px-3 py-2 rounded-full text-sm font-medium ${t.status==="DRAFT"?"bg-yellow-100 text-yellow-800 border border-yellow-300":t.status==="COMPLETED"?"bg-green-100 text-green-800 border border-green-300":t.status==="IN_PROGRESS"?"bg-blue-100 text-blue-800 border border-blue-300":"bg-gray-100 text-gray-800 border border-gray-300"}`,children:[t.status==="DRAFT"&&e.jsx(z,{className:"mr-1"}),t.status==="COMPLETED"&&e.jsx(Y,{className:"mr-1"}),t.status==="IN_PROGRESS"&&e.jsx(O,{className:"mr-1"}),t.status?t.status==="DRAFT"?s("draft","Draft"):s(t.status):s("not_specified")]})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"bg-orange-100 p-2 rounded-lg",children:e.jsx(re,{className:"text-xl text-orange-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s("lunch_location")})]}),e.jsx("p",{className:"text-gray-700 text-lg",children:t.lunch_location||s("not_specified")})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(X,{className:"text-xl text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s("created")})]}),e.jsx("p",{className:"text-gray-700 text-lg",children:t.created?(()=>{const{text:i,isToday:o}=J(t.created?String(t.created):"",s);return o?e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:i}):i})():s("not_specified")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(O,{className:"text-xl text-blue-600"})}),e.jsx("h3",{className:"text-lg font-semibold text-gray-800",children:s("last_updated")})]}),e.jsx("p",{className:"text-gray-700 text-lg",children:t.last_updated?(()=>{const{text:i,isToday:o}=J(t.last_updated?String(t.last_updated):"",s);return o?e.jsx("span",{className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-green-100 text-green-800",children:i}):i})():s("not_specified")})]})]})]}),e.jsx("div",{className:"px-6 pb-8",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden",children:[e.jsx("div",{className:"px-6 py-6 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(ae,{className:"text-2xl text-blue-600"})}),e.jsx("h3",{className:"text-2xl font-bold text-gray-800",children:s("activities")})]})}),e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"space-y-8",children:D.map((i,o)=>{var L;const N=typeof i.client_id=="object"&&i.client_id?i.client_id:y(i.client_id),k=typeof i.worksite_id=="object"&&i.worksite_id?i.worksite_id:R(i.worksite_id),M=C(i.assigned_technician_id),H=((L=i.tasks)==null?void 0:L.reduce((u,T)=>u+(T.work_hours||0),0))||0;return e.jsxs("div",{className:"bg-white rounded-xl p-6 border border-gray-200 shadow-sm hover:shadow-md transition-shadow duration-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"bg-blue-600 text-white rounded-lg w-10 h-10 flex items-center justify-center font-bold text-lg",children:o+1}),e.jsxs("h4",{className:"text-xl font-bold text-gray-800",children:[s("activity")," ",o+1]})]}),U(i)]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ie,{className:"text-blue-500"}),e.jsx("h5",{className:"font-semibold text-gray-700 text-sm",children:s("client")})]}),e.jsx("a",{href:`/clients/${typeof i.client_id=="object"?i.client_id._id:i.client_id}`,className:"text-blue-600 hover:text-blue-800 font-medium",children:N?N.name:s("unknown_client")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(le,{className:"text-blue-500"}),e.jsx("h5",{className:"font-semibold text-gray-700 text-sm",children:s("worksite")})]}),e.jsx("a",{href:`/worksites/${typeof i.worksite_id=="object"?i.worksite_id._id:i.worksite_id}`,className:"text-blue-600 hover:text-blue-800 font-medium",children:k?k.name:s("unknown_worksite")})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(O,{className:"text-blue-500"}),e.jsx("h5",{className:"font-semibold text-gray-700 text-sm",children:s("work_time")})]}),e.jsx("p",{className:"text-gray-800 font-medium",children:I(H,s)})]}),e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(de,{className:"text-blue-500"}),e.jsx("h5",{className:"font-semibold text-gray-700 text-sm",children:s("travel_time")})]}),e.jsx("p",{className:"text-gray-800 font-medium",children:I(i.travel_time_hours||0,s)})]})]}),M&&e.jsxs("div",{className:"bg-white rounded-lg p-4 border border-gray-200 mb-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(S,{className:"text-blue-500"}),e.jsx("h5",{className:"font-semibold text-gray-700",children:s("assigned_technician")})]}),e.jsx("a",{href:`/users/${i.assigned_technician_id}`,className:"text-blue-600 hover:text-blue-800 font-medium",children:M.name})]}),i.tasks&&i.tasks.length>0&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(ne,{className:"text-xl text-blue-500"}),e.jsx("h5",{className:"text-lg font-semibold text-gray-700",children:s("tasks")})]}),i.tasks.map((u,T)=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-5 border border-gray-200 hover:bg-gray-100 transition-colors duration-150",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx("div",{className:"bg-blue-600 text-white rounded-lg w-8 h-8 flex items-center justify-center font-bold text-sm",children:T+1}),e.jsx("h6",{className:"text-lg font-semibold text-gray-800",children:u.task_description||s("no_description")})]}),u.assigned_technician_ids&&u.assigned_technician_ids.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(S,{className:"text-blue-500"}),e.jsx("span",{className:"font-medium text-gray-700 text-sm",children:s("assigned_technicians")})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:u.assigned_technician_ids.map((f,A)=>{var $;return e.jsxs("a",{href:`/users/${typeof f=="object"?f._id:f}`,className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800 hover:bg-blue-200 transition-colors",children:[e.jsx(S,{className:"mr-1"}),typeof f=="object"?f.name:(($=C(f))==null?void 0:$.name)||f]},A)})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-blue-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"text-blue-500"}),e.jsxs("span",{className:"font-medium text-blue-800",children:[s("work_hours"),": ",I(u.work_hours||0,s)]})]})}),u.material_unloading&&e.jsx("div",{className:"bg-orange-50 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(G,{className:"text-orange-500"}),e.jsxs("span",{className:"font-medium text-orange-800",children:[s("material_unloading","Material Unloading"),": ",I(u.material_unloading_hours||0,s)]})]})}),u.intervention_type&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx(ce,{className:"text-gray-500"}),e.jsx("span",{className:"font-medium text-gray-700 text-sm",children:s("intervention_type")})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[u.intervention_type.da_preventivo&&e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-1 rounded-full border border-blue-300",children:s("da_preventivo")}),u.intervention_type.in_economia&&e.jsx("span",{className:"bg-emerald-100 text-emerald-800 text-xs font-semibold px-2 py-1 rounded-full border border-emerald-300",children:s("in_economia")}),u.intervention_type.sopralluogo&&e.jsx("span",{className:"bg-blue-100 text-blue-800 text-xs font-semibold px-2 py-1 rounded-full border border-blue-300",children:s("sopralluogo")})]})]})]}),u.materials_used&&u.materials_used.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(G,{className:"text-emerald-500 text-lg"}),e.jsx("h6",{className:"text-lg font-semibold text-gray-700",children:s("materials_used")}),e.jsxs("span",{className:"ml-2 inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800",children:[u.materials_used.length," ",s("items","items")]})]}),P(u.materials_used)>0&&e.jsx("div",{className:"mb-4 p-3 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(V,{className:"text-amber-500 mr-2"}),e.jsxs("p",{className:"text-amber-800 text-sm font-medium",children:[P(u.materials_used)," ",s("materials_without_product","materials without product specification")]})]})}),e.jsx("div",{className:"bg-emerald-50 rounded-lg p-4 border border-emerald-200",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-emerald-200",children:[e.jsx("th",{className:"py-2 text-left text-sm font-bold text-emerald-800",children:s("item_code")}),e.jsx("th",{className:"py-2 text-left text-sm font-bold text-emerald-800",children:s("description")}),e.jsx("th",{className:"py-2 text-right text-sm font-bold text-emerald-800",children:s("quantity")})]})}),e.jsxs("tbody",{children:[B(u.materials_used).map((f,A)=>{const $=typeof f.product_id=="object"&&f.product_id?f.product_id:q(f.product_id);return e.jsx("tr",{className:"border-b border-emerald-200 hover:bg-emerald-100",children:$?e.jsxs(e.Fragment,{children:[e.jsx("td",{className:"py-2 text-blue-600 hover:underline font-semibold",children:e.jsx("a",{href:`/products/${$._id}`,children:$.data_documento||$.descrizione})}),e.jsx("td",{className:"py-2 text-gray-700",children:$.descrizione}),e.jsx("td",{className:"py-2 text-right text-gray-600 font-semibold",children:f.quantity||0})]}):e.jsxs("td",{colSpan:3,className:"py-2 text-red-600 text-center",children:[s("product_not_found","Product not found")," (ID: ",f.product_id,")"]})},A)}),B(u.materials_used).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:3,className:"py-2 text-gray-500 text-center italic",children:s("no_materials_used","No materials used")})})]})]})})]})]},T))]})]},o)})})})]})})]})};export{Me as R,I as f,be as u};
