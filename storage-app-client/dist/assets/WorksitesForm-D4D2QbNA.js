import{u as w,j as e,L as N}from"./index-DSTbHML1.js";import{r as d}from"./vendor-8AKiDlQN.js";import{a as k}from"./clientService-qRF0PNhS.js";import{b as C,u as F,c as S}from"./worksiteService-DblhuvHv.js";import{c as W,u as q}from"./router-BmsaeIqg.js";import"./api-BqC8VQ1e.js";const P=()=>{const{t:s}=w(),{id:o}=W(),b=q(),[t,i]=d.useState(null),[f,g]=d.useState([]),[m,c]=d.useState(!0),[h,u]=d.useState(null),[x,_]=d.useState(null);d.useEffect(()=>{o?y(o):(i({client_id:"",name:"",address:"",description:"",is_active:!0,planned_hours:0,end_date:""}),c(!1)),v()},[o]);const y=async n=>{c(!0);try{const a=await C(n),r={...a,end_date:a.end_date?a.end_date.slice(0,10):""};i(r),u(null)}catch(a){u(s("error_fetching_worksite")),console.error("Error fetching worksite:",a)}finally{c(!1)}},v=async()=>{try{const n=await k();g(n.clients)}catch(n){console.error(s("error_fetching_clients"),n)}},j=async n=>{if(n.preventDefault(),!!t){c(!0);try{o?(console.log("Updating worksite with ID:",o,"Data:",t),await F(o,t)):(console.log("Creating new worksite with data:",t),await S(t)),_(s("worksite_saved_successfully")),setTimeout(()=>{b("/worksites")},2e3)}catch(a){u(s("error_saving_worksite")),console.error(s("error_saving_worksite"),a)}finally{c(!1)}}},l=n=>{const{name:a,value:r}=n.target;i(p=>p?{...p,[a]:a==="is_active"?r==="true":r}:null)};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6 text-center",children:s(o?"edit_worksite":"create_worksite")}),e.jsx("form",{onSubmit:j,className:"max-w-3xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-lg rounded-lg px-8 pt-6 pb-8 mb-6",children:[h&&e.jsx("div",{className:"mb-4 bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:h}),x&&e.jsx("div",{className:"mb-4 bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded",children:x}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"name",className:"block text-gray-700 text-sm font-bold mb-2",children:[s("name")," *"]}),e.jsx("input",{type:"text",id:"name",name:"name",value:(t==null?void 0:t.name)||"",onChange:l,required:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"address",className:"block text-gray-700 text-sm font-bold mb-2",children:[s("address")," *"]}),e.jsx("input",{type:"text",id:"address",name:"address",value:(t==null?void 0:t.address)||"",onChange:l,required:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"client_id",className:"block text-gray-700 text-sm font-bold mb-2",children:[s("client")," *"]}),e.jsxs("select",{id:"client_id",name:"client_id",value:(t==null?void 0:t.client_id)||"",onChange:l,required:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",children:[e.jsx("option",{value:"",children:s("select_client")}),f.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"is_active",className:"block text-gray-700 text-sm font-bold mb-2",children:s("active")}),e.jsxs("select",{id:"is_active",name:"is_active",value:t!=null&&t.is_active?"true":"false",onChange:l,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",children:[e.jsx("option",{value:"true",children:s("yes")}),e.jsx("option",{value:"false",children:s("no")})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"planned_hours",className:"block text-gray-700 text-sm font-bold mb-2",children:[s("planned_hours")," *"]}),e.jsx("input",{type:"number",id:"planned_hours",name:"planned_hours",value:(t==null?void 0:t.planned_hours)||0,onChange:n=>{const a=n.target.value;i(r=>r?{...r,planned_hours:a===""?0:Number(a)}:null)},onBlur:n=>{let a=Number(n.target.value);(isNaN(a)||a<0)&&(a=0),i(r=>r?{...r,planned_hours:a}:null)},required:!0,min:0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("label",{htmlFor:"end_date",className:"block text-gray-700 text-sm font-bold mb-2",children:[s("end_date")," *"]}),e.jsx("input",{type:"date",id:"end_date",name:"end_date",value:(t==null?void 0:t.end_date)||"",onChange:l,required:!0,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"description",className:"block text-gray-700 text-sm font-bold mb-2",children:s("description")}),e.jsx("textarea",{id:"description",name:"description",value:(t==null?void 0:t.description)||"",onChange:l,className:"shadow appearance-none border rounded w-full py-2 px-3 text-gray-700 leading-tight focus:outline-none focus:shadow-outline",rows:3})]}),e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:m?e.jsx(N,{}):s(o?"update_worksite":"create_worksite")})})]})})]})};export{P as default};
