import{W as G,H,r as o,f as ve,g as B,M as oe,s as Y,y as J,o as q,n as ee,$ as ue,h as _e,w as Ne,D as me,i as we,k as z,_ as W,T as Z,l as ke,m as $,P as O,F as S,t as Ce,u as K,b as Fe,j as e,L as Te,e as Pe}from"./index-C_78iEgf.js";import{f as $e,h as ce,i as re,j as Se,k as Ie,l as Ee,m as De,c as Me,n as Re,o as Le,p as qe,q as Ae}from"./index-BcCU1-XF.js";import{a as Oe}from"./usersService-CO4rIiT5.js";import{f as xe,u as Be,a as Ue}from"./useEntityData-DYOU86bn.js";import{T as te,B as Ge}from"./Tooltip-Coo1iyn6.js";import"./api-CLE4YwRs.js";import"./clientService-D0rezJXS.js";import"./productsService-DUq13sXT.js";import"./worksiteService-CfPHAhQs.js";let He="span";var pe=(t=>(t[t.None=1]="None",t[t.Focusable=2]="Focusable",t[t.Hidden=4]="Hidden",t))(pe||{});function We(t,r){var s;let{features:a=1,...d}=t,c={ref:r,"aria-hidden":(a&2)===2?!0:(s=d["aria-hidden"])!=null?s:void 0,hidden:(a&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(a&4)===4&&(a&2)!==2&&{display:"none"}}};return H({ourProps:c,theirProps:d,slot:{},defaultTag:He,name:"Hidden"})}let he=G(We);function ze({onFocus:t}){let[r,s]=o.useState(!0),a=ve();return r?B.createElement(he,{as:"button",type:"button",features:pe.Focusable,onFocus:d=>{d.preventDefault();let c,l=50;function p(){if(l--<=0){c&&cancelAnimationFrame(c);return}if(t()){if(cancelAnimationFrame(c),!a.current)return;s(!1);return}c=requestAnimationFrame(p)}c=requestAnimationFrame(p)}}):null}const ge=o.createContext(null);function Je(){return{groups:new Map,get(t,r){var s;let a=this.groups.get(t);a||(a=new Map,this.groups.set(t,a));let d=(s=a.get(r))!=null?s:0;a.set(r,d+1);let c=Array.from(a.keys()).indexOf(r);function l(){let p=a.get(r);p>1?a.set(r,p-1):a.delete(r)}return[c,l]}}}function Ke({children:t}){let r=o.useRef(Je());return o.createElement(ge.Provider,{value:r},t)}function be(t){let r=o.useContext(ge);if(!r)throw new Error("You must wrap your component in a <StableCollection>");let s=o.useId(),[a,d]=r.current.get(t,s);return o.useEffect(()=>d,[]),a}var Qe=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(Qe||{}),Ve=(t=>(t[t.Less=-1]="Less",t[t.Equal=0]="Equal",t[t.Greater=1]="Greater",t))(Ve||{}),Xe=(t=>(t[t.SetSelectedIndex=0]="SetSelectedIndex",t[t.RegisterTab=1]="RegisterTab",t[t.UnregisterTab=2]="UnregisterTab",t[t.RegisterPanel=3]="RegisterPanel",t[t.UnregisterPanel=4]="UnregisterPanel",t))(Xe||{});let Ye={0(t,r){var s;let a=W(t.tabs,i=>i.current),d=W(t.panels,i=>i.current),c=a.filter(i=>{var j;return!((j=i.current)!=null&&j.hasAttribute("disabled"))}),l={...t,tabs:a,panels:d};if(r.index<0||r.index>a.length-1){let i=z(Math.sign(r.index-t.selectedIndex),{[-1]:()=>1,0:()=>z(Math.sign(r.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(c.length===0)return l;let j=z(i,{0:()=>a.indexOf(c[0]),1:()=>a.indexOf(c[c.length-1])});return{...l,selectedIndex:j===-1?t.selectedIndex:j}}let p=a.slice(0,r.index),g=[...a.slice(r.index),...p].find(i=>c.includes(i));if(!g)return l;let v=(s=a.indexOf(g))!=null?s:t.selectedIndex;return v===-1&&(v=t.selectedIndex),{...l,selectedIndex:v}},1(t,r){if(t.tabs.includes(r.tab))return t;let s=t.tabs[t.selectedIndex],a=W([...t.tabs,r.tab],c=>c.current),d=t.selectedIndex;return t.info.current.isControlled||(d=a.indexOf(s),d===-1&&(d=t.selectedIndex)),{...t,tabs:a,selectedIndex:d}},2(t,r){return{...t,tabs:t.tabs.filter(s=>s!==r.tab)}},3(t,r){return t.panels.includes(r.panel)?t:{...t,panels:W([...t.panels,r.panel],s=>s.current)}},4(t,r){return{...t,panels:t.panels.filter(s=>s!==r.panel)}}},ae=o.createContext(null);ae.displayName="TabsDataContext";function U(t){let r=o.useContext(ae);if(r===null){let s=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,U),s}return r}let ne=o.createContext(null);ne.displayName="TabsActionsContext";function le(t){let r=o.useContext(ne);if(r===null){let s=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,le),s}return r}function Ze(t,r){return z(r.type,Ye,t,r)}let et="div";function tt(t,r){let{defaultIndex:s=0,vertical:a=!1,manual:d=!1,onChange:c,selectedIndex:l=null,...p}=t;const g=a?"vertical":"horizontal",v=d?"manual":"auto";let i=l!==null,j=Y({isControlled:i}),N=J(r),[m,b]=o.useReducer(Ze,{info:j,selectedIndex:l??s,tabs:[],panels:[]}),w=o.useMemo(()=>({selectedIndex:m.selectedIndex}),[m.selectedIndex]),T=Y(c||(()=>{})),n=Y(m.tabs),h=o.useMemo(()=>({orientation:g,activation:v,...m}),[g,v,m]),f=q(x=>(b({type:1,tab:x}),()=>b({type:2,tab:x}))),F=q(x=>(b({type:3,panel:x}),()=>b({type:4,panel:x}))),k=q(x=>{C.current!==x&&T.current(x),i||b({type:0,index:x})}),C=Y(i?t.selectedIndex:m.selectedIndex),I=o.useMemo(()=>({registerTab:f,registerPanel:F,change:k}),[]);ee(()=>{b({type:0,index:l??s})},[l]),ee(()=>{if(C.current===void 0||m.tabs.length<=0)return;let x=W(m.tabs,y=>y.current);x.some((y,E)=>m.tabs[E]!==y)&&k(x.indexOf(m.tabs[C.current]))});let R={ref:N};return B.createElement(Ke,null,B.createElement(ne.Provider,{value:I},B.createElement(ae.Provider,{value:h},h.tabs.length<=0&&B.createElement(ze,{onFocus:()=>{var x,y;for(let E of n.current)if(((x=E.current)==null?void 0:x.tabIndex)===0)return(y=E.current)==null||y.focus(),!0;return!1}}),H({ourProps:R,theirProps:p,slot:w,defaultTag:et,name:"Tabs"}))))}let st="div";function rt(t,r){let{orientation:s,selectedIndex:a}=U("Tab.List"),d=J(r),c=o.useMemo(()=>({selectedIndex:a}),[a]);return H({ourProps:{ref:d,role:"tablist","aria-orientation":s},theirProps:t,slot:c,defaultTag:st,name:"Tabs.List"})}let at="button";function nt(t,r){var s,a;let d=o.useId(),{id:c=`headlessui-tabs-tab-${d}`,disabled:l=!1,autoFocus:p=!1,...g}=t,{orientation:v,activation:i,selectedIndex:j,tabs:N,panels:m}=U("Tab"),b=le("Tab"),w=U("Tab"),[T,n]=o.useState(null),h=o.useRef(null),f=J(h,r,n);ee(()=>b.registerTab(h),[b,h]);let F=be("tabs"),k=N.indexOf(h);k===-1&&(k=F);let C=k===j,I=q(_=>{var M;let X=_();if(X===Z.Success&&i==="auto"){let ye=(M=ke(h))==null?void 0:M.activeElement,ie=w.tabs.findIndex(je=>je.current===ye);ie!==-1&&b.change(ie)}return X}),R=q(_=>{let M=N.map(X=>X.current).filter(Boolean);if(_.key===$.Space||_.key===$.Enter){_.preventDefault(),_.stopPropagation(),b.change(k);return}switch(_.key){case $.Home:case $.PageUp:return _.preventDefault(),_.stopPropagation(),I(()=>O(M,S.First));case $.End:case $.PageDown:return _.preventDefault(),_.stopPropagation(),I(()=>O(M,S.Last))}if(I(()=>z(v,{vertical(){return _.key===$.ArrowUp?O(M,S.Previous|S.WrapAround):_.key===$.ArrowDown?O(M,S.Next|S.WrapAround):Z.Error},horizontal(){return _.key===$.ArrowLeft?O(M,S.Previous|S.WrapAround):_.key===$.ArrowRight?O(M,S.Next|S.WrapAround):Z.Error}}))===Z.Success)return _.preventDefault()}),x=o.useRef(!1),y=q(()=>{var _;x.current||(x.current=!0,(_=h.current)==null||_.focus({preventScroll:!0}),b.change(k),Ce(()=>{x.current=!1}))}),E=q(_=>{_.preventDefault()}),{isFocusVisible:Q,focusProps:se}=ue({autoFocus:p}),{isHovered:V,hoverProps:u}=_e({isDisabled:l}),{pressed:P,pressProps:D}=Ne({disabled:l}),A=o.useMemo(()=>({selected:C,hover:V,active:P,focus:Q,autofocus:p,disabled:l}),[C,V,Q,P,p,l]),fe=me({ref:f,onKeyDown:R,onMouseDown:E,onClick:y,id:c,role:"tab",type:we(t,T),"aria-controls":(a=(s=m[k])==null?void 0:s.current)==null?void 0:a.id,"aria-selected":C,tabIndex:C?0:-1,disabled:l||void 0,autoFocus:p},se,u,D);return H({ourProps:fe,theirProps:g,slot:A,defaultTag:at,name:"Tabs.Tab"})}let lt="div";function it(t,r){let{selectedIndex:s}=U("Tab.Panels"),a=J(r),d=o.useMemo(()=>({selectedIndex:s}),[s]);return H({ourProps:{ref:a},theirProps:t,slot:d,defaultTag:lt,name:"Tabs.Panels"})}let ot="div",ct=oe.RenderStrategy|oe.Static;function dt(t,r){var s,a,d,c;let l=o.useId(),{id:p=`headlessui-tabs-panel-${l}`,tabIndex:g=0,...v}=t,{selectedIndex:i,tabs:j,panels:N}=U("Tab.Panel"),m=le("Tab.Panel"),b=o.useRef(null),w=J(b,r);ee(()=>m.registerPanel(b),[m,b]);let T=be("panels"),n=N.indexOf(b);n===-1&&(n=T);let h=n===i,{isFocusVisible:f,focusProps:F}=ue(),k=o.useMemo(()=>({selected:h,focus:f}),[h,f]),C=me({ref:w,id:p,role:"tabpanel","aria-labelledby":(a=(s=j[n])==null?void 0:s.current)==null?void 0:a.id,tabIndex:h?g:-1},F);return!h&&((d=v.unmount)==null||d)&&!((c=v.static)!=null&&c)?B.createElement(he,{"aria-hidden":"true",...C}):H({ourProps:C,theirProps:v,slot:k,defaultTag:ot,features:ct,visible:h,name:"Tabs.Panel"})}let ut=G(nt),mt=G(tt),xt=G(rt),pt=G(it),ht=G(dt),L=Object.assign(ut,{Group:mt,List:xt,Panels:pt,Panel:ht});const gt=({reports:t,onReportDeleted:r})=>{console.log({reports:t});const{t:s}=K(),{user:a}=Fe(),[d,c]=o.useState(""),[l,p]=o.useState(""),[g,v]=o.useState("asc"),[i,j]=o.useState(""),[N,m]=o.useState(""),[b,w]=o.useState(1),[T,n]=o.useState([]),h=10,f=t.filter(u=>{const P=u.short_description.toLowerCase().includes(d.toLowerCase()),D=(!i||new Date(u.date)>=new Date(i))&&(!N||new Date(u.date)<=new Date(N));return P&&D});o.useEffect(()=>{console.log(1.1),F()},[]);const F=async()=>{const u=await Oe();n(u.users)},k=f.sort((u,P)=>{if(!l)return 0;const D=u[l],A=P[l];return D<A?g==="asc"?-1:1:D>A?g==="asc"?1:-1:0}),C=b*h,I=C-h,R=k.slice(I,C),x=Math.ceil(k.length/h),y=u=>{const P=l===u&&g==="asc"?"desc":"asc";p(u),v(P)},E=u=>{w(u)},Q=()=>{j(""),m("")},se=async u=>{if(window.confirm(s("confirm_delete_report")))try{await $e(u),r==null||r()}catch(P){console.error("Error deleting report:",P)}},V=o.useCallback(u=>{var P,D;return typeof u.technician_id=="object"&&((P=u.technician_id)!=null&&P.name)?u.technician_id.name:u.technician_id?(D=T.find(A=>`${A._id}`==`${u.technician_id}`))==null?void 0:D.name:s("no_technician")},[T,s]);return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"mb-4 flex space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter",className:"block text-sm font-medium text-gray-700",children:s("filter_by_description")}),e.jsx("input",{id:"filter",type:"text",placeholder:s("filter_by_description"),value:d,onChange:u=>c(u.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700",children:s("start_date")}),e.jsx("input",{id:"startDate",type:"date",value:i,onChange:u=>j(u.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700",children:s("end_date")}),e.jsx("input",{id:"endDate",type:"date",value:N,onChange:u=>m(u.target.value),className:"border rounded px-2 py-1"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:Q,className:"px-4 py-2 bg-gray-300 rounded",children:s("clear_date_range")})})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>y("date"),children:s("date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>y("technician_id.name"),children:s("technician")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>y("short_description"),children:s("short_description")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>y("status"),children:s("status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:R.map(u=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:xe(u.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:V(u)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.short_description}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${u.status==="completed"?"bg-green-100 text-green-800":u.status==="in_progress"?"bg-yellow-100 text-yellow-800":u.status==="planned"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s(u.status)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx(Te,{to:`/reports/${u._id}`,className:"text-indigo-600 hover:text-indigo-900 mr-4",children:s("view")}),(a==null?void 0:a.role)==="admin"&&e.jsx("button",{onClick:()=>se(u._id),className:"text-red-600 hover:text-red-900",children:s("delete")})]})]},u._id))})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{onClick:()=>E(b-1),disabled:b===1,className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",children:s("previous")}),e.jsxs("span",{children:[s("page")," ",b," ",s("of")," ",x]}),e.jsx("button",{onClick:()=>E(b+1),disabled:b===x,className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",children:s("next")})]})]})},de="/assets/control-CGKJ2IdP.png",bt=({activity:t,index:r,clients:s,worksites:a,products:d,users:c,handleActivityChange:l,removeActivity:p,appendMaterial:g,removeMaterial:v})=>{const{t:i}=K(),[j,N]=o.useState(""),[m,b]=o.useState(!1),w=(n,h)=>{const f=[...t.materials_used],F=h.target.name==="quantity"?Math.max(1,Number(h.target.value)):h.target.value;f[n]={...f[n],[h.target.name]:F},l(r,{target:{name:"materials_used",value:f}})},T=(n,h)=>{const f=[...t.materials_used];f[n].quantity=Math.max(1,f[n].quantity+h),l(r,{target:{name:"materials_used",value:f}})};return e.jsxs("div",{className:"border p-6 mb-6 rounded-lg shadow-lg bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-800",children:[i("activity")," ",r+1]}),e.jsx(te,{content:i("remove_activity"),children:e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 focus:outline-none",onClick:()=>p(r),children:e.jsx(ce,{})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`client_id_${r}`,children:i("client")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`client_id_${r}`,name:"client_id",value:t.client_id,onChange:n=>l(r,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_client")}),s.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`worksite_${r}`,children:i("worksite")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`worksite_${r}`,name:"worksite_id",value:t.worksite_id,onChange:n=>l(r,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_worksite")}),a.filter(n=>n.client_id===t.client_id).map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`description_${r}`,children:i("description")}),e.jsx("textarea",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`description_${r}`,name:"description",value:t.description,onChange:n=>l(r,n),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`travel_time_${r}`,children:[i("travel_time")," (",i("minutes"),")"]}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`travel_time_${r}`,type:"number",name:"travel_time",value:t.travel_time,onChange:n=>l(r,n),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`work_time_${r}`,children:[i("work_time")," (",i("minutes"),")"]}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`work_time_${r}`,type:"number",name:"work_time",value:t.work_time,onChange:n=>l(r,n),required:!0})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`assigned_technician_${r}`,children:i("assigned_technician")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`assigned_technician_${r}`,name:"assigned_technician_id",value:t.assigned_technician_id,onChange:n=>l(r,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_technician")}),c.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-md font-semibold mb-2 flex items-center",children:[i("materials_used"),e.jsx(te,{content:i("add_material"),children:e.jsx("button",{type:"button",className:"ml-2 text-blue-500 hover:text-blue-700 focus:outline-none",onClick:()=>g(r),children:e.jsx(re,{})})})]}),e.jsx("input",{type:"text",placeholder:i("search_products"),value:j,onChange:n=>N(n.target.value),className:"mb-2 p-2 border rounded w-full"}),t.materials_used.map((n,h)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex-grow",children:e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",name:"product_id",value:n.product_id,onChange:f=>w(h,f),required:!0,children:[e.jsx("option",{value:"",children:i("select_product")}),d.filter(f=>(f.item_code.toLowerCase().includes(j.toLowerCase())||f.supplier_item_code.toLowerCase().includes(j.toLowerCase())||f.item_description.toLowerCase().includes(j.toLowerCase()))&&!t.materials_used.some(F=>F.product_id===f._id&&F!==n)).map(f=>e.jsxs("option",{value:f._id,children:[f.item_code," - ",f.supplier_item_code," - ",f.item_description]},f._id))]})}),e.jsxs("div",{className:"flex items-center",children:[m?e.jsx("input",{className:"appearance-none rounded-md relative block w-16 px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",type:"number",name:"quantity",value:n.quantity,onChange:f=>w(h,f),required:!0,style:{minWidth:"100px",width:"100px"}}):e.jsxs("div",{className:"flex items-center",style:{minWidth:"100px",width:"100px",display:"flex",alignContent:"center",justifyContent:"space-around"},children:[e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 focus:outline-none",onClick:()=>T(h,-1),children:e.jsx(Se,{})}),e.jsx("span",{className:"mx-2",children:n.quantity}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 focus:outline-none",onClick:()=>T(h,1),children:e.jsx(re,{})})]}),e.jsx("button",{type:"button",className:"ml-2 text-blue-500 hover:text-blue-700 focus:outline-none",onClick:()=>b(!m),children:m?e.jsx("div",{style:{cursor:"pointer",height:"32px",width:"32px",background:`url(${de})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"},onClick:()=>{}}):e.jsx("div",{style:{cursor:"pointer",height:"32px",width:"32px",background:`url(${de})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"},onClick:()=>{}})})]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 focus:outline-none",onClick:()=>v(r,h),children:e.jsx(ce,{})})]},h))]})]})},ft=({report:t,onClose:r})=>{const{t:s}=K(),{getClientById:a,getWorksiteById:d,getProductById:c,getUserById:l}=Be(),p=g=>g.completed?e.jsx(Me,{className:"text-green-500 text-2xl"}):e.jsx(Re,{className:"text-yellow-500 text-2xl"});return e.jsx(Ge,{onClose:r,children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white overflow-y-auto max-h-[80vh]",children:[e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:s("report_preview")}),e.jsx("p",{className:"text-gray-600",children:xe(t.date)})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:e.jsxs("dl",{className:"sm:divide-y sm:divide-gray-200",children:[e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:s("technician")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.technician_id.name})]}),e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:s("status")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:s(t.status)})]})]})}),e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:s("activities")}),t.activities.map((g,v)=>{const i=a(g.client_id),j=d(g.worksite_id),N=l(g.assigned_technician_id);return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4 shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:[s("activity")," ",v+1]}),p(g)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("client")}),e.jsx("span",{className:"text-blue-600",children:i?i.name:s("unknown_client")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("worksite")}),e.jsx("span",{className:"text-blue-600",children:j?j.name:s("unknown_worksite")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"text-blue-500 mr-2"}),e.jsx("p",{className:"text-gray-600",children:g.description||s("no_description")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ee,{className:"text-blue-500 mr-2"}),e.jsxs("p",{className:"text-gray-600",children:[g.work_time||0," ",s("minutes")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("intervention_type")}),e.jsx("p",{className:"text-gray-600",children:g.intervention_type||s("not_specified")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("travel_time")}),e.jsxs("p",{className:"text-gray-600",children:[g.travel_time||0," ",s("minutes")]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("assigned_technician")}),e.jsx("p",{className:"text-gray-600",children:N?N.name:s("not_assigned")})]}),g.materials_used&&g.materials_used.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("materials_used")}),e.jsx("ul",{className:"list-disc list-inside",children:g.materials_used.map((m,b)=>{const w=c(m.product_id);return e.jsxs("li",{className:"text-gray-600",children:[w?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:w.item_code})," -",e.jsxs("span",{className:"text-sm text-gray-500",children:[" ",s("supplier_item_code"),": ",w.supplier_item_code]})," -",e.jsx("span",{className:"text-gray-600",children:w.item_description})]}):e.jsx("span",{className:"text-red-600",children:s("unknown_product")}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[s("Quantity"),":"]}),e.jsxs("span",{className:"font-semibold",children:[" ",m.quantity||0," ",s("units")]})]})]},b)})})]})]},g._id+v)})]}),e.jsxs("div",{className:"flex items-center mb-4 px-4 py-5 sm:px-6",children:[e.jsx(De,{className:"text-blue-500 mr-2"}),e.jsxs("p",{className:"text-gray-600",children:[s("lunch_location"),": ",t.lunch_location||s("not_specified")]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:r,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:s("close")})})]})})},yt=({initialData:t,onFormDataChange:r})=>{const{t:s}=K(),[a,d]=o.useState(!1),[c,l]=o.useState(0),{formData:p,clients:g,worksites:v,products:i,users:j,isLoading:N,error:m,handleChange:b,handleActivityChange:w,handleSubmit:T,appendActivity:n,removeActivity:h,validateForm:f,appendMaterial:F,removeMaterial:k}=Ue(t,r),{showFlashMessage:C}=Pe(),I=()=>{const x=f();if(Object.keys(x).length===0)d(!0);else{const y=Object.values(x)[0];C(y,"error")}},R=()=>{document.querySelectorAll(`[id^="activity_${c}_"]`).forEach(y=>{(y instanceof HTMLInputElement||y instanceof HTMLSelectElement||y instanceof HTMLTextAreaElement)&&y.required&&!y.value&&(y.classList.add("border-red-500"),setTimeout(()=>{y.classList.remove("border-red-500")},2e3))})};return N?e.jsx("div",{children:s("loading")}):m?e.jsx("div",{className:"text-red-500",children:m}):e.jsxs("form",{onSubmit:T,className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"date",children:s("date")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"date",type:"date",name:"date",value:p.date,onChange:b,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"technician",children:s("technician")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"technician",name:"technician_id",value:p.technician_id,onChange:b,required:!0,children:[e.jsx("option",{value:"",children:s("select_technician")}),j&&j.length>0?j.map(x=>e.jsx("option",{value:x._id,children:x.name},x._id)):e.jsx("option",{value:"",disabled:!0,children:s("loading_users")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"lunch_location",children:s("lunch_location")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"lunch_location",type:"text",name:"lunch_location",value:p.lunch_location,onChange:b,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"status",children:s("status")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"status",name:"status",value:p.status,onChange:b,required:!0,children:[e.jsx("option",{value:"",children:s("select_status")}),e.jsx("option",{value:"planned",children:s("planned")}),e.jsx("option",{value:"in_progress",children:s("in_progress")}),e.jsx("option",{value:"completed",children:s("completed")})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"short_description",children:s("short_description")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"short_description",type:"text",name:"short_description",value:p.short_description,onChange:b,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:s("activities")}),e.jsxs("button",{style:{marginBottom:"1rem"},type:"button",className:"mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center",onClick:()=>{n(),l(p.activities.length)},children:[e.jsx(re,{className:"mr-2"}),s("add_activity")]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-center mb-4 overflow-x-auto",children:p.activities.map((x,y)=>e.jsxs("button",{className:`mr-2 px-3 py-1 rounded-full ${y===c?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,onClick:()=>{l(y),R()},children:[s("activity")," ",y+1]},y))}),e.jsx("div",{className:"relative overflow-hidden",children:e.jsx("div",{className:"flex transition-transform duration-300 ease-in-out",style:{transform:`translateX(-${c*100}%)`},children:p.activities.map((x,y)=>e.jsx("div",{className:"w-full flex-shrink-0",children:e.jsx(bt,{activity:x,index:y,clients:g,worksites:v,products:i,users:j,handleActivityChange:w,appendMaterial:F,removeActivity:()=>h(y),removeMaterial:k})},y))})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l focus:outline-none focus:shadow-outline",onClick:()=>l(x=>Math.max(0,x-1)),disabled:c===0,children:s("previous")}),e.jsx("button",{type:"button",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-r focus:outline-none focus:shadow-outline",onClick:()=>l(x=>Math.min(p.activities.length-1,x+1)),disabled:c===p.activities.length-1,children:s("next")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end mt-4",children:[e.jsx(te,{content:s("preview_report"),children:e.jsxs("button",{type:"button",className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2",onClick:I,children:[e.jsx(Le,{className:"inline-block mr-2"}),s("preview")]})}),e.jsx(te,{content:s("submit_report"),children:e.jsxs("button",{type:"submit",className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:[e.jsx(qe,{className:"inline-block mr-2"}),s("submit")]})})]}),a&&e.jsx(ft,{report:p,onClose:()=>d(!1)})]})},Pt=()=>{const{t}=K(),[r,s]=o.useState([]),[a,d]=o.useState(!0),[c,l]=o.useState(null),[p,g]=o.useState(0),[v,i]=o.useState(null);o.useEffect(()=>{j()},[]);const j=async()=>{d(!0);try{const m=await Ae();s(m),l(null)}catch(m){l(t("error_fetching_reports")),console.error(t("error_fetching_reports"),m)}finally{d(!1)}},N=m=>{i(m)};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("reports")}),e.jsxs(L.Group,{selectedIndex:p,onChange:g,children:[e.jsxs(L.List,{className:"flex space-x-1 rounded-xl bg-blue-900/20 p-1 mb-6",children:[e.jsx(L,{className:({selected:m})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
             ${m?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("report_list")}),e.jsx(L,{className:({selected:m})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
             ${m?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("create_report")})]}),e.jsxs(L.Panels,{children:[e.jsx(L.Panel,{children:a?e.jsx("p",{children:t("loading_reports")}):c?e.jsx("p",{className:"text-red-500",children:c}):e.jsx(gt,{reports:r,onReportDeleted:()=>j()})}),e.jsx(L.Panel,{children:e.jsx(yt,{initialData:v,onFormDataChange:N})})]})]})]})};export{Pt as default};
