import{W as A,H as O,r as d,f as ve,g as L,M as ae,s as z,y as H,o as M,n as K,$ as ie,h as Ne,w as _e,D as oe,i as we,k as G,_ as B,T as J,l as ke,m as T,P as R,F as $,t as Ce,u as U,j as e,L as Fe,e as Pe}from"./index-B2kh2iVj.js";import{f as ce,u as Te,a as $e}from"./useEntityData-BLoRszLo.js";import{f as ne,h as V,i as Se,j as Ie,k as De,l as Ee,c as Me,m as Re,n as Le,o as qe,p as Ae}from"./index-DnKmDFfx.js";import{T as Q,B as Oe}from"./Tooltip-B06kv-Sw.js";import"./clientService-D0rezJXS.js";import"./api-CLE4YwRs.js";import"./productsService-DUq13sXT.js";import"./usersService-CO4rIiT5.js";import"./worksiteService-CfPHAhQs.js";let Be="span";var de=(t=>(t[t.None=1]="None",t[t.Focusable=2]="Focusable",t[t.Hidden=4]="Hidden",t))(de||{});function Ge(t,s){var r;let{features:a=1,...o}=t,c={ref:s,"aria-hidden":(a&2)===2?!0:(r=o["aria-hidden"])!=null?r:void 0,hidden:(a&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(a&4)===4&&(a&2)!==2&&{display:"none"}}};return O({ourProps:c,theirProps:o,slot:{},defaultTag:Be,name:"Hidden"})}let ue=A(Ge);function He({onFocus:t}){let[s,r]=d.useState(!0),a=ve();return s?L.createElement(ue,{as:"button",type:"button",features:de.Focusable,onFocus:o=>{o.preventDefault();let c,l=50;function x(){if(l--<=0){c&&cancelAnimationFrame(c);return}if(t()){if(cancelAnimationFrame(c),!a.current)return;r(!1);return}c=requestAnimationFrame(x)}c=requestAnimationFrame(x)}}):null}const me=d.createContext(null);function Ue(){return{groups:new Map,get(t,s){var r;let a=this.groups.get(t);a||(a=new Map,this.groups.set(t,a));let o=(r=a.get(s))!=null?r:0;a.set(s,o+1);let c=Array.from(a.keys()).indexOf(s);function l(){let x=a.get(s);x>1?a.set(s,x-1):a.delete(s)}return[c,l]}}}function We({children:t}){let s=d.useRef(Ue());return d.createElement(me.Provider,{value:s},t)}function xe(t){let s=d.useContext(me);if(!s)throw new Error("You must wrap your component in a <StableCollection>");let r=d.useId(),[a,o]=s.current.get(t,r);return d.useEffect(()=>o,[]),a}var ze=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(ze||{}),Je=(t=>(t[t.Less=-1]="Less",t[t.Equal=0]="Equal",t[t.Greater=1]="Greater",t))(Je||{}),Ke=(t=>(t[t.SetSelectedIndex=0]="SetSelectedIndex",t[t.RegisterTab=1]="RegisterTab",t[t.UnregisterTab=2]="UnregisterTab",t[t.RegisterPanel=3]="RegisterPanel",t[t.UnregisterPanel=4]="UnregisterPanel",t))(Ke||{});let Qe={0(t,s){var r;let a=B(t.tabs,i=>i.current),o=B(t.panels,i=>i.current),c=a.filter(i=>{var j;return!((j=i.current)!=null&&j.hasAttribute("disabled"))}),l={...t,tabs:a,panels:o};if(s.index<0||s.index>a.length-1){let i=G(Math.sign(s.index-t.selectedIndex),{[-1]:()=>1,0:()=>G(Math.sign(s.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(c.length===0)return l;let j=G(i,{0:()=>a.indexOf(c[0]),1:()=>a.indexOf(c[c.length-1])});return{...l,selectedIndex:j===-1?t.selectedIndex:j}}let x=a.slice(0,s.index),p=[...a.slice(s.index),...x].find(i=>c.includes(i));if(!p)return l;let v=(r=a.indexOf(p))!=null?r:t.selectedIndex;return v===-1&&(v=t.selectedIndex),{...l,selectedIndex:v}},1(t,s){if(t.tabs.includes(s.tab))return t;let r=t.tabs[t.selectedIndex],a=B([...t.tabs,s.tab],c=>c.current),o=t.selectedIndex;return t.info.current.isControlled||(o=a.indexOf(r),o===-1&&(o=t.selectedIndex)),{...t,tabs:a,selectedIndex:o}},2(t,s){return{...t,tabs:t.tabs.filter(r=>r!==s.tab)}},3(t,s){return t.panels.includes(s.panel)?t:{...t,panels:B([...t.panels,s.panel],r=>r.current)}},4(t,s){return{...t,panels:t.panels.filter(r=>r!==s.panel)}}},X=d.createContext(null);X.displayName="TabsDataContext";function q(t){let s=d.useContext(X);if(s===null){let r=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,q),r}return s}let Y=d.createContext(null);Y.displayName="TabsActionsContext";function Z(t){let s=d.useContext(Y);if(s===null){let r=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,Z),r}return s}function Ve(t,s){return G(s.type,Qe,t,s)}let Xe="div";function Ye(t,s){let{defaultIndex:r=0,vertical:a=!1,manual:o=!1,onChange:c,selectedIndex:l=null,...x}=t;const p=a?"vertical":"horizontal",v=o?"manual":"auto";let i=l!==null,j=z({isControlled:i}),N=H(s),[m,y]=d.useReducer(Ve,{info:j,selectedIndex:l??r,tabs:[],panels:[]}),k=d.useMemo(()=>({selectedIndex:m.selectedIndex}),[m.selectedIndex]),P=z(c||(()=>{})),n=z(m.tabs),h=d.useMemo(()=>({orientation:p,activation:v,...m}),[p,v,m]),g=M(u=>(y({type:1,tab:u}),()=>y({type:2,tab:u}))),F=M(u=>(y({type:3,panel:u}),()=>y({type:4,panel:u}))),w=M(u=>{C.current!==u&&P.current(u),i||y({type:0,index:u})}),C=z(i?t.selectedIndex:m.selectedIndex),S=d.useMemo(()=>({registerTab:g,registerPanel:F,change:w}),[]);K(()=>{y({type:0,index:l??r})},[l]),K(()=>{if(C.current===void 0||m.tabs.length<=0)return;let u=B(m.tabs,f=>f.current);u.some((f,I)=>m.tabs[I]!==f)&&w(u.indexOf(m.tabs[C.current]))});let b={ref:N};return L.createElement(We,null,L.createElement(Y.Provider,{value:S},L.createElement(X.Provider,{value:h},h.tabs.length<=0&&L.createElement(He,{onFocus:()=>{var u,f;for(let I of n.current)if(((u=I.current)==null?void 0:u.tabIndex)===0)return(f=I.current)==null||f.focus(),!0;return!1}}),O({ourProps:b,theirProps:x,slot:k,defaultTag:Xe,name:"Tabs"}))))}let Ze="div";function et(t,s){let{orientation:r,selectedIndex:a}=q("Tab.List"),o=H(s),c=d.useMemo(()=>({selectedIndex:a}),[a]);return O({ourProps:{ref:o,role:"tablist","aria-orientation":r},theirProps:t,slot:c,defaultTag:Ze,name:"Tabs.List"})}let tt="button";function st(t,s){var r,a;let o=d.useId(),{id:c=`headlessui-tabs-tab-${o}`,disabled:l=!1,autoFocus:x=!1,...p}=t,{orientation:v,activation:i,selectedIndex:j,tabs:N,panels:m}=q("Tab"),y=Z("Tab"),k=q("Tab"),[P,n]=d.useState(null),h=d.useRef(null),g=H(h,s,n);K(()=>y.registerTab(h),[y,h]);let F=xe("tabs"),w=N.indexOf(h);w===-1&&(w=F);let C=w===j,S=M(_=>{var D;let W=_();if(W===J.Success&&i==="auto"){let ye=(D=ke(h))==null?void 0:D.activeElement,re=k.tabs.findIndex(je=>je.current===ye);re!==-1&&y.change(re)}return W}),b=M(_=>{let D=N.map(W=>W.current).filter(Boolean);if(_.key===T.Space||_.key===T.Enter){_.preventDefault(),_.stopPropagation(),y.change(w);return}switch(_.key){case T.Home:case T.PageUp:return _.preventDefault(),_.stopPropagation(),S(()=>R(D,$.First));case T.End:case T.PageDown:return _.preventDefault(),_.stopPropagation(),S(()=>R(D,$.Last))}if(S(()=>G(v,{vertical(){return _.key===T.ArrowUp?R(D,$.Previous|$.WrapAround):_.key===T.ArrowDown?R(D,$.Next|$.WrapAround):J.Error},horizontal(){return _.key===T.ArrowLeft?R(D,$.Previous|$.WrapAround):_.key===T.ArrowRight?R(D,$.Next|$.WrapAround):J.Error}}))===J.Success)return _.preventDefault()}),u=d.useRef(!1),f=M(()=>{var _;u.current||(u.current=!0,(_=h.current)==null||_.focus({preventScroll:!0}),y.change(w),Ce(()=>{u.current=!1}))}),I=M(_=>{_.preventDefault()}),{isFocusVisible:ee,focusProps:pe}=ie({autoFocus:x}),{isHovered:te,hoverProps:he}=Ne({isDisabled:l}),{pressed:se,pressProps:ge}=_e({disabled:l}),be=d.useMemo(()=>({selected:C,hover:te,active:se,focus:ee,autofocus:x,disabled:l}),[C,te,ee,se,x,l]),fe=oe({ref:g,onKeyDown:b,onMouseDown:I,onClick:f,id:c,role:"tab",type:we(t,P),"aria-controls":(a=(r=m[w])==null?void 0:r.current)==null?void 0:a.id,"aria-selected":C,tabIndex:C?0:-1,disabled:l||void 0,autoFocus:x},pe,he,ge);return O({ourProps:fe,theirProps:p,slot:be,defaultTag:tt,name:"Tabs.Tab"})}let rt="div";function at(t,s){let{selectedIndex:r}=q("Tab.Panels"),a=H(s),o=d.useMemo(()=>({selectedIndex:r}),[r]);return O({ourProps:{ref:a},theirProps:t,slot:o,defaultTag:rt,name:"Tabs.Panels"})}let nt="div",lt=ae.RenderStrategy|ae.Static;function it(t,s){var r,a,o,c;let l=d.useId(),{id:x=`headlessui-tabs-panel-${l}`,tabIndex:p=0,...v}=t,{selectedIndex:i,tabs:j,panels:N}=q("Tab.Panel"),m=Z("Tab.Panel"),y=d.useRef(null),k=H(y,s);K(()=>m.registerPanel(y),[m,y]);let P=xe("panels"),n=N.indexOf(y);n===-1&&(n=P);let h=n===i,{isFocusVisible:g,focusProps:F}=ie(),w=d.useMemo(()=>({selected:h,focus:g}),[h,g]),C=oe({ref:k,id:x,role:"tabpanel","aria-labelledby":(a=(r=j[n])==null?void 0:r.current)==null?void 0:a.id,tabIndex:h?p:-1},F);return!h&&((o=v.unmount)==null||o)&&!((c=v.static)!=null&&c)?L.createElement(ue,{"aria-hidden":"true",...C}):O({ourProps:C,theirProps:v,slot:w,defaultTag:nt,features:lt,visible:h,name:"Tabs.Panel"})}let ot=A(st),ct=A(Ye),dt=A(et),ut=A(at),mt=A(it),E=Object.assign(ot,{Group:ct,List:dt,Panels:ut,Panel:mt});const xt=({reports:t})=>{const{t:s}=U(),[r,a]=d.useState(""),[o,c]=d.useState(""),[l,x]=d.useState("asc"),[p,v]=d.useState(""),[i,j]=d.useState(""),[N,m]=d.useState(1),y=10,P=t.filter(b=>{const u=b.short_description.toLowerCase().includes(r.toLowerCase()),f=(!p||new Date(b.date)>=new Date(p))&&(!i||new Date(b.date)<=new Date(i));return u&&f}).sort((b,u)=>{if(!o)return 0;const f=b[o],I=u[o];return f<I?l==="asc"?-1:1:f>I?l==="asc"?1:-1:0}),n=N*y,h=n-y,g=P.slice(h,n),F=Math.ceil(P.length/y),w=b=>{const u=o===b&&l==="asc"?"desc":"asc";c(b),x(u)},C=b=>{m(b)},S=()=>{v(""),j("")};return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"mb-4 flex space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter",className:"block text-sm font-medium text-gray-700",children:s("filter_by_description")}),e.jsx("input",{id:"filter",type:"text",placeholder:s("filter_by_description"),value:r,onChange:b=>a(b.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700",children:s("start_date")}),e.jsx("input",{id:"startDate",type:"date",value:p,onChange:b=>v(b.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700",children:s("end_date")}),e.jsx("input",{id:"endDate",type:"date",value:i,onChange:b=>j(b.target.value),className:"border rounded px-2 py-1"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:S,className:"px-4 py-2 bg-gray-300 rounded",children:s("clear_date_range")})})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>w("date"),children:s("date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>w("technician_id.name"),children:s("technician")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>w("short_description"),children:s("short_description")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>w("status"),children:s("status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(b=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:ce(b.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:b.technician_id.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:b.short_description}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${b.status==="completed"?"bg-green-100 text-green-800":b.status==="in_progress"?"bg-yellow-100 text-yellow-800":b.status==="planned"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s(b.status)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(Fe,{to:`/reports/${b._id}`,className:"text-indigo-600 hover:text-indigo-900",children:s("view")})})]},b._id))})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{onClick:()=>C(N-1),disabled:N===1,className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",children:s("previous")}),e.jsxs("span",{children:[s("page")," ",N," ",s("of")," ",F]}),e.jsx("button",{onClick:()=>C(N+1),disabled:N===F,className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",children:s("next")})]})]})},le="/assets/control-CGKJ2IdP.png",pt=({activity:t,index:s,clients:r,worksites:a,products:o,users:c,handleActivityChange:l,removeActivity:x,appendMaterial:p,removeMaterial:v})=>{const{t:i}=U(),[j,N]=d.useState(""),[m,y]=d.useState(!1),k=(n,h)=>{const g=[...t.materials_used],F=h.target.name==="quantity"?Math.max(1,Number(h.target.value)):h.target.value;g[n]={...g[n],[h.target.name]:F},l(s,{target:{name:"materials_used",value:g}})},P=(n,h)=>{const g=[...t.materials_used];g[n].quantity=Math.max(1,g[n].quantity+h),l(s,{target:{name:"materials_used",value:g}})};return e.jsxs("div",{className:"border p-6 mb-6 rounded-lg shadow-lg bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-800",children:[i("activity")," ",s+1]}),e.jsx(Q,{content:i("remove_activity"),children:e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 focus:outline-none",onClick:()=>x(s),children:e.jsx(ne,{})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`client_id_${s}`,children:i("client")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`client_id_${s}`,name:"client_id",value:t.client_id,onChange:n=>l(s,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_client")}),r.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`worksite_${s}`,children:i("worksite")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`worksite_${s}`,name:"worksite_id",value:t.worksite_id,onChange:n=>l(s,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_worksite")}),a.filter(n=>n.client_id===t.client_id).map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`description_${s}`,children:i("description")}),e.jsx("textarea",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`description_${s}`,name:"description",value:t.description,onChange:n=>l(s,n),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`travel_time_${s}`,children:[i("travel_time")," (",i("minutes"),")"]}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`travel_time_${s}`,type:"number",name:"travel_time",value:t.travel_time,onChange:n=>l(s,n),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`work_time_${s}`,children:[i("work_time")," (",i("minutes"),")"]}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`work_time_${s}`,type:"number",name:"work_time",value:t.work_time,onChange:n=>l(s,n),required:!0})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`assigned_technician_${s}`,children:i("assigned_technician")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`assigned_technician_${s}`,name:"assigned_technician_id",value:t.assigned_technician_id,onChange:n=>l(s,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_technician")}),c.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-md font-semibold mb-2 flex items-center",children:[i("materials_used"),e.jsx(Q,{content:i("add_material"),children:e.jsx("button",{type:"button",className:"ml-2 text-blue-500 hover:text-blue-700 focus:outline-none",onClick:()=>p(s),children:e.jsx(V,{})})})]}),e.jsx("input",{type:"text",placeholder:i("search_products"),value:j,onChange:n=>N(n.target.value),className:"mb-2 p-2 border rounded w-full"}),t.materials_used.map((n,h)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex-grow",children:e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",name:"product_id",value:n.product_id,onChange:g=>k(h,g),required:!0,children:[e.jsx("option",{value:"",children:i("select_product")}),o.filter(g=>(g.item_code.toLowerCase().includes(j.toLowerCase())||g.supplier_item_code.toLowerCase().includes(j.toLowerCase())||g.item_description.toLowerCase().includes(j.toLowerCase()))&&!t.materials_used.some(F=>F.product_id===g._id&&F!==n)).map(g=>e.jsxs("option",{value:g._id,children:[g.item_code," - ",g.supplier_item_code," - ",g.item_description]},g._id))]})}),e.jsxs("div",{className:"flex items-center",children:[m?e.jsx("input",{className:"appearance-none rounded-md relative block w-16 px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",type:"number",name:"quantity",value:n.quantity,onChange:g=>k(h,g),required:!0,style:{minWidth:"100px",width:"100px"}}):e.jsxs("div",{className:"flex items-center",style:{minWidth:"100px",width:"100px",display:"flex",alignContent:"center",justifyContent:"space-around"},children:[e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 focus:outline-none",onClick:()=>P(h,-1),children:e.jsx(Se,{})}),e.jsx("span",{className:"mx-2",children:n.quantity}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 focus:outline-none",onClick:()=>P(h,1),children:e.jsx(V,{})})]}),e.jsx("button",{type:"button",className:"ml-2 text-blue-500 hover:text-blue-700 focus:outline-none",onClick:()=>y(!m),children:m?e.jsx("div",{style:{cursor:"pointer",height:"32px",width:"32px",background:`url(${le})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"},onClick:()=>{}}):e.jsx("div",{style:{cursor:"pointer",height:"32px",width:"32px",background:`url(${le})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"},onClick:()=>{}})})]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 focus:outline-none",onClick:()=>v(s,h),children:e.jsx(ne,{})})]},h))]})]})},ht=({report:t,onClose:s})=>{const{t:r}=U(),{getClientById:a,getWorksiteById:o,getProductById:c,getUserById:l}=Te(),x=p=>p.completed?e.jsx(Me,{className:"text-green-500 text-2xl"}):e.jsx(Re,{className:"text-yellow-500 text-2xl"});return e.jsx(Oe,{onClose:s,children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white overflow-y-auto max-h-[80vh]",children:[e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:r("report_preview")}),e.jsx("p",{className:"text-gray-600",children:ce(t.date)})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:e.jsxs("dl",{className:"sm:divide-y sm:divide-gray-200",children:[e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:r("technician")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.technician_id.name})]}),e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:r("status")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:r(t.status)})]})]})}),e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:r("activities")}),t.activities.map((p,v)=>{const i=a(p.client_id),j=o(p.worksite_id),N=l(p.assigned_technician_id);return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4 shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:[r("activity")," ",v+1]}),x(p)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("client")}),e.jsx("span",{className:"text-blue-600",children:i?i.name:r("unknown_client")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("worksite")}),e.jsx("span",{className:"text-blue-600",children:j?j.name:r("unknown_worksite")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"text-blue-500 mr-2"}),e.jsx("p",{className:"text-gray-600",children:p.description||r("no_description")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(De,{className:"text-blue-500 mr-2"}),e.jsxs("p",{className:"text-gray-600",children:[p.work_time||0," ",r("minutes")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("intervention_type")}),e.jsx("p",{className:"text-gray-600",children:p.intervention_type||r("not_specified")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("travel_time")}),e.jsxs("p",{className:"text-gray-600",children:[p.travel_time||0," ",r("minutes")]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("assigned_technician")}),e.jsx("p",{className:"text-gray-600",children:N?N.name:r("not_assigned")})]}),p.materials_used&&p.materials_used.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("materials_used")}),e.jsx("ul",{className:"list-disc list-inside",children:p.materials_used.map((m,y)=>{const k=c(m.product_id);return e.jsxs("li",{className:"text-gray-600",children:[k?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:k.item_code})," -",e.jsxs("span",{className:"text-sm text-gray-500",children:[" ",r("supplier_item_code"),": ",k.supplier_item_code]})," -",e.jsx("span",{className:"text-gray-600",children:k.item_description})]}):e.jsx("span",{className:"text-red-600",children:r("unknown_product")}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[r("Quantity"),":"]}),e.jsxs("span",{className:"font-semibold",children:[" ",m.quantity||0," ",r("units")]})]})]},y)})})]})]},p._id+v)})]}),e.jsxs("div",{className:"flex items-center mb-4 px-4 py-5 sm:px-6",children:[e.jsx(Ee,{className:"text-blue-500 mr-2"}),e.jsxs("p",{className:"text-gray-600",children:[r("lunch_location"),": ",t.lunch_location||r("not_specified")]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:r("close")})})]})})},gt=({initialData:t,onFormDataChange:s})=>{const{t:r}=U(),[a,o]=d.useState(!1),[c,l]=d.useState(0),{formData:x,clients:p,worksites:v,products:i,users:j,isLoading:N,error:m,handleChange:y,handleActivityChange:k,handleSubmit:P,appendActivity:n,removeActivity:h,validateForm:g,appendMaterial:F,removeMaterial:w}=$e(t,s),{showFlashMessage:C}=Pe(),S=()=>{const u=g();if(Object.keys(u).length===0)o(!0);else{const f=Object.values(u)[0];C(f,"error")}},b=()=>{document.querySelectorAll(`[id^="activity_${c}_"]`).forEach(f=>{(f instanceof HTMLInputElement||f instanceof HTMLSelectElement||f instanceof HTMLTextAreaElement)&&f.required&&!f.value&&(f.classList.add("border-red-500"),setTimeout(()=>{f.classList.remove("border-red-500")},2e3))})};return N?e.jsx("div",{children:r("loading")}):m?e.jsx("div",{className:"text-red-500",children:m}):e.jsxs("form",{onSubmit:P,className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"date",children:r("date")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"date",type:"date",name:"date",value:x.date,onChange:y,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"technician",children:r("technician")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"technician",name:"technician_id",value:x.technician_id,onChange:y,required:!0,children:[e.jsx("option",{value:"",children:r("select_technician")}),j.map(u=>e.jsx("option",{value:u._id,children:u.name},u._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"lunch_location",children:r("lunch_location")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"lunch_location",type:"text",name:"lunch_location",value:x.lunch_location,onChange:y,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"status",children:r("status")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"status",name:"status",value:x.status,onChange:y,required:!0,children:[e.jsx("option",{value:"",children:r("select_status")}),e.jsx("option",{value:"planned",children:r("planned")}),e.jsx("option",{value:"in_progress",children:r("in_progress")}),e.jsx("option",{value:"completed",children:r("completed")})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"short_description",children:r("short_description")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"short_description",type:"text",name:"short_description",value:x.short_description,onChange:y,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:r("activities")}),e.jsxs("button",{style:{marginBottom:"1rem"},type:"button",className:"mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center",onClick:()=>{n(),l(x.activities.length)},children:[e.jsx(V,{className:"mr-2"}),r("add_activity")]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-center mb-4 overflow-x-auto",children:x.activities.map((u,f)=>e.jsxs("button",{className:`mr-2 px-3 py-1 rounded-full ${f===c?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,onClick:()=>{l(f),b()},children:[r("activity")," ",f+1]},f))}),e.jsx("div",{className:"relative overflow-hidden",children:e.jsx("div",{className:"flex transition-transform duration-300 ease-in-out",style:{transform:`translateX(-${c*100}%)`},children:x.activities.map((u,f)=>e.jsx("div",{className:"w-full flex-shrink-0",children:e.jsx(pt,{activity:u,index:f,clients:p,worksites:v,products:i,users:j,handleActivityChange:k,appendMaterial:F,removeActivity:()=>h(f),removeMaterial:w})},f))})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l focus:outline-none focus:shadow-outline",onClick:()=>l(u=>Math.max(0,u-1)),disabled:c===0,children:r("previous")}),e.jsx("button",{type:"button",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-r focus:outline-none focus:shadow-outline",onClick:()=>l(u=>Math.min(x.activities.length-1,u+1)),disabled:c===x.activities.length-1,children:r("next")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end mt-4",children:[e.jsx(Q,{content:r("preview_report"),children:e.jsxs("button",{type:"button",className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2",onClick:S,children:[e.jsx(Le,{className:"inline-block mr-2"}),r("preview")]})}),e.jsx(Q,{content:r("submit_report"),children:e.jsxs("button",{type:"submit",className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:[e.jsx(qe,{className:"inline-block mr-2"}),r("submit")]})})]}),a&&e.jsx(ht,{report:x,onClose:()=>o(!1)})]})},Ct=()=>{const{t}=U(),[s,r]=d.useState([]),[a,o]=d.useState(!0),[c,l]=d.useState(null),[x,p]=d.useState(0),[v,i]=d.useState(null);d.useEffect(()=>{j()},[]);const j=async()=>{o(!0);try{const m=await Ae();r(m),l(null)}catch(m){l(t("error_fetching_reports")),console.error(t("error_fetching_reports"),m)}finally{o(!1)}},N=m=>{i(m)};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("reports")}),e.jsxs(E.Group,{selectedIndex:x,onChange:p,children:[e.jsxs(E.List,{className:"flex space-x-1 rounded-xl bg-blue-900/20 p-1 mb-6",children:[e.jsx(E,{className:({selected:m})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
             ${m?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("report_list")}),e.jsx(E,{className:({selected:m})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
             ${m?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("create_report")})]}),e.jsxs(E.Panels,{children:[e.jsx(E.Panel,{children:a?e.jsx("p",{children:t("loading_reports")}):c?e.jsx("p",{className:"text-red-500",children:c}):e.jsx(xt,{reports:s})}),e.jsx(E.Panel,{children:e.jsx(gt,{initialData:v,onFormDataChange:N})})]})]})]})};export{Ct as default};
