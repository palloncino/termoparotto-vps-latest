import{W as q,H as O,r as x,f as ye,R as L,M as re,s as V,y as U,o as R,n as J,$ as ne,g as je,w as Ne,D as le,h as we,i as H,_ as B,T as z,k as _e,l as T,P as M,F as $,t as ke,u as G,j as e,L as Ce,e as Fe}from"./index-DBn0QrPF.js";import{f as ie,u as Pe,a as Te}from"./useEntityData-YLcLvYgQ.js";import{f as ae,h as oe,i as $e,j as Ie,k as Se,c as De,l as Ee,m as Re,n as Me,o as Le}from"./index-4mlUh0P7.js";import{B as Ae}from"./Backdrop-BVxcjYm0.js";import"./clientService-Bj64bQzW.js";import"./api-CLE4YwRs.js";import"./productsService-BaCjJiUO.js";import"./usersService-D84MQp6X.js";import"./worksiteService-CfPHAhQs.js";let qe="span";var de=(t=>(t[t.None=1]="None",t[t.Focusable=2]="Focusable",t[t.Hidden=4]="Hidden",t))(de||{});function Oe(t,s){var r;let{features:a=1,...o}=t,d={ref:s,"aria-hidden":(a&2)===2?!0:(r=o["aria-hidden"])!=null?r:void 0,hidden:(a&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(a&4)===4&&(a&2)!==2&&{display:"none"}}};return O({ourProps:d,theirProps:o,slot:{},defaultTag:qe,name:"Hidden"})}let ce=q(Oe);function Be({onFocus:t}){let[s,r]=x.useState(!0),a=ye();return s?L.createElement(ce,{as:"button",type:"button",features:de.Focusable,onFocus:o=>{o.preventDefault();let d,l=50;function p(){if(l--<=0){d&&cancelAnimationFrame(d);return}if(t()){if(cancelAnimationFrame(d),!a.current)return;r(!1);return}d=requestAnimationFrame(p)}d=requestAnimationFrame(p)}}):null}const ue=x.createContext(null);function He(){return{groups:new Map,get(t,s){var r;let a=this.groups.get(t);a||(a=new Map,this.groups.set(t,a));let o=(r=a.get(s))!=null?r:0;a.set(s,o+1);let d=Array.from(a.keys()).indexOf(s);function l(){let p=a.get(s);p>1?a.set(s,p-1):a.delete(s)}return[d,l]}}}function Ue({children:t}){let s=x.useRef(He());return x.createElement(ue.Provider,{value:s},t)}function me(t){let s=x.useContext(ue);if(!s)throw new Error("You must wrap your component in a <StableCollection>");let r=x.useId(),[a,o]=s.current.get(t,r);return x.useEffect(()=>o,[]),a}var Ge=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(Ge||{}),We=(t=>(t[t.Less=-1]="Less",t[t.Equal=0]="Equal",t[t.Greater=1]="Greater",t))(We||{}),Ve=(t=>(t[t.SetSelectedIndex=0]="SetSelectedIndex",t[t.RegisterTab=1]="RegisterTab",t[t.UnregisterTab=2]="UnregisterTab",t[t.RegisterPanel=3]="RegisterPanel",t[t.UnregisterPanel=4]="UnregisterPanel",t))(Ve||{});let ze={0(t,s){var r;let a=B(t.tabs,i=>i.current),o=B(t.panels,i=>i.current),d=a.filter(i=>{var f;return!((f=i.current)!=null&&f.hasAttribute("disabled"))}),l={...t,tabs:a,panels:o};if(s.index<0||s.index>a.length-1){let i=H(Math.sign(s.index-t.selectedIndex),{[-1]:()=>1,0:()=>H(Math.sign(s.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(d.length===0)return l;let f=H(i,{0:()=>a.indexOf(d[0]),1:()=>a.indexOf(d[d.length-1])});return{...l,selectedIndex:f===-1?t.selectedIndex:f}}let p=a.slice(0,s.index),h=[...a.slice(s.index),...p].find(i=>d.includes(i));if(!h)return l;let v=(r=a.indexOf(h))!=null?r:t.selectedIndex;return v===-1&&(v=t.selectedIndex),{...l,selectedIndex:v}},1(t,s){if(t.tabs.includes(s.tab))return t;let r=t.tabs[t.selectedIndex],a=B([...t.tabs,s.tab],d=>d.current),o=t.selectedIndex;return t.info.current.isControlled||(o=a.indexOf(r),o===-1&&(o=t.selectedIndex)),{...t,tabs:a,selectedIndex:o}},2(t,s){return{...t,tabs:t.tabs.filter(r=>r!==s.tab)}},3(t,s){return t.panels.includes(s.panel)?t:{...t,panels:B([...t.panels,s.panel],r=>r.current)}},4(t,s){return{...t,panels:t.panels.filter(r=>r!==s.panel)}}},X=x.createContext(null);X.displayName="TabsDataContext";function A(t){let s=x.useContext(X);if(s===null){let r=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,A),r}return s}let Y=x.createContext(null);Y.displayName="TabsActionsContext";function Q(t){let s=x.useContext(Y);if(s===null){let r=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(r,Q),r}return s}function Je(t,s){return H(s.type,ze,t,s)}let Ke="div";function Xe(t,s){let{defaultIndex:r=0,vertical:a=!1,manual:o=!1,onChange:d,selectedIndex:l=null,...p}=t;const h=a?"vertical":"horizontal",v=o?"manual":"auto";let i=l!==null,f=V({isControlled:i}),n=U(s),[u,c]=x.useReducer(Je,{info:f,selectedIndex:l??r,tabs:[],panels:[]}),_=x.useMemo(()=>({selectedIndex:u.selectedIndex}),[u.selectedIndex]),F=V(d||(()=>{})),k=V(u.tabs),j=x.useMemo(()=>({orientation:h,activation:v,...u}),[h,v,u]),C=R(m=>(c({type:1,tab:m}),()=>c({type:2,tab:m}))),P=R(m=>(c({type:3,panel:m}),()=>c({type:4,panel:m}))),N=R(m=>{w.current!==m&&F.current(m),i||c({type:0,index:m})}),w=V(i?t.selectedIndex:u.selectedIndex),I=x.useMemo(()=>({registerTab:C,registerPanel:P,change:N}),[]);J(()=>{c({type:0,index:l??r})},[l]),J(()=>{if(w.current===void 0||u.tabs.length<=0)return;let m=B(u.tabs,b=>b.current);m.some((b,S)=>u.tabs[S]!==b)&&N(m.indexOf(u.tabs[w.current]))});let g={ref:n};return L.createElement(Ue,null,L.createElement(Y.Provider,{value:I},L.createElement(X.Provider,{value:j},j.tabs.length<=0&&L.createElement(Be,{onFocus:()=>{var m,b;for(let S of k.current)if(((m=S.current)==null?void 0:m.tabIndex)===0)return(b=S.current)==null||b.focus(),!0;return!1}}),O({ourProps:g,theirProps:p,slot:_,defaultTag:Ke,name:"Tabs"}))))}let Ye="div";function Qe(t,s){let{orientation:r,selectedIndex:a}=A("Tab.List"),o=U(s),d=x.useMemo(()=>({selectedIndex:a}),[a]);return O({ourProps:{ref:o,role:"tablist","aria-orientation":r},theirProps:t,slot:d,defaultTag:Ye,name:"Tabs.List"})}let Ze="button";function et(t,s){var r,a;let o=x.useId(),{id:d=`headlessui-tabs-tab-${o}`,disabled:l=!1,autoFocus:p=!1,...h}=t,{orientation:v,activation:i,selectedIndex:f,tabs:n,panels:u}=A("Tab"),c=Q("Tab"),_=A("Tab"),[F,k]=x.useState(null),j=x.useRef(null),C=U(j,s,k);J(()=>c.registerTab(j),[c,j]);let P=me("tabs"),N=n.indexOf(j);N===-1&&(N=P);let w=N===f,I=R(y=>{var D;let W=y();if(W===z.Success&&i==="auto"){let fe=(D=_e(j))==null?void 0:D.activeElement,se=_.tabs.findIndex(ve=>ve.current===fe);se!==-1&&c.change(se)}return W}),g=R(y=>{let D=n.map(W=>W.current).filter(Boolean);if(y.key===T.Space||y.key===T.Enter){y.preventDefault(),y.stopPropagation(),c.change(N);return}switch(y.key){case T.Home:case T.PageUp:return y.preventDefault(),y.stopPropagation(),I(()=>M(D,$.First));case T.End:case T.PageDown:return y.preventDefault(),y.stopPropagation(),I(()=>M(D,$.Last))}if(I(()=>H(v,{vertical(){return y.key===T.ArrowUp?M(D,$.Previous|$.WrapAround):y.key===T.ArrowDown?M(D,$.Next|$.WrapAround):z.Error},horizontal(){return y.key===T.ArrowLeft?M(D,$.Previous|$.WrapAround):y.key===T.ArrowRight?M(D,$.Next|$.WrapAround):z.Error}}))===z.Success)return y.preventDefault()}),m=x.useRef(!1),b=R(()=>{var y;m.current||(m.current=!0,(y=j.current)==null||y.focus({preventScroll:!0}),c.change(N),ke(()=>{m.current=!1}))}),S=R(y=>{y.preventDefault()}),{isFocusVisible:Z,focusProps:xe}=ne({autoFocus:p}),{isHovered:ee,hoverProps:pe}=je({isDisabled:l}),{pressed:te,pressProps:he}=Ne({disabled:l}),ge=x.useMemo(()=>({selected:w,hover:ee,active:te,focus:Z,autofocus:p,disabled:l}),[w,ee,Z,te,p,l]),be=le({ref:C,onKeyDown:g,onMouseDown:S,onClick:b,id:d,role:"tab",type:we(t,F),"aria-controls":(a=(r=u[N])==null?void 0:r.current)==null?void 0:a.id,"aria-selected":w,tabIndex:w?0:-1,disabled:l||void 0,autoFocus:p},xe,pe,he);return O({ourProps:be,theirProps:h,slot:ge,defaultTag:Ze,name:"Tabs.Tab"})}let tt="div";function st(t,s){let{selectedIndex:r}=A("Tab.Panels"),a=U(s),o=x.useMemo(()=>({selectedIndex:r}),[r]);return O({ourProps:{ref:a},theirProps:t,slot:o,defaultTag:tt,name:"Tabs.Panels"})}let rt="div",at=re.RenderStrategy|re.Static;function nt(t,s){var r,a,o,d;let l=x.useId(),{id:p=`headlessui-tabs-panel-${l}`,tabIndex:h=0,...v}=t,{selectedIndex:i,tabs:f,panels:n}=A("Tab.Panel"),u=Q("Tab.Panel"),c=x.useRef(null),_=U(c,s);J(()=>u.registerPanel(c),[u,c]);let F=me("panels"),k=n.indexOf(c);k===-1&&(k=F);let j=k===i,{isFocusVisible:C,focusProps:P}=ne(),N=x.useMemo(()=>({selected:j,focus:C}),[j,C]),w=le({ref:_,id:p,role:"tabpanel","aria-labelledby":(a=(r=f[k])==null?void 0:r.current)==null?void 0:a.id,tabIndex:j?h:-1},P);return!j&&((o=v.unmount)==null||o)&&!((d=v.static)!=null&&d)?L.createElement(ce,{"aria-hidden":"true",...w}):O({ourProps:w,theirProps:v,slot:N,defaultTag:rt,features:at,visible:j,name:"Tabs.Panel"})}let lt=q(et),it=q(Xe),ot=q(Qe),dt=q(st),ct=q(nt),E=Object.assign(lt,{Group:it,List:ot,Panels:dt,Panel:ct});const ut=({reports:t})=>{const{t:s}=G(),[r,a]=x.useState(""),[o,d]=x.useState(""),[l,p]=x.useState("asc"),[h,v]=x.useState(""),[i,f]=x.useState(""),[n,u]=x.useState(1),c=10,F=t.filter(g=>{const m=g.short_description.toLowerCase().includes(r.toLowerCase()),b=(!h||new Date(g.date)>=new Date(h))&&(!i||new Date(g.date)<=new Date(i));return m&&b}).sort((g,m)=>{if(!o)return 0;const b=g[o],S=m[o];return b<S?l==="asc"?-1:1:b>S?l==="asc"?1:-1:0}),k=n*c,j=k-c,C=F.slice(j,k),P=Math.ceil(F.length/c);console.log({currentReports:C});const N=g=>{const m=o===g&&l==="asc"?"desc":"asc";d(g),p(m)},w=g=>{u(g)},I=()=>{v(""),f("")};return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"mb-4 flex space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter",className:"block text-sm font-medium text-gray-700",children:s("filter_by_description")}),e.jsx("input",{id:"filter",type:"text",placeholder:s("filter_by_description"),value:r,onChange:g=>a(g.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700",children:s("start_date")}),e.jsx("input",{id:"startDate",type:"date",value:h,onChange:g=>v(g.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700",children:s("end_date")}),e.jsx("input",{id:"endDate",type:"date",value:i,onChange:g=>f(g.target.value),className:"border rounded px-2 py-1"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:I,className:"px-4 py-2 bg-gray-300 rounded",children:s("clear_date_range")})})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>N("date"),children:s("date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>N("technician_id.name"),children:s("technician")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>N("short_description"),children:s("short_description")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>N("status"),children:s("status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map(g=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:ie(g.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.technician_id.name}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:g.short_description}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${g.status==="completed"?"bg-green-100 text-green-800":g.status==="in_progress"?"bg-yellow-100 text-yellow-800":g.status==="planned"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s(g.status)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(Ce,{to:`/reports/${g._id}`,className:"text-indigo-600 hover:text-indigo-900",children:s("view")})})]},g._id))})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{onClick:()=>w(n-1),disabled:n===1,className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",children:s("previous")}),e.jsxs("span",{children:[s("page")," ",n," ",s("of")," ",P]}),e.jsx("button",{onClick:()=>w(n+1),disabled:n===P,className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",children:s("next")})]})]})},K=({content:t,children:s,position:r="top"})=>{const[a,o]=x.useState(!1),d={top:"bottom-full left-1/2 transform -translate-x-1/2 mb-2",bottom:"top-full left-1/2 transform -translate-x-1/2 mt-2",left:"right-full top-1/2 transform -translate-y-1/2 mr-2",right:"left-full top-1/2 transform -translate-y-1/2 ml-2"};return e.jsxs("div",{className:"relative inline-block",children:[e.jsx("div",{onMouseEnter:()=>o(!0),onMouseLeave:()=>o(!1),children:s}),a&&e.jsx("div",{className:`absolute z-10 ${d[r]}`,children:e.jsx("div",{className:"bg-gray-800 text-white text-xs rounded py-1 px-2 whitespace-nowrap",children:t})})]})},mt=({activity:t,index:s,clients:r,worksites:a,products:o,users:d,handleActivityChange:l,removeActivity:p,appendMaterial:h,removeMaterial:v})=>{const{t:i}=G(),f=(n,u)=>{const c=[...t.materials_used];c[n]={...c[n],[u.target.name]:u.target.value},l(s,{target:{name:"materials_used",value:c}})};return e.jsxs("div",{className:"border p-4 mb-4 rounded-lg bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold",children:[i("activity")," ",s+1]}),e.jsx(K,{content:i("remove_activity"),children:e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 focus:outline-none",onClick:()=>p(s),children:e.jsx(ae,{})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`client_id_${s}`,children:i("client")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`client_id_${s}`,name:"client_id",value:t.client_id,onChange:n=>l(s,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_client")}),r.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`worksite_${s}`,children:i("worksite")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`worksite_${s}`,name:"worksite_id",value:t.worksite_id,onChange:n=>l(s,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_worksite")}),a.filter(n=>n.client_id===t.client_id).map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`description_${s}`,children:i("description")}),e.jsx("textarea",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`description_${s}`,name:"description",value:t.description,onChange:n=>l(s,n),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`travel_time_${s}`,children:[i("travel_time")," (",i("minutes"),")"]}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`travel_time_${s}`,type:"number",name:"travel_time",value:t.travel_time,onChange:n=>l(s,n),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`work_time_${s}`,children:[i("work_time")," (",i("minutes"),")"]}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`work_time_${s}`,type:"number",name:"work_time",value:t.work_time,onChange:n=>l(s,n),required:!0})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`assigned_technician_${s}`,children:i("assigned_technician")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`assigned_technician_${s}`,name:"assigned_technician_id",value:t.assigned_technician_id,onChange:n=>l(s,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_technician")}),d.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("h4",{className:"text-md font-semibold mb-2 flex items-center",children:[i("materials_used"),e.jsx(K,{content:i("add_material"),children:e.jsx("button",{type:"button",className:"ml-2 text-blue-500 hover:text-blue-700 focus:outline-none",onClick:()=>h(s),children:e.jsx(oe,{})})})]}),t.materials_used.map((n,u)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex-grow",children:e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",name:"product_id",value:n.product_id,onChange:c=>f(u,c),required:!0,children:[e.jsx("option",{value:"",children:i("select_product")}),o.filter(c=>!t.materials_used.some(_=>_.product_id===c._id&&_!==n)).map(c=>e.jsx("option",{value:c._id,children:c.name},c._id))]})}),e.jsx("div",{className:"flex-grow",children:e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",type:"number",name:"quantity",value:n.quantity,onChange:c=>f(u,c),required:!0})}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 focus:outline-none",onClick:()=>v(s,u),children:e.jsx(ae,{})})]},u))]})]})},xt=({report:t,onClose:s})=>{const{t:r}=G(),{getClientById:a,getWorksiteById:o,getProductById:d,getUserById:l}=Pe(),p=h=>h.completed?e.jsx(De,{className:"text-green-500 text-2xl"}):e.jsx(Ee,{className:"text-yellow-500 text-2xl"});return e.jsx(Ae,{onClose:s,children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white overflow-y-auto max-h-[80vh]",children:[e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:r("report_preview")}),e.jsx("p",{className:"text-gray-600",children:ie(t.date)})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:e.jsxs("dl",{className:"sm:divide-y sm:divide-gray-200",children:[e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:r("technician")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.technician_id.name})]}),e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:r("status")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:r(t.status)})]})]})}),e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:r("activities")}),t.activities.map((h,v)=>{const i=a(h.client_id),f=o(h.worksite_id),n=l(h.assigned_technician_id);return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4 shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:[r("activity")," ",v+1]}),p(h)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("client")}),e.jsx("span",{className:"text-blue-600",children:i?i.name:r("unknown_client")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("worksite")}),e.jsx("span",{className:"text-blue-600",children:f?f.name:r("unknown_worksite")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx($e,{className:"text-blue-500 mr-2"}),e.jsx("p",{className:"text-gray-600",children:h.description||r("no_description")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ie,{className:"text-blue-500 mr-2"}),e.jsxs("p",{className:"text-gray-600",children:[h.work_time||0," ",r("minutes")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("intervention_type")}),e.jsx("p",{className:"text-gray-600",children:h.intervention_type||r("not_specified")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("travel_time")}),e.jsxs("p",{className:"text-gray-600",children:[h.travel_time||0," ",r("minutes")]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("assigned_technician")}),e.jsx("p",{className:"text-gray-600",children:n?n.name:r("not_assigned")})]}),h.materials_used&&h.materials_used.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:r("materials_used")}),e.jsx("ul",{className:"list-disc list-inside",children:h.materials_used.map((u,c)=>{const _=d(u.product_id);return e.jsxs("li",{className:"text-gray-600",children:[_?_.name:r("unknown_product")," - ",u.quantity||0," ",r("units")]},c)})})]})]},h._id)})]}),e.jsxs("div",{className:"flex items-center mb-4 px-4 py-5 sm:px-6",children:[e.jsx(Se,{className:"text-blue-500 mr-2"}),e.jsxs("p",{className:"text-gray-600",children:[r("lunch_location"),": ",t.lunch_location||r("not_specified")]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:s,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:r("close")})})]})})},pt=({initialData:t,onFormDataChange:s})=>{const{t:r}=G(),[a,o]=x.useState(!1),[d,l]=x.useState(0),{formData:p,clients:h,worksites:v,products:i,users:f,isLoading:n,error:u,handleChange:c,handleActivityChange:_,handleSubmit:F,appendActivity:k,removeActivity:j,validateForm:C,appendMaterial:P,removeMaterial:N}=Te(t,s),{showFlashMessage:w}=Fe(),I=()=>{const m=C();if(Object.keys(m).length===0)o(!0);else{const b=Object.values(m)[0];w(b,"error")}},g=()=>{document.querySelectorAll(`[id^="activity_${d}_"]`).forEach(b=>{(b instanceof HTMLInputElement||b instanceof HTMLSelectElement||b instanceof HTMLTextAreaElement)&&b.required&&!b.value&&(b.classList.add("border-red-500"),setTimeout(()=>{b.classList.remove("border-red-500")},2e3))})};return n?e.jsx("div",{children:r("loading")}):u?e.jsx("div",{className:"text-red-500",children:u}):e.jsxs("form",{onSubmit:F,className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"date",children:r("date")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"date",type:"date",name:"date",value:p.date,onChange:c,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"technician",children:r("technician")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"technician",name:"technician_id",value:p.technician_id,onChange:c,required:!0,children:[e.jsx("option",{value:"",children:r("select_technician")}),f.map(m=>e.jsx("option",{value:m._id,children:m.name},m._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"lunch_location",children:r("lunch_location")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"lunch_location",type:"text",name:"lunch_location",value:p.lunch_location,onChange:c,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"status",children:r("status")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"status",name:"status",value:p.status,onChange:c,required:!0,children:[e.jsx("option",{value:"",children:r("select_status")}),e.jsx("option",{value:"planned",children:r("planned")}),e.jsx("option",{value:"in_progress",children:r("in_progress")}),e.jsx("option",{value:"completed",children:r("completed")})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"short_description",children:r("short_description")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"short_description",type:"text",name:"short_description",value:p.short_description,onChange:c,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:r("activities")}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-center mb-4 overflow-x-auto",children:p.activities.map((m,b)=>e.jsxs("button",{className:`mr-2 px-3 py-1 rounded-full ${b===d?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,onClick:()=>{l(b),g()},children:[r("activity")," ",b+1]},b))}),e.jsx("div",{className:"relative overflow-hidden",children:e.jsx("div",{className:"flex transition-transform duration-300 ease-in-out",style:{transform:`translateX(-${d*100}%)`},children:p.activities.map((m,b)=>e.jsx("div",{className:"w-full flex-shrink-0",children:e.jsx(mt,{activity:m,index:b,clients:h,worksites:v,products:i,users:f,handleActivityChange:_,appendMaterial:P,removeActivity:()=>j(b),removeMaterial:N})},b))})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l focus:outline-none focus:shadow-outline",onClick:()=>l(m=>Math.max(0,m-1)),disabled:d===0,children:r("previous")}),e.jsx("button",{type:"button",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-r focus:outline-none focus:shadow-outline",onClick:()=>l(m=>Math.min(p.activities.length-1,m+1)),disabled:d===p.activities.length-1,children:r("next")})]})]}),e.jsxs("button",{type:"button",className:"mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center",onClick:()=>{k(),l(p.activities.length)},children:[e.jsx(oe,{className:"mr-2"}),r("add_activity")]})]}),e.jsxs("div",{className:"flex items-center justify-end mt-4",children:[e.jsx(K,{content:r("preview_report"),children:e.jsxs("button",{type:"button",className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2",onClick:I,children:[e.jsx(Re,{className:"inline-block mr-2"}),r("preview")]})}),e.jsx(K,{content:r("submit_report"),children:e.jsxs("button",{type:"submit",className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:[e.jsx(Me,{className:"inline-block mr-2"}),r("submit")]})})]}),a&&e.jsx(xt,{report:p,onClose:()=>o(!1)})]})},_t=()=>{const{t}=G(),[s,r]=x.useState([]),[a,o]=x.useState(!0),[d,l]=x.useState(null),[p,h]=x.useState(0),[v,i]=x.useState(null);x.useEffect(()=>{f()},[]);const f=async()=>{o(!0);try{const u=await Le();r(u),l(null)}catch(u){l(t("error_fetching_reports")),console.error(t("error_fetching_reports"),u)}finally{o(!1)}},n=u=>{i(u)};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("reports")}),e.jsxs(E.Group,{selectedIndex:p,onChange:h,children:[e.jsxs(E.List,{className:"flex space-x-1 rounded-xl bg-blue-900/20 p-1 mb-6",children:[e.jsx(E,{className:({selected:u})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
             ${u?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("report_list")}),e.jsx(E,{className:({selected:u})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
             ${u?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("create_report")})]}),e.jsxs(E.Panels,{children:[e.jsx(E.Panel,{children:a?e.jsx("p",{children:t("loading_reports")}):d?e.jsx("p",{className:"text-red-500",children:d}):e.jsx(ut,{reports:s})}),e.jsx(E.Panel,{children:e.jsx(pt,{initialData:v,onFormDataChange:n})})]})]})]})};export{_t as default};
