import{W as B,H as G,r as c,f as ve,g as A,M as ne,s as Q,y as z,o as R,n as X,$ as oe,h as Ne,w as _e,D as ce,i as we,k as W,_ as U,T as V,l as ke,m as S,P as q,F as I,t as Ce,u as J,b as Fe,j as e,L as Pe,e as Te}from"./index-ZLcPjq-d.js";import{f as de,u as $e,a as Se}from"./useEntityData-D-gShS0-.js";import{f as Ie,h as le,i as Z,j as Ee,k as De,l as Me,m as Re,c as Le,n as qe,o as Ae,p as Oe,q as Be}from"./index-q0mjuzIJ.js";import{T as Y,B as Ge}from"./Tooltip-U-kV_CE6.js";import"./clientService-D0rezJXS.js";import"./api-CLE4YwRs.js";import"./productsService-DUq13sXT.js";import"./usersService-CO4rIiT5.js";import"./worksiteService-CfPHAhQs.js";let He="span";var ue=(t=>(t[t.None=1]="None",t[t.Focusable=2]="Focusable",t[t.Hidden=4]="Hidden",t))(ue||{});function Ue(t,r){var s;let{features:a=1,...d}=t,o={ref:r,"aria-hidden":(a&2)===2?!0:(s=d["aria-hidden"])!=null?s:void 0,hidden:(a&4)===4?!0:void 0,style:{position:"fixed",top:1,left:1,width:1,height:0,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0",...(a&4)===4&&(a&2)!==2&&{display:"none"}}};return G({ourProps:o,theirProps:d,slot:{},defaultTag:He,name:"Hidden"})}let me=B(Ue);function We({onFocus:t}){let[r,s]=c.useState(!0),a=ve();return r?A.createElement(me,{as:"button",type:"button",features:ue.Focusable,onFocus:d=>{d.preventDefault();let o,l=50;function m(){if(l--<=0){o&&cancelAnimationFrame(o);return}if(t()){if(cancelAnimationFrame(o),!a.current)return;s(!1);return}o=requestAnimationFrame(m)}o=requestAnimationFrame(m)}}):null}const xe=c.createContext(null);function ze(){return{groups:new Map,get(t,r){var s;let a=this.groups.get(t);a||(a=new Map,this.groups.set(t,a));let d=(s=a.get(r))!=null?s:0;a.set(r,d+1);let o=Array.from(a.keys()).indexOf(r);function l(){let m=a.get(r);m>1?a.set(r,m-1):a.delete(r)}return[o,l]}}}function Je({children:t}){let r=c.useRef(ze());return c.createElement(xe.Provider,{value:r},t)}function pe(t){let r=c.useContext(xe);if(!r)throw new Error("You must wrap your component in a <StableCollection>");let s=c.useId(),[a,d]=r.current.get(t,s);return c.useEffect(()=>d,[]),a}var Ke=(t=>(t[t.Forwards=0]="Forwards",t[t.Backwards=1]="Backwards",t))(Ke||{}),Qe=(t=>(t[t.Less=-1]="Less",t[t.Equal=0]="Equal",t[t.Greater=1]="Greater",t))(Qe||{}),Ve=(t=>(t[t.SetSelectedIndex=0]="SetSelectedIndex",t[t.RegisterTab=1]="RegisterTab",t[t.UnregisterTab=2]="UnregisterTab",t[t.RegisterPanel=3]="RegisterPanel",t[t.UnregisterPanel=4]="UnregisterPanel",t))(Ve||{});let Xe={0(t,r){var s;let a=U(t.tabs,i=>i.current),d=U(t.panels,i=>i.current),o=a.filter(i=>{var y;return!((y=i.current)!=null&&y.hasAttribute("disabled"))}),l={...t,tabs:a,panels:d};if(r.index<0||r.index>a.length-1){let i=W(Math.sign(r.index-t.selectedIndex),{[-1]:()=>1,0:()=>W(Math.sign(r.index),{[-1]:()=>0,0:()=>0,1:()=>1}),1:()=>0});if(o.length===0)return l;let y=W(i,{0:()=>a.indexOf(o[0]),1:()=>a.indexOf(o[o.length-1])});return{...l,selectedIndex:y===-1?t.selectedIndex:y}}let m=a.slice(0,r.index),h=[...a.slice(r.index),...m].find(i=>o.includes(i));if(!h)return l;let v=(s=a.indexOf(h))!=null?s:t.selectedIndex;return v===-1&&(v=t.selectedIndex),{...l,selectedIndex:v}},1(t,r){if(t.tabs.includes(r.tab))return t;let s=t.tabs[t.selectedIndex],a=U([...t.tabs,r.tab],o=>o.current),d=t.selectedIndex;return t.info.current.isControlled||(d=a.indexOf(s),d===-1&&(d=t.selectedIndex)),{...t,tabs:a,selectedIndex:d}},2(t,r){return{...t,tabs:t.tabs.filter(s=>s!==r.tab)}},3(t,r){return t.panels.includes(r.panel)?t:{...t,panels:U([...t.panels,r.panel],s=>s.current)}},4(t,r){return{...t,panels:t.panels.filter(s=>s!==r.panel)}}},ee=c.createContext(null);ee.displayName="TabsDataContext";function O(t){let r=c.useContext(ee);if(r===null){let s=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,O),s}return r}let te=c.createContext(null);te.displayName="TabsActionsContext";function se(t){let r=c.useContext(te);if(r===null){let s=new Error(`<${t} /> is missing a parent <Tab.Group /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,se),s}return r}function Ye(t,r){return W(r.type,Xe,t,r)}let Ze="div";function et(t,r){let{defaultIndex:s=0,vertical:a=!1,manual:d=!1,onChange:o,selectedIndex:l=null,...m}=t;const h=a?"vertical":"horizontal",v=d?"manual":"auto";let i=l!==null,y=Q({isControlled:i}),_=z(r),[u,g]=c.useReducer(Ye,{info:y,selectedIndex:l??s,tabs:[],panels:[]}),w=c.useMemo(()=>({selectedIndex:u.selectedIndex}),[u.selectedIndex]),F=Q(o||(()=>{})),n=Q(u.tabs),b=c.useMemo(()=>({orientation:h,activation:v,...u}),[h,v,u]),f=R(x=>(g({type:1,tab:x}),()=>g({type:2,tab:x}))),P=R(x=>(g({type:3,panel:x}),()=>g({type:4,panel:x}))),C=R(x=>{k.current!==x&&F.current(x),i||g({type:0,index:x})}),k=Q(i?t.selectedIndex:u.selectedIndex),T=c.useMemo(()=>({registerTab:f,registerPanel:P,change:C}),[]);X(()=>{g({type:0,index:l??s})},[l]),X(()=>{if(k.current===void 0||u.tabs.length<=0)return;let x=U(u.tabs,j=>j.current);x.some((j,p)=>u.tabs[p]!==j)&&C(x.indexOf(u.tabs[k.current]))});let D={ref:_};return A.createElement(Je,null,A.createElement(te.Provider,{value:T},A.createElement(ee.Provider,{value:b},b.tabs.length<=0&&A.createElement(We,{onFocus:()=>{var x,j;for(let p of n.current)if(((x=p.current)==null?void 0:x.tabIndex)===0)return(j=p.current)==null||j.focus(),!0;return!1}}),G({ourProps:D,theirProps:m,slot:w,defaultTag:Ze,name:"Tabs"}))))}let tt="div";function st(t,r){let{orientation:s,selectedIndex:a}=O("Tab.List"),d=z(r),o=c.useMemo(()=>({selectedIndex:a}),[a]);return G({ourProps:{ref:d,role:"tablist","aria-orientation":s},theirProps:t,slot:o,defaultTag:tt,name:"Tabs.List"})}let rt="button";function at(t,r){var s,a;let d=c.useId(),{id:o=`headlessui-tabs-tab-${d}`,disabled:l=!1,autoFocus:m=!1,...h}=t,{orientation:v,activation:i,selectedIndex:y,tabs:_,panels:u}=O("Tab"),g=se("Tab"),w=O("Tab"),[F,n]=c.useState(null),b=c.useRef(null),f=z(b,r,n);X(()=>g.registerTab(b),[g,b]);let P=pe("tabs"),C=_.indexOf(b);C===-1&&(C=P);let k=C===y,T=R(N=>{var E;let K=N();if(K===V.Success&&i==="auto"){let ye=(E=ke(b))==null?void 0:E.activeElement,ae=w.tabs.findIndex(je=>je.current===ye);ae!==-1&&g.change(ae)}return K}),D=R(N=>{let E=_.map(K=>K.current).filter(Boolean);if(N.key===S.Space||N.key===S.Enter){N.preventDefault(),N.stopPropagation(),g.change(C);return}switch(N.key){case S.Home:case S.PageUp:return N.preventDefault(),N.stopPropagation(),T(()=>q(E,I.First));case S.End:case S.PageDown:return N.preventDefault(),N.stopPropagation(),T(()=>q(E,I.Last))}if(T(()=>W(v,{vertical(){return N.key===S.ArrowUp?q(E,I.Previous|I.WrapAround):N.key===S.ArrowDown?q(E,I.Next|I.WrapAround):V.Error},horizontal(){return N.key===S.ArrowLeft?q(E,I.Previous|I.WrapAround):N.key===S.ArrowRight?q(E,I.Next|I.WrapAround):V.Error}}))===V.Success)return N.preventDefault()}),x=c.useRef(!1),j=R(()=>{var N;x.current||(x.current=!0,(N=b.current)==null||N.focus({preventScroll:!0}),g.change(C),Ce(()=>{x.current=!1}))}),p=R(N=>{N.preventDefault()}),{isFocusVisible:$,focusProps:L}=oe({autoFocus:m}),{isHovered:H,hoverProps:he}=Ne({isDisabled:l}),{pressed:re,pressProps:ge}=_e({disabled:l}),be=c.useMemo(()=>({selected:k,hover:H,active:re,focus:$,autofocus:m,disabled:l}),[k,H,$,re,m,l]),fe=ce({ref:f,onKeyDown:D,onMouseDown:p,onClick:j,id:o,role:"tab",type:we(t,F),"aria-controls":(a=(s=u[C])==null?void 0:s.current)==null?void 0:a.id,"aria-selected":k,tabIndex:k?0:-1,disabled:l||void 0,autoFocus:m},L,he,ge);return G({ourProps:fe,theirProps:h,slot:be,defaultTag:rt,name:"Tabs.Tab"})}let nt="div";function lt(t,r){let{selectedIndex:s}=O("Tab.Panels"),a=z(r),d=c.useMemo(()=>({selectedIndex:s}),[s]);return G({ourProps:{ref:a},theirProps:t,slot:d,defaultTag:nt,name:"Tabs.Panels"})}let it="div",ot=ne.RenderStrategy|ne.Static;function ct(t,r){var s,a,d,o;let l=c.useId(),{id:m=`headlessui-tabs-panel-${l}`,tabIndex:h=0,...v}=t,{selectedIndex:i,tabs:y,panels:_}=O("Tab.Panel"),u=se("Tab.Panel"),g=c.useRef(null),w=z(g,r);X(()=>u.registerPanel(g),[u,g]);let F=pe("panels"),n=_.indexOf(g);n===-1&&(n=F);let b=n===i,{isFocusVisible:f,focusProps:P}=oe(),C=c.useMemo(()=>({selected:b,focus:f}),[b,f]),k=ce({ref:w,id:m,role:"tabpanel","aria-labelledby":(a=(s=y[n])==null?void 0:s.current)==null?void 0:a.id,tabIndex:b?h:-1},P);return!b&&((d=v.unmount)==null||d)&&!((o=v.static)!=null&&o)?A.createElement(me,{"aria-hidden":"true",...k}):G({ourProps:k,theirProps:v,slot:C,defaultTag:it,features:ot,visible:b,name:"Tabs.Panel"})}let dt=B(at),ut=B(et),mt=B(st),xt=B(lt),pt=B(ct),M=Object.assign(dt,{Group:ut,List:mt,Panels:xt,Panel:pt});const ht=({reports:t,onReportDeleted:r})=>{console.log({reports:t});const{t:s}=J(),{user:a}=Fe(),[d,o]=c.useState(""),[l,m]=c.useState(""),[h,v]=c.useState("asc"),[i,y]=c.useState(""),[_,u]=c.useState(""),[g,w]=c.useState(1),F=10,b=t.filter(p=>{const $=p.short_description.toLowerCase().includes(d.toLowerCase()),L=(!i||new Date(p.date)>=new Date(i))&&(!_||new Date(p.date)<=new Date(_));return $&&L}).sort((p,$)=>{if(!l)return 0;const L=p[l],H=$[l];return L<H?h==="asc"?-1:1:L>H?h==="asc"?1:-1:0}),f=g*F,P=f-F,C=b.slice(P,f),k=Math.ceil(b.length/F),T=p=>{const $=l===p&&h==="asc"?"desc":"asc";m(p),v($)},D=p=>{w(p)},x=()=>{y(""),u("")},j=async p=>{if(window.confirm(s("confirm_delete_report")))try{await Ie(p),r==null||r()}catch($){console.error("Error deleting report:",$)}};return e.jsxs("div",{className:"overflow-x-auto",children:[e.jsxs("div",{className:"mb-4 flex space-x-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"filter",className:"block text-sm font-medium text-gray-700",children:s("filter_by_description")}),e.jsx("input",{id:"filter",type:"text",placeholder:s("filter_by_description"),value:d,onChange:p=>o(p.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"startDate",className:"block text-sm font-medium text-gray-700",children:s("start_date")}),e.jsx("input",{id:"startDate",type:"date",value:i,onChange:p=>y(p.target.value),className:"border rounded px-2 py-1"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"endDate",className:"block text-sm font-medium text-gray-700",children:s("end_date")}),e.jsx("input",{id:"endDate",type:"date",value:_,onChange:p=>u(p.target.value),className:"border rounded px-2 py-1"})]}),e.jsx("div",{className:"flex items-end",children:e.jsx("button",{onClick:x,className:"px-4 py-2 bg-gray-300 rounded",children:s("clear_date_range")})})]}),e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>T("date"),children:s("date")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>T("technician_id.name"),children:s("technician")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>T("short_description"),children:s("short_description")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer",onClick:()=>T("status"),children:s("status")}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:s("actions")})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:C.map(p=>e.jsxs("tr",{children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:de(p.date)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:p.short_description}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${p.status==="completed"?"bg-green-100 text-green-800":p.status==="in_progress"?"bg-yellow-100 text-yellow-800":p.status==="planned"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:s(p.status)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx(Pe,{to:`/reports/${p._id}`,className:"text-indigo-600 hover:text-indigo-900 mr-4",children:s("view")}),(a==null?void 0:a.role)==="admin"&&e.jsx("button",{onClick:()=>j(p._id),className:"text-red-600 hover:text-red-900",children:s("delete")})]})]},p._id))})]}),e.jsxs("div",{className:"mt-4 flex justify-between",children:[e.jsx("button",{onClick:()=>D(g-1),disabled:g===1,className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",children:s("previous")}),e.jsxs("span",{children:[s("page")," ",g," ",s("of")," ",k]}),e.jsx("button",{onClick:()=>D(g+1),disabled:g===k,className:"px-4 py-2 bg-gray-300 rounded disabled:opacity-50",children:s("next")})]})]})},ie="/assets/control-CGKJ2IdP.png",gt=({activity:t,index:r,clients:s,worksites:a,products:d,users:o,handleActivityChange:l,removeActivity:m,appendMaterial:h,removeMaterial:v})=>{const{t:i}=J(),[y,_]=c.useState(""),[u,g]=c.useState(!1),w=(n,b)=>{const f=[...t.materials_used],P=b.target.name==="quantity"?Math.max(1,Number(b.target.value)):b.target.value;f[n]={...f[n],[b.target.name]:P},l(r,{target:{name:"materials_used",value:f}})},F=(n,b)=>{const f=[...t.materials_used];f[n].quantity=Math.max(1,f[n].quantity+b),l(r,{target:{name:"materials_used",value:f}})};return e.jsxs("div",{className:"border p-6 mb-6 rounded-lg shadow-lg bg-gradient-to-r from-blue-50 to-blue-100",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("h3",{className:"text-xl font-bold text-blue-800",children:[i("activity")," ",r+1]}),e.jsx(Y,{content:i("remove_activity"),children:e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 focus:outline-none",onClick:()=>m(r),children:e.jsx(le,{})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`client_id_${r}`,children:i("client")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`client_id_${r}`,name:"client_id",value:t.client_id,onChange:n=>l(r,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_client")}),s.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`worksite_${r}`,children:i("worksite")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`worksite_${r}`,name:"worksite_id",value:t.worksite_id,onChange:n=>l(r,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_worksite")}),a.filter(n=>n.client_id===t.client_id).map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`description_${r}`,children:i("description")}),e.jsx("textarea",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`description_${r}`,name:"description",value:t.description,onChange:n=>l(r,n),required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`travel_time_${r}`,children:[i("travel_time")," (",i("minutes"),")"]}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`travel_time_${r}`,type:"number",name:"travel_time",value:t.travel_time,onChange:n=>l(r,n),required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`work_time_${r}`,children:[i("work_time")," (",i("minutes"),")"]}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`work_time_${r}`,type:"number",name:"work_time",value:t.work_time,onChange:n=>l(r,n),required:!0})]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:`assigned_technician_${r}`,children:i("assigned_technician")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:`assigned_technician_${r}`,name:"assigned_technician_id",value:t.assigned_technician_id,onChange:n=>l(r,n),required:!0,children:[e.jsx("option",{value:"",children:i("select_technician")}),o.map(n=>e.jsx("option",{value:n._id,children:n.name},n._id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("h4",{className:"text-md font-semibold mb-2 flex items-center",children:[i("materials_used"),e.jsx(Y,{content:i("add_material"),children:e.jsx("button",{type:"button",className:"ml-2 text-blue-500 hover:text-blue-700 focus:outline-none",onClick:()=>h(r),children:e.jsx(Z,{})})})]}),e.jsx("input",{type:"text",placeholder:i("search_products"),value:y,onChange:n=>_(n.target.value),className:"mb-2 p-2 border rounded w-full"}),t.materials_used.map((n,b)=>e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"flex-grow",children:e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",name:"product_id",value:n.product_id,onChange:f=>w(b,f),required:!0,children:[e.jsx("option",{value:"",children:i("select_product")}),d.filter(f=>(f.item_code.toLowerCase().includes(y.toLowerCase())||f.supplier_item_code.toLowerCase().includes(y.toLowerCase())||f.item_description.toLowerCase().includes(y.toLowerCase()))&&!t.materials_used.some(P=>P.product_id===f._id&&P!==n)).map(f=>e.jsxs("option",{value:f._id,children:[f.item_code," - ",f.supplier_item_code," - ",f.item_description]},f._id))]})}),e.jsxs("div",{className:"flex items-center",children:[u?e.jsx("input",{className:"appearance-none rounded-md relative block w-16 px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",type:"number",name:"quantity",value:n.quantity,onChange:f=>w(b,f),required:!0,style:{minWidth:"100px",width:"100px"}}):e.jsxs("div",{className:"flex items-center",style:{minWidth:"100px",width:"100px",display:"flex",alignContent:"center",justifyContent:"space-around"},children:[e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 focus:outline-none",onClick:()=>F(b,-1),children:e.jsx(Ee,{})}),e.jsx("span",{className:"mx-2",children:n.quantity}),e.jsx("button",{type:"button",className:"text-gray-500 hover:text-gray-700 focus:outline-none",onClick:()=>F(b,1),children:e.jsx(Z,{})})]}),e.jsx("button",{type:"button",className:"ml-2 text-blue-500 hover:text-blue-700 focus:outline-none",onClick:()=>g(!u),children:u?e.jsx("div",{style:{cursor:"pointer",height:"32px",width:"32px",background:`url(${ie})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"},onClick:()=>{}}):e.jsx("div",{style:{cursor:"pointer",height:"32px",width:"32px",background:`url(${ie})`,backgroundSize:"contain",backgroundRepeat:"no-repeat"},onClick:()=>{}})})]}),e.jsx("button",{type:"button",className:"text-red-500 hover:text-red-700 focus:outline-none",onClick:()=>v(r,b),children:e.jsx(le,{})})]},b))]})]})},bt=({report:t,onClose:r})=>{const{t:s}=J(),{getClientById:a,getWorksiteById:d,getProductById:o,getUserById:l}=$e(),m=h=>h.completed?e.jsx(Le,{className:"text-green-500 text-2xl"}):e.jsx(qe,{className:"text-yellow-500 text-2xl"});return e.jsx(Ge,{onClose:r,children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-11/12 max-w-4xl shadow-lg rounded-md bg-white overflow-y-auto max-h-[80vh]",children:[e.jsxs("div",{className:"bg-white shadow overflow-hidden sm:rounded-lg",children:[e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800",children:s("report_preview")}),e.jsx("p",{className:"text-gray-600",children:de(t.date)})]}),e.jsx("div",{className:"border-t border-gray-200 px-4 py-5 sm:p-0",children:e.jsxs("dl",{className:"sm:divide-y sm:divide-gray-200",children:[e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:s("technician")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:t.technician_id.name})]}),e.jsxs("div",{className:"py-4 sm:py-5 sm:grid sm:grid-cols-3 sm:gap-4 sm:px-6",children:[e.jsx("dt",{className:"text-sm font-medium text-gray-500",children:s("status")}),e.jsx("dd",{className:"mt-1 text-sm text-gray-900 sm:mt-0 sm:col-span-2",children:s(t.status)})]})]})}),e.jsxs("div",{className:"px-4 py-5 sm:px-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-4",children:s("activities")}),t.activities.map((h,v)=>{const i=a(h.client_id),y=d(h.worksite_id),_=l(h.assigned_technician_id);return e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-4 shadow",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"text-lg font-semibold text-gray-700",children:[s("activity")," ",v+1]}),m(h)]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("client")}),e.jsx("span",{className:"text-blue-600",children:i?i.name:s("unknown_client")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("worksite")}),e.jsx("span",{className:"text-blue-600",children:y?y.name:s("unknown_worksite")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(De,{className:"text-blue-500 mr-2"}),e.jsx("p",{className:"text-gray-600",children:h.description||s("no_description")})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(Me,{className:"text-blue-500 mr-2"}),e.jsxs("p",{className:"text-gray-600",children:[h.work_time||0," ",s("minutes")]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-2",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("intervention_type")}),e.jsx("p",{className:"text-gray-600",children:h.intervention_type||s("not_specified")})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("travel_time")}),e.jsxs("p",{className:"text-gray-600",children:[h.travel_time||0," ",s("minutes")]})]})]}),e.jsxs("div",{className:"mb-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("assigned_technician")}),e.jsx("p",{className:"text-gray-600",children:_?_.name:s("not_assigned")})]}),h.materials_used&&h.materials_used.length>0&&e.jsxs("div",{className:"mt-2",children:[e.jsx("h5",{className:"font-semibold text-gray-700",children:s("materials_used")}),e.jsx("ul",{className:"list-disc list-inside",children:h.materials_used.map((u,g)=>{const w=o(u.product_id);return e.jsxs("li",{className:"text-gray-600",children:[w?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"font-semibold text-gray-700",children:w.item_code})," -",e.jsxs("span",{className:"text-sm text-gray-500",children:[" ",s("supplier_item_code"),": ",w.supplier_item_code]})," -",e.jsx("span",{className:"text-gray-600",children:w.item_description})]}):e.jsx("span",{className:"text-red-600",children:s("unknown_product")}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-sm text-gray-600",children:[s("Quantity"),":"]}),e.jsxs("span",{className:"font-semibold",children:[" ",u.quantity||0," ",s("units")]})]})]},g)})})]})]},h._id+v)})]}),e.jsxs("div",{className:"flex items-center mb-4 px-4 py-5 sm:px-6",children:[e.jsx(Re,{className:"text-blue-500 mr-2"}),e.jsxs("p",{className:"text-gray-600",children:[s("lunch_location"),": ",t.lunch_location||s("not_specified")]})]})]}),e.jsx("div",{className:"mt-4 flex justify-end",children:e.jsx("button",{onClick:r,className:"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600",children:s("close")})})]})})},ft=({initialData:t,onFormDataChange:r})=>{const{t:s}=J(),[a,d]=c.useState(!1),[o,l]=c.useState(0),{formData:m,clients:h,worksites:v,products:i,users:y,isLoading:_,error:u,handleChange:g,handleActivityChange:w,handleSubmit:F,appendActivity:n,removeActivity:b,validateForm:f,appendMaterial:P,removeMaterial:C}=Se(t,r),{showFlashMessage:k}=Te(),T=()=>{const x=f();if(Object.keys(x).length===0)d(!0);else{const j=Object.values(x)[0];k(j,"error")}},D=()=>{document.querySelectorAll(`[id^="activity_${o}_"]`).forEach(j=>{(j instanceof HTMLInputElement||j instanceof HTMLSelectElement||j instanceof HTMLTextAreaElement)&&j.required&&!j.value&&(j.classList.add("border-red-500"),setTimeout(()=>{j.classList.remove("border-red-500")},2e3))})};return _?e.jsx("div",{children:s("loading")}):u?e.jsx("div",{className:"text-red-500",children:u}):e.jsxs("form",{onSubmit:F,className:"bg-white shadow-md rounded px-8 pt-6 pb-8 mb-4",children:[e.jsxs("div",{className:"mb-4 grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"date",children:s("date")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"date",type:"date",name:"date",value:m.date,onChange:g,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"technician",children:s("technician")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"technician",name:"technician_id",value:m.technician_id,onChange:g,required:!0,children:[e.jsx("option",{value:"",children:s("select_technician")}),y&&y.length>0?y.map(x=>e.jsx("option",{value:x._id,children:x.name},x._id)):e.jsx("option",{value:"",disabled:!0,children:s("loading_users")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"lunch_location",children:s("lunch_location")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"lunch_location",type:"text",name:"lunch_location",value:m.lunch_location,onChange:g,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"status",children:s("status")}),e.jsxs("select",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"status",name:"status",value:m.status,onChange:g,required:!0,children:[e.jsx("option",{value:"",children:s("select_status")}),e.jsx("option",{value:"planned",children:s("planned")}),e.jsx("option",{value:"in_progress",children:s("in_progress")}),e.jsx("option",{value:"completed",children:s("completed")})]})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",htmlFor:"short_description",children:s("short_description")}),e.jsx("input",{className:"appearance-none rounded-md relative block w-full px-3 py-2 border border-gray-300 placeholder-gray-500 text-gray-900 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm",id:"short_description",type:"text",name:"short_description",value:m.short_description,onChange:g,required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold mb-2",children:s("activities")}),e.jsxs("button",{style:{marginBottom:"1rem"},type:"button",className:"mt-4 bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline flex items-center",onClick:()=>{n(),l(m.activities.length)},children:[e.jsx(Z,{className:"mr-2"}),s("add_activity")]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"flex items-center mb-4 overflow-x-auto",children:m.activities.map((x,j)=>e.jsxs("button",{className:`mr-2 px-3 py-1 rounded-full ${j===o?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,onClick:()=>{l(j),D()},children:[s("activity")," ",j+1]},j))}),e.jsx("div",{className:"relative overflow-hidden",children:e.jsx("div",{className:"flex transition-transform duration-300 ease-in-out",style:{transform:`translateX(-${o*100}%)`},children:m.activities.map((x,j)=>e.jsx("div",{className:"w-full flex-shrink-0",children:e.jsx(gt,{activity:x,index:j,clients:h,worksites:v,products:i,users:y,handleActivityChange:w,appendMaterial:P,removeActivity:()=>b(j),removeMaterial:C})},j))})}),e.jsxs("div",{className:"flex justify-between mt-4",children:[e.jsx("button",{type:"button",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-l focus:outline-none focus:shadow-outline",onClick:()=>l(x=>Math.max(0,x-1)),disabled:o===0,children:s("previous")}),e.jsx("button",{type:"button",className:"bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-r focus:outline-none focus:shadow-outline",onClick:()=>l(x=>Math.min(m.activities.length-1,x+1)),disabled:o===m.activities.length-1,children:s("next")})]})]})]}),e.jsxs("div",{className:"flex items-center justify-end mt-4",children:[e.jsx(Y,{content:s("preview_report"),children:e.jsxs("button",{type:"button",className:"bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline mr-2",onClick:T,children:[e.jsx(Ae,{className:"inline-block mr-2"}),s("preview")]})}),e.jsx(Y,{content:s("submit_report"),children:e.jsxs("button",{type:"submit",className:"bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded focus:outline-none focus:shadow-outline",children:[e.jsx(Oe,{className:"inline-block mr-2"}),s("submit")]})})]}),a&&e.jsx(bt,{report:m,onClose:()=>d(!1)})]})},Pt=()=>{const{t}=J(),[r,s]=c.useState([]),[a,d]=c.useState(!0),[o,l]=c.useState(null),[m,h]=c.useState(0),[v,i]=c.useState(null);c.useEffect(()=>{y()},[]);const y=async()=>{d(!0);try{const u=await Be();s(u),l(null)}catch(u){l(t("error_fetching_reports")),console.error(t("error_fetching_reports"),u)}finally{d(!1)}},_=u=>{i(u)};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:t("reports")}),e.jsxs(M.Group,{selectedIndex:m,onChange:h,children:[e.jsxs(M.List,{className:"flex space-x-1 rounded-xl bg-blue-900/20 p-1 mb-6",children:[e.jsx(M,{className:({selected:u})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
             ${u?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("report_list")}),e.jsx(M,{className:({selected:u})=>`w-full rounded-lg py-2.5 text-sm font-medium leading-5 text-blue-700
             ${u?"bg-white shadow":"text-blue-100 hover:bg-white/[0.12] hover:text-white"}`,children:t("create_report")})]}),e.jsxs(M.Panels,{children:[e.jsx(M.Panel,{children:a?e.jsx("p",{children:t("loading_reports")}):o?e.jsx("p",{className:"text-red-500",children:o}):e.jsx(ht,{reports:r,onReportDeleted:()=>y()})}),e.jsx(M.Panel,{children:e.jsx(ft,{initialData:v,onFormDataChange:_})})]})]})]})};export{Pt as default};
