import{u as S,r as h,j as e,g as z,R as E,h as A}from"./index-D9KOjK-M.js";import{d as T,a as B,b as D}from"./productsService-DJ1x3sK0.js";import"./api-B396KAwJ.js";const F=({onFilterChange:a})=>{const{t:d}=S(),[u,x]=h.useState(""),[c,i]=h.useState(""),g=r=>{r.preventDefault(),a({searchText:u,type:c})};return e.jsxs("form",{onSubmit:g,className:"flex space-x-4",children:[e.jsx("input",{type:"text",placeholder:d("filter_by_name_code_description"),value:u,onChange:r=>{x(r.target.value)},className:"border rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsxs("select",{value:c,onChange:r=>{i(r.target.value)},className:"border rounded px-4 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:d("all_types")}),e.jsx("option",{value:"product",children:d("product")}),e.jsx("option",{value:"material",children:d("material")})]}),e.jsx("button",{type:"submit",className:"bg-blue-500 text-white px-4 py-2 rounded cursor-pointer hover:bg-blue-600 transition-colors",children:d("apply_filters")})]})},G=({products:a,onProductDeleted:d,onProductsSelected:u})=>{const{t:x}=S(),{user:c}=z(),[i,g]=h.useState([]),[r,N]=h.useState(null),j=t=>{let o="ascending";r&&r.key===t&&r.direction==="ascending"&&(o="descending"),N({key:t,direction:o})},_=t=>{g(o=>{const n=o.includes(t)?o.filter(s=>s!==t):[...o,t];return u==null||u(n),n})},P=()=>{const t=a&&Array.isArray(a)?a:[];console.log("[DEBUG] handleSelectAll - localProducts:",t);const o=t.length>0&&t.every(s=>i.includes(s._id));let n;o?n=i.filter(s=>!t.some(p=>p._id===s)):n=[...i,...t.filter(s=>!i.includes(s._id)).map(s=>s._id)],g(n),u==null||u(n)},y=async t=>{if(window.confirm(x("confirm_delete_product")))try{await T(t),d==null||d(t)}catch(o){console.error("Error deleting product:",o)}},f=["codice_articolo","codice_fornitore","descrizione_articolo","prezzo_listino","prezzo_acquisto","prezzo_concosti","prezzo_cliente","prezzo_iva10","prezzo_iva22","data_acquisto","settore","marca","macrosettore","famiglie","listino","scontato","con_spese_generali","con_ricarico","iva_al_10","vendita_al_22","uso","field_1","field_2","field_3"];E.useEffect(()=>{console.log("[DEBUG] ProductList rendered with products prop:",a)},[a]);const m=a&&Array.isArray(a)?a:[];console.log("[DEBUG] Computed validProducts:",m);const v=[...m];return r!==null&&v.sort((t,o)=>{const n=t[r.key],s=o[r.key];return n<s?r.direction==="ascending"?-1:1:n>s?r.direction==="ascending"?1:-1:0}),e.jsxs("div",{className:"overflow-x-auto relative",children:[e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-1 py-0.5",children:e.jsx("input",{type:"checkbox",onChange:P,checked:m.length>0&&m.every(t=>i.includes(t._id))})}),f.map(t=>e.jsxs("th",{title:t,onClick:()=>j(t),className:"px-1 py-0.5 text-left text-xs font-medium text-gray-500 uppercase tracking-wide cursor-pointer",children:[t,(r==null?void 0:r.key)===t&&e.jsx("span",{children:r.direction==="ascending"?" ▲":" ▼"})]},t)),e.jsx("th",{className:"px-2 py-1 whitespace-nowrap sticky right-0 bg-white shadow-l",children:(c==null?void 0:c.role)==="admin"&&e.jsx("span",{className:"text-xs text-gray-700",children:x("actions")})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:v.map((t,o)=>t?e.jsxs("tr",{children:[e.jsx("td",{className:"px-1 py-0.5 whitespace-nowrap",children:e.jsx("input",{type:"checkbox",checked:i.includes(t._id),onChange:()=>_(t._id)})}),f.map(n=>{var s,p;return e.jsx("td",{className:`px-1 py-0.5 whitespace-nowrap ${t[n]?"":"bg-red-200"}`,title:t[n]?(s=t[n])==null?void 0:s.toString():"Missing",children:t[n]!==void 0&&t[n]!==null?(p=t[n])==null?void 0:p.toString():"MISSING"},n)}),e.jsx("td",{className:"px-2 py-1 whitespace-nowrap sticky right-0 bg-white shadow-l",children:(c==null?void 0:c.role)==="admin"&&e.jsx("button",{onClick:()=>y(t._id),className:"text-red-600 hover:text-red-900 text-xs",children:x("delete")})})]},t._id):(console.error(`[DEBUG] sortedProducts[${o}] is undefined or null!`),null))})]}),e.jsxs("div",{className:"mt-1 text-xs text-gray-600",children:[x("total_products"),": ",a.length]})]})},R=()=>{const{t:a}=S(),d=A(),[u,x]=h.useState([]),[c,i]=h.useState(1),[g,r]=h.useState(1),[N,j]=h.useState(0),[_,P]=h.useState({searchText:"",type:""}),[y,f]=h.useState([]);h.useEffect(()=>{m()},[c,_]);const m=async()=>{try{const s=await B(c,_);x(s.products),i(s.currentPage),r(s.totalPages),j(s.totalProducts)}catch(s){console.error("Error fetching products:",s),x([]),i(1),r(1),j(0)}},v=s=>{P(s),i(1)},t=s=>{i(s)},o=async()=>{if(y.length!==0&&window.confirm(a("confirm_delete_multiple_products")))try{await D(y),f([]),m()}catch(s){console.error("Error deleting products:",s)}},n=()=>{const s=g,p=c,k=2,C=[],w=[];let b;for(let l=1;l<=s;l++)(l===1||l===s||l>=p-k&&l<=p+k)&&C.push(l);for(const l of C)b&&(l-b===2?w.push(b+1):l-b>2&&w.push("...")),w.push(l),b=l;return w};return e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-4",children:a("products")}),e.jsx("div",{className:"flex justify-between items-center mb-4",children:e.jsxs("div",{className:"flex items-center w-full flex-wrap gap-4",children:[e.jsx(F,{onFilterChange:v}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsx("button",{onClick:()=>d("/create-product"),className:"bg-blue-500 text-white whitespace-nowrap px-4 py-2 rounded cursor-pointer hover:bg-blue-600 transition-colors",children:a("create_one_product")})}),y.length>0&&e.jsx("button",{onClick:o,className:"bg-red-500 text-white whitespace-nowrap px-4 py-2 rounded cursor-pointer hover:bg-red-600 transition-colors",children:a("delete_selected",{count:y.length})})]})}),e.jsx(G,{products:u,onProductDeleted:()=>m(),onProductsSelected:f}),e.jsx("nav",{className:"flex justify-center mt-4",children:e.jsxs("ul",{className:"flex items-center space-x-2",children:[e.jsx("li",{children:e.jsx("button",{onClick:()=>t(Math.max(1,c-1)),disabled:c===1,className:"px-3 py-1 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50",children:a("previous")})}),n().map((s,p)=>e.jsx("li",{children:s==="..."?e.jsx("span",{className:"px-2",children:"..."}):e.jsx("button",{onClick:()=>t(s),className:`px-3 py-1 rounded ${s===c?"bg-blue-500 text-white":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,children:s})},p)),e.jsx("li",{children:e.jsx("button",{onClick:()=>t(Math.min(g,c+1)),disabled:c===g,className:"px-3 py-1 rounded bg-gray-200 text-gray-700 hover:bg-gray-300 disabled:opacity-50",children:a("next")})})]})}),e.jsxs("div",{className:"mt-1 text-xs text-gray-600",children:[a("total_products"),": ",N]})]})};export{R as default};
